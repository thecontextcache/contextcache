(()=>{var e={};e.id=3,e.ids=[3],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5181:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>h,originalPathname:()=>m,pages:()=>c,routeModule:()=>u,tree:()=>o}),s(4305),s(9889),s(2001),s(784),s(1888);var a=s(3191),i=s(8716),n=s(7922),l=s.n(n),r=s(5231),d={};for(let e in r)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>r[e]);s.d(t,d);let o=["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,4305)),"/Users/nd/Documents/contextcache/web/app/admin/page.js"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,9889)),"/Users/nd/Documents/contextcache/web/app/layout.js"],template:[()=>Promise.resolve().then(s.bind(s,2001)),"/Users/nd/Documents/contextcache/web/app/template.js"],error:[()=>Promise.resolve().then(s.bind(s,784)),"/Users/nd/Documents/contextcache/web/app/error.js"],"not-found":[()=>Promise.resolve().then(s.bind(s,1888)),"/Users/nd/Documents/contextcache/web/app/not-found.js"]}],c=["/Users/nd/Documents/contextcache/web/app/admin/page.js"],m="/admin/page",h={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},8100:(e,t,s)=>{Promise.resolve().then(s.bind(s,7072))},7072:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var a=s(326),i=s(7577),n=s.n(i),l=s(5047),r=s(1207),d=s(9776),o=s(874),c=s(2720),m=s(9086);let h=[{id:"waitlist",label:"Waitlist"},{id:"invites",label:"Invites"},{id:"users",label:"Users"},{id:"login-ips",label:"Login IPs"},{id:"usage",label:"Usage"}];function u({status:e}){return a.jsx("span",{className:`badge ${{pending:"badge-warn",approved:"badge-ok",rejected:"badge-danger",active:"badge-ok",disabled:"badge-danger",accepted:"badge-ok",revoked:"badge-danger"}[e]||"badge-brand"}`,children:e})}function p(){let e=(0,l.useRouter)(),t=(0,d.p)(),[s,p]=(0,i.useState)("waitlist"),[g,j]=(0,i.useState)(!0),[y,b]=(0,i.useState)([]),[v,f]=(0,i.useState)([]),[w,N]=(0,i.useState)([]),[S,_]=(0,i.useState)([]),[k,C]=(0,i.useState)(""),[$,P]=(0,i.useState)(""),[L,E]=(0,i.useState)(!1),[R,A]=(0,i.useState)(""),[T,z]=(0,i.useState)("all"),[M,U]=(0,i.useState)(""),[I,D]=(0,i.useState)("all"),[F,O]=(0,i.useState)(""),[W,B]=(0,i.useState)("all"),[q,G]=(0,i.useState)(null),[H,V]=(0,i.useState)(""),[X,Y]=(0,i.useState)([]),[J,K]=(0,i.useState)(!1),[Q,Z]=(0,i.useState)({}),[ee,et]=(0,i.useState)({});function es(s){if(s instanceof r.MS){if("auth"===s.kind){e.replace("/auth?reason=expired");return}if("forbidden"===s.kind){e.replace("/app");return}}t.error(s.message||"Something went wrong.")}async function ea(){j(!0);try{if(!(await (0,r.SC)("/auth/me")).is_admin){e.replace("/app");return}}catch(e){es(e),j(!1);return}let[s,a,i,n]=await Promise.allSettled([(0,r.SC)("/admin/waitlist"),(0,r.SC)("/admin/invites"),(0,r.SC)("/admin/users"),(0,r.SC)("/admin/usage")]);"fulfilled"===s.status?b(s.value):t.error(`Waitlist: ${s.reason?.message||"failed to load"}`),"fulfilled"===a.status?f(a.value):t.error(`Invites: ${a.reason?.message||"failed to load"}`),"fulfilled"===i.status?N(i.value):t.error(`Users: ${i.reason?.message||"failed to load"}`),"fulfilled"===n.status?_(n.value):t.error(`Usage: ${n.reason?.message||"failed to load"}`),j(!1)}async function ei(e,s){try{await (0,r.SC)(`/admin/waitlist/${e}/approve`,{method:"POST"}),t.success(`${s} approved — invite created.`),await ea()}catch(e){es(e)}}async function en(e,s){try{await (0,r.SC)(`/admin/waitlist/${e}/reject`,{method:"POST"}),t.info(`${s} rejected.`),await ea()}catch(e){es(e)}}async function el(e){if(e.preventDefault(),!L){E(!0);try{await (0,r.SC)("/admin/invites",{method:"POST",body:JSON.stringify({email:k.trim(),notes:$})}),t.success(`Invite sent to ${k.trim()}`),C(""),P(""),await ea()}catch(e){es(e)}finally{E(!1)}}}async function er(e,s){try{await (0,r.SC)(`/admin/invites/${e}/revoke`,{method:"POST"}),t.success(`Invite for ${s} revoked.`),await ea()}catch(e){es(e)}}async function ed(e,s){try{await (0,r.SC)(`/admin/users/${e}/${s?"disable":"enable"}`,{method:"POST"}),t.success(s?"User disabled.":"User enabled."),await ea()}catch(e){es(e)}}async function eo(e,s){try{await (0,r.SC)(`/admin/users/${e}/revoke-sessions`,{method:"POST"}),t.success(`Sessions for ${s} revoked.`),await ea()}catch(e){es(e)}}async function ec(e,s,a){try{await (0,r.SC)(`/admin/users/${e}/${a?"grant-admin":"revoke-admin"}`,{method:"POST"}),t.success(`${s} ${a?"granted":"revoked"} admin.`),await ea()}catch(e){es(e)}}async function em(e,s){try{await (0,r.SC)(`/admin/users/${e}/set-unlimited?unlimited=${s}`,{method:"POST"}),t.success(s?"User marked as unlimited.":"Unlimited removed."),await ea()}catch(e){es(e)}}async function eh(e){et(t=>({...t,[e]:!0}));try{let t=await (0,r.SC)(`/admin/users/${e}/stats`);Z(s=>({...s,[e]:t}))}catch(e){t.error(`Stats: ${e.message||"failed"}`)}finally{et(t=>({...t,[e]:!1}))}}async function eu(e,s){G(e),V(s),K(!0),Y([]);try{let t=await (0,r.SC)(`/admin/users/${e}/login-events`);Y(t||[])}catch(e){t.error(`Login IPs: ${e.message||"failed to load"}`)}finally{K(!1)}}let[ep,ex]=(0,i.useState)(1),[eg,ej]=(0,i.useState)(1),[ey,eb]=(0,i.useState)(1),ev=(0,i.useCallback)(e=>{A(e),ex(1)},[]),ef=(0,i.useCallback)(e=>{U(e),ej(1)},[]),ew=(0,i.useCallback)(e=>{O(e),eb(1)},[]),eN=(0,i.useMemo)(()=>y.filter(e=>{let t=!R||e.email.toLowerCase().includes(R.toLowerCase()),s="all"===T||e.status===T;return t&&s}),[y,R,T]),eS=(0,i.useMemo)(()=>v.filter(e=>{let t=!M||e.email.toLowerCase().includes(M.toLowerCase()),s=e.revoked_at?"revoked":e.accepted_at?"accepted":"pending",a="all"===I||s===I;return t&&a}),[v,M,I]),e_=(0,i.useMemo)(()=>w.filter(e=>{let t=!F||e.email.toLowerCase().includes(F.toLowerCase());return"all"===W?t:"disabled"===W?t&&e.is_disabled:"active"===W?t&&!e.is_disabled:"admin"===W?t&&e.is_admin:"unlimited"===W?t&&e.is_unlimited:t}),[w,F,W]),ek=(0,i.useMemo)(()=>eN.slice((ep-1)*20,20*ep),[eN,ep]),eC=(0,i.useMemo)(()=>eS.slice((eg-1)*20,20*eg),[eS,eg]),e$=(0,i.useMemo)(()=>e_.slice((ey-1)*20,20*ey),[e_,ey]),eP=Math.max(...S.map(e=>e.count||0),1),eL=y.filter(e=>"pending"===e.status).length;return g?(0,a.jsxs)("div",{className:"stack-lg",children:[a.jsx(o.A,{rows:2}),a.jsx(o.A,{rows:5}),a.jsx(o.A,{rows:5})]}):(0,a.jsxs)("div",{className:"stack-lg",children:[a.jsx("section",{className:"card",children:(0,a.jsxs)("div",{className:"row spread",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"row",style:{gap:8,marginBottom:4},children:[a.jsx("h1",{style:{margin:0,fontSize:"1.4rem"},children:"Admin"}),a.jsx("span",{className:"badge badge-warn",children:"Alpha controls"})]}),a.jsx("p",{className:"muted",children:"Manage waitlist, invitations, users, and usage."})]}),(0,a.jsxs)("div",{className:"row",style:{flexWrap:"wrap",gap:6},children:[eL>0&&(0,a.jsxs)("span",{className:"badge badge-warn",children:[eL," pending"]}),(0,a.jsxs)("span",{className:"badge badge-brand",children:[w.length," users"]}),(0,a.jsxs)("span",{className:"badge badge-ok",children:[v.filter(e=>e.accepted_at&&!e.revoked_at).length," accepted"]})]})]})}),a.jsx("div",{className:"tab-bar",role:"tablist",children:h.map(({id:e,label:t})=>(0,a.jsxs)("button",{role:"tab","aria-selected":s===e,className:`tab${s===e?" active":""}`,onClick:()=>p(e),style:{position:"relative"},children:[t,"waitlist"===e&&eL>0&&a.jsx("span",{className:"badge badge-warn",style:{marginLeft:6,fontSize:"0.65rem",padding:"1px 6px"},children:eL}),s===e&&a.jsx(c.E.div,{layoutId:"activeTabIndicator",style:{position:"absolute",bottom:-2,left:0,right:0,height:2,backgroundColor:"var(--brand)",borderRadius:"2px 2px 0 0"},transition:{type:"spring",stiffness:300,damping:30}})]},e))}),(0,a.jsxs)(m.M,{mode:"wait",children:["waitlist"===s&&(0,a.jsxs)(c.E.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"card",children:[(0,a.jsxs)("div",{className:"row spread",style:{marginBottom:12},children:[(0,a.jsxs)("h2",{style:{margin:0},children:["Waitlist",a.jsx("span",{className:"badge badge-brand",style:{marginLeft:8,verticalAlign:"middle"},children:eN.length})]}),(0,a.jsxs)("div",{className:"row",style:{gap:8},children:[a.jsx("input",{placeholder:"Filter by email…",value:R,onChange:e=>ev(e.target.value),style:{maxWidth:220},"aria-label":"Filter waitlist by email"}),(0,a.jsxs)("select",{value:T,onChange:e=>{z(e.target.value),ex(1)},style:{width:140},"aria-label":"Filter waitlist by status",children:[a.jsx("option",{value:"all",children:"all"}),a.jsx("option",{value:"pending",children:"pending"}),a.jsx("option",{value:"approved",children:"approved"}),a.jsx("option",{value:"rejected",children:"rejected"})]})]})]}),a.jsx("div",{className:"table-wrap",children:(0,a.jsxs)("table",{children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"Email"}),a.jsx("th",{children:"Status"}),a.jsx("th",{children:"Submitted"}),a.jsx("th",{children:"Notes"}),a.jsx("th",{children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[0===eN.length&&a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center",color:"var(--muted)",padding:20},children:R?"No entries match.":"Waitlist is empty."})}),ek.map(e=>(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"mono",children:e.email}),a.jsx("td",{children:a.jsx(u,{status:e.status})}),a.jsx("td",{className:"muted",style:{fontSize:"0.8rem"},children:new Date(e.created_at).toLocaleDateString()}),a.jsx("td",{className:"muted",style:{fontSize:"0.82rem"},children:e.notes||"—"}),a.jsx("td",{children:"pending"===e.status&&(0,a.jsxs)("div",{className:"td-actions",children:[a.jsx("button",{className:"btn primary sm",onClick:()=>ei(e.id,e.email),children:"Approve"}),a.jsx("button",{className:"btn danger sm",onClick:()=>en(e.id,e.email),children:"Reject"})]})})]},e.id))]})]})}),a.jsx(x,{total:eN.length,page:ep,pageSize:20,onPage:ex})]},"waitlist"),"invites"===s&&(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"stack-lg",children:[(0,a.jsxs)("section",{className:"card",children:[a.jsx("h2",{style:{marginBottom:14},children:"Send invitation"}),(0,a.jsxs)("form",{onSubmit:el,className:"grid-2",style:{alignItems:"end"},children:[(0,a.jsxs)("div",{className:"field",children:[a.jsx("label",{htmlFor:"inv-email",children:"Email address"}),a.jsx("input",{id:"inv-email",type:"email",required:!0,placeholder:"user@company.com",value:k,onChange:e=>C(e.target.value),disabled:L})]}),(0,a.jsxs)("div",{className:"field",children:[(0,a.jsxs)("label",{htmlFor:"inv-notes",children:["Notes ",a.jsx("span",{className:"muted",children:"(optional)"})]}),a.jsx("input",{id:"inv-notes",placeholder:"e.g. From waitlist, referral",value:$,onChange:e=>P(e.target.value),disabled:L})]}),a.jsx("div",{style:{paddingBottom:1},children:(0,a.jsxs)("button",{type:"submit",className:"btn primary",disabled:L||!k.trim(),"aria-busy":L,children:[L&&a.jsx("span",{className:"spinner"}),L?"Sending…":"Send invite"]})})]})]}),(0,a.jsxs)("section",{className:"card",children:[(0,a.jsxs)("div",{className:"row spread",style:{marginBottom:12},children:[(0,a.jsxs)("h2",{style:{margin:0},children:["Invitations",a.jsx("span",{className:"badge badge-brand",style:{marginLeft:8,verticalAlign:"middle"},children:eS.length})]}),(0,a.jsxs)("div",{className:"row",style:{gap:8},children:[a.jsx("input",{placeholder:"Filter by email…",value:M,onChange:e=>ef(e.target.value),style:{maxWidth:220},"aria-label":"Filter invitations by email"}),(0,a.jsxs)("select",{value:I,onChange:e=>{D(e.target.value),ej(1)},style:{width:140},"aria-label":"Filter invitations by status",children:[a.jsx("option",{value:"all",children:"all"}),a.jsx("option",{value:"pending",children:"pending"}),a.jsx("option",{value:"accepted",children:"accepted"}),a.jsx("option",{value:"revoked",children:"revoked"})]})]})]}),a.jsx("div",{className:"table-wrap",children:(0,a.jsxs)("table",{children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"Email"}),a.jsx("th",{children:"Status"}),a.jsx("th",{children:"Expires"}),a.jsx("th",{children:"Notes"}),a.jsx("th",{})]})}),(0,a.jsxs)("tbody",{children:[0===eS.length&&a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center",color:"var(--muted)",padding:20},children:"No invitations found."})}),eC.map(e=>(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"mono",children:e.email}),a.jsx("td",{children:a.jsx(u,{status:e.revoked_at?"revoked":e.accepted_at?"accepted":"pending"})}),a.jsx("td",{className:"muted",style:{fontSize:"0.8rem"},children:new Date(e.expires_at).toLocaleDateString()}),a.jsx("td",{className:"muted",style:{fontSize:"0.82rem"},children:e.notes||"—"}),a.jsx("td",{children:!e.revoked_at&&!e.accepted_at&&a.jsx("button",{className:"btn danger sm",onClick:()=>er(e.id,e.email),children:"Revoke"})})]},e.id))]})]})}),a.jsx(x,{total:eS.length,page:eg,pageSize:20,onPage:ej})]})]},"invites"),"users"===s&&(0,a.jsxs)(c.E.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"card",children:[(0,a.jsxs)("div",{className:"row spread",style:{marginBottom:12},children:[(0,a.jsxs)("h2",{style:{margin:0},children:["Users",a.jsx("span",{className:"badge badge-brand",style:{marginLeft:8,verticalAlign:"middle"},children:e_.length})]}),(0,a.jsxs)("div",{className:"row",style:{gap:8},children:[a.jsx("input",{placeholder:"Filter by email…",value:F,onChange:e=>ew(e.target.value),style:{maxWidth:220},"aria-label":"Filter users by email"}),(0,a.jsxs)("select",{value:W,onChange:e=>{B(e.target.value),eb(1)},style:{width:140},"aria-label":"Filter users by status",children:[a.jsx("option",{value:"all",children:"all"}),a.jsx("option",{value:"active",children:"active"}),a.jsx("option",{value:"disabled",children:"disabled"}),a.jsx("option",{value:"admin",children:"admin"}),a.jsx("option",{value:"unlimited",children:"unlimited"})]})]})]}),a.jsx("div",{className:"table-wrap",children:(0,a.jsxs)("table",{children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"Email"}),a.jsx("th",{children:"Roles"}),a.jsx("th",{children:"Last login"}),a.jsx("th",{children:"Status"}),a.jsx("th",{children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[0===e_.length&&a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center",color:"var(--muted)",padding:20},children:"No users found."})}),e$.map(e=>{let t=Q[e.id],s=void 0!==t;return(0,a.jsxs)(n().Fragment,{children:[(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"mono",children:e.email}),(0,a.jsxs)("td",{style:{whiteSpace:"nowrap"},children:[e.is_admin&&a.jsx("span",{className:"badge badge-brand",style:{marginRight:4},children:"admin"}),e.is_unlimited&&a.jsx("span",{className:"badge badge-ok",title:"No daily usage limits",children:"∞ unlimited"}),!e.is_admin&&!e.is_unlimited&&a.jsx("span",{className:"muted",children:"—"})]}),a.jsx("td",{className:"muted",style:{fontSize:"0.8rem"},children:e.last_login_at?new Date(e.last_login_at).toLocaleDateString():"never"}),a.jsx("td",{children:a.jsx(u,{status:e.is_disabled?"disabled":"active"})}),a.jsx("td",{children:(0,a.jsxs)("div",{className:"td-actions",style:{flexWrap:"wrap"},children:[a.jsx("button",{className:"btn secondary sm",onClick:()=>ed(e.id,!e.is_disabled),children:e.is_disabled?"Enable":"Disable"}),a.jsx("button",{className:"btn secondary sm",onClick:()=>eo(e.id,e.email),children:"Revoke sessions"}),a.jsx("button",{className:`btn sm ${e.is_admin?"danger":"secondary"}`,onClick:()=>ec(e.id,e.email,!e.is_admin),title:e.is_admin?"Remove admin privileges":"Grant admin privileges",children:e.is_admin?"Revoke admin":"Grant admin"}),a.jsx("button",{className:`btn sm ${e.is_unlimited?"danger":"secondary"}`,onClick:()=>em(e.id,!e.is_unlimited),title:e.is_unlimited?"Remove unlimited limits bypass":"Remove all daily usage limits for this user",children:e.is_unlimited?"Set limited":"Set unlimited"}),a.jsx("button",{className:"btn secondary sm",onClick:()=>s?Z(t=>{let s={...t};return delete s[e.id],s}):eh(e.id),title:"Toggle usage stats",children:ee[e.id]?"Loading…":s?"Hide stats":"Stats"})]})})]}),s&&a.jsx("tr",{style:{background:"var(--panel-2)"},children:a.jsx("td",{colSpan:5,style:{padding:"6px 12px 10px 12px"},children:(0,a.jsxs)("div",{style:{display:"flex",gap:"1.5rem",fontSize:"0.82rem",color:"var(--ink-2)",flexWrap:"wrap"},children:[(0,a.jsxs)("span",{children:["Total memories: ",a.jsx("strong",{style:{color:"var(--brand)"},children:t.memory_count})]}),(0,a.jsxs)("span",{children:["Today memories: ",a.jsx("strong",{children:t.today_memories})]}),(0,a.jsxs)("span",{children:["Today recalls: ",a.jsx("strong",{children:t.today_recalls})]}),(0,a.jsxs)("span",{children:["Today projects: ",a.jsx("strong",{children:t.today_projects})]})]})})})]},e.id)})]})]})}),a.jsx(x,{total:e_.length,page:ey,pageSize:20,onPage:eb})]},"users"),"login-ips"===s&&(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"stack-lg",children:[(0,a.jsxs)("section",{className:"card",children:[a.jsx("h2",{style:{marginBottom:8},children:"Login IP History"}),a.jsx("p",{className:"muted",style:{marginBottom:16,fontSize:"0.88rem"},children:"Select a user to view their last 10 login IP addresses and timestamps. IPs are stored verbatim — no tokens, cookies, or secrets are shown."}),a.jsx("div",{className:"table-wrap",children:(0,a.jsxs)("table",{children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"Email"}),a.jsx("th",{children:"Last login"}),a.jsx("th",{children:"Status"}),a.jsx("th",{})]})}),(0,a.jsxs)("tbody",{children:[0===w.length&&a.jsx("tr",{children:a.jsx("td",{colSpan:4,style:{textAlign:"center",color:"var(--muted)",padding:20},children:"No users found."})}),w.map(e=>(0,a.jsxs)("tr",{style:q===e.id?{background:"var(--panel-2)"}:{},children:[a.jsx("td",{className:"mono",children:e.email}),a.jsx("td",{className:"muted",style:{fontSize:"0.8rem"},children:e.last_login_at?new Date(e.last_login_at).toLocaleString():"never"}),a.jsx("td",{children:a.jsx(u,{status:e.is_disabled?"disabled":"active"})}),a.jsx("td",{children:a.jsx("button",{className:`btn sm ${q===e.id?"primary":"secondary"}`,onClick:()=>eu(e.id,e.email),"aria-pressed":q===e.id,children:q===e.id?"Viewing":"View IPs"})})]},e.id))]})]})})]}),null!==q&&(0,a.jsxs)("section",{className:"card",children:[(0,a.jsxs)("div",{className:"row spread",style:{marginBottom:12},children:[(0,a.jsxs)("h3",{style:{margin:0},children:["Login events for"," ",a.jsx("span",{className:"mono",style:{fontSize:"0.9em"},children:H})]}),a.jsx("button",{className:"btn secondary sm",onClick:()=>eu(q,H),disabled:J,children:J?"Loading…":"Refresh"})]}),J?a.jsx("p",{className:"muted",children:"Loading…"}):0===X.length?a.jsx("p",{className:"muted",children:"No login events recorded for this user."}):a.jsx("div",{className:"table-wrap",children:(0,a.jsxs)("table",{children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"#"}),a.jsx("th",{children:"IP Address"}),a.jsx("th",{children:"Date & Time (UTC)"}),a.jsx("th",{children:"User Agent"})]})}),a.jsx("tbody",{children:X.map((e,t)=>(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"muted",style:{fontSize:"0.8rem"},children:t+1}),a.jsx("td",{className:"mono",style:{fontSize:"0.88rem"},children:e.ip}),a.jsx("td",{className:"muted",style:{fontSize:"0.8rem"},children:new Date(e.created_at).toUTCString()}),a.jsx("td",{className:"muted",style:{fontSize:"0.75rem",maxWidth:280,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:e.user_agent||"",children:e.user_agent||"—"})]},e.id))})]})}),a.jsx("p",{className:"muted",style:{fontSize:"0.75rem",marginTop:10},children:"Showing up to 10 most recent login events. Older records are automatically deleted."})]})]},"login-ips"),"usage"===s&&(0,a.jsxs)(c.E.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"card",children:[a.jsx("h2",{style:{marginBottom:16},children:"Usage — last 30 days"}),0===S.length?a.jsx("p",{className:"muted",children:"No usage events recorded yet."}):a.jsx("div",{className:"usage-chart",children:S.map((e,t)=>(0,a.jsxs)("div",{className:"usage-bar-row",children:[a.jsx("span",{className:"usage-bar-label",title:`${e.date} \xb7 ${e.event_type}`,children:e.event_type}),a.jsx("div",{className:"usage-bar-track","aria-label":`${e.count} events`,children:a.jsx("div",{className:"usage-bar-fill",style:{width:`${Math.round(e.count/eP*100)}%`}})}),a.jsx("span",{className:"usage-bar-count",children:e.count})]},`${e.date}-${t}`))})]},"usage")]})]})}function x({total:e,page:t,pageSize:s,onPage:i}){let n=Math.ceil(e/s);if(n<=1)return null;let l=Math.min(t*s,e);return(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:12,marginTop:8,borderTop:"1px solid var(--line)",fontSize:"0.8rem",color:"var(--ink-2)"},children:[(0,a.jsxs)("span",{children:[(t-1)*s+1,"–",l," of ",e]}),(0,a.jsxs)("div",{style:{display:"flex",gap:4},children:[a.jsx("button",{className:"btn ghost sm",disabled:t<=1,onClick:()=>i(1),title:"First page",style:{padding:"2px 8px"},children:"\xab"}),a.jsx("button",{className:"btn ghost sm",disabled:t<=1,onClick:()=>i(t-1),title:"Previous page",style:{padding:"2px 8px"},children:"‹"}),(0,a.jsxs)("span",{style:{padding:"2px 8px",color:"var(--ink)",fontWeight:600},children:[t," / ",n]}),a.jsx("button",{className:"btn ghost sm",disabled:t>=n,onClick:()=>i(t+1),title:"Next page",style:{padding:"2px 8px"},children:"›"}),a.jsx("button",{className:"btn ghost sm",disabled:t>=n,onClick:()=>i(n),title:"Last page",style:{padding:"2px 8px"},children:"\xbb"})]})]})}},874:(e,t,s)=>{"use strict";s.d(t,{A:()=>n,O:()=>i});var a=s(326);function i({height:e="1rem",width:t="100%",radius:s="8px",className:i=""}){return a.jsx("div",{className:`skeleton ${i}`,style:{height:e,width:t,borderRadius:s},"aria-hidden":"true"})}function n({rows:e=3}){return(0,a.jsxs)("div",{className:"card","aria-busy":"true","aria-label":"Loading…",children:[a.jsx(i,{height:"1.1rem",width:"40%",radius:"6px"}),a.jsx("div",{style:{marginTop:12,display:"grid",gap:8},children:Array.from({length:e}).map((t,s)=>a.jsx(i,{height:"0.85rem",width:s===e-1?"70%":"100%"},s))})]})}},4305:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(8570).createProxy)(String.raw`/Users/nd/Documents/contextcache/web/app/admin/page.js#default`)},9086:(e,t,s)=>{"use strict";s.d(t,{M:()=>b});var a=s(326),i=s(7577),n=s(339),l=s(4749),r=s(2482),d=s(295),o=s(9539),c=s(3965);function m(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}class h extends i.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent&&!1!==this.props.pop){let e=t.offsetParent,s=(0,o.R)(e)&&e.offsetWidth||0,a=(0,o.R)(e)&&e.offsetHeight||0,i=this.props.sizeRef.current;i.height=t.offsetHeight||0,i.width=t.offsetWidth||0,i.top=t.offsetTop,i.left=t.offsetLeft,i.right=s-i.width-i.left,i.bottom=a-i.height-i.top}return null}componentDidUpdate(){}render(){return this.props.children}}function u({children:e,isPresent:t,anchorX:s,anchorY:n,root:l,pop:r}){let d=(0,i.useId)(),o=(0,i.useRef)(null),u=(0,i.useRef)({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:p}=(0,i.useContext)(c._),x=function(...e){return i.useCallback(function(...e){return t=>{let s=!1,a=e.map(e=>{let a=m(e,t);return s||"function"!=typeof a||(s=!0),a});if(s)return()=>{for(let t=0;t<a.length;t++){let s=a[t];"function"==typeof s?s():m(e[t],null)}}}}(...e),e)}(o,e.props?.ref??e?.ref);return(0,i.useInsertionEffect)(()=>{let{width:e,height:a,top:i,left:c,right:m,bottom:h}=u.current;if(t||!1===r||!o.current||!e||!a)return;let x="left"===s?`left: ${c}`:`right: ${m}`,g="bottom"===n?`bottom: ${h}`:`top: ${i}`;o.current.dataset.motionPopId=d;let j=document.createElement("style");p&&(j.nonce=p);let y=l??document.head;return y.appendChild(j),j.sheet&&j.sheet.insertRule(`
          [data-motion-pop-id="${d}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${a}px !important;
            ${x}px !important;
            ${g}px !important;
          }
        `),()=>{y.contains(j)&&y.removeChild(j)}},[t]),(0,a.jsx)(h,{isPresent:t,childRef:o,sizeRef:u,pop:r,children:!1===r?e:i.cloneElement(e,{ref:x})})}let p=({children:e,initial:t,isPresent:s,onExitComplete:n,custom:r,presenceAffectsLayout:o,mode:c,anchorX:m,anchorY:h,root:p})=>{let g=(0,l.h)(x),j=(0,i.useId)(),y=!0,b=(0,i.useMemo)(()=>(y=!1,{id:j,initial:t,isPresent:s,custom:r,onExitComplete:e=>{for(let t of(g.set(e,!0),g.values()))if(!t)return;n&&n()},register:e=>(g.set(e,!1),()=>g.delete(e))}),[s,g,n]);return o&&y&&(b={...b}),(0,i.useMemo)(()=>{g.forEach((e,t)=>g.set(t,!1))},[s]),i.useEffect(()=>{s||g.size||!n||n()},[s]),e=(0,a.jsx)(u,{pop:"popLayout"===c,isPresent:s,anchorX:m,anchorY:h,root:p,children:e}),(0,a.jsx)(d.O.Provider,{value:b,children:e})};function x(){return new Map}var g=s(6933);let j=e=>e.key||"";function y(e){let t=[];return i.Children.forEach(e,e=>{(0,i.isValidElement)(e)&&t.push(e)}),t}let b=({children:e,custom:t,initial:s=!0,onExitComplete:d,presenceAffectsLayout:o=!0,mode:c="sync",propagate:m=!1,anchorX:h="left",anchorY:u="top",root:x})=>{let[b,v]=(0,g.oO)(m),f=(0,i.useMemo)(()=>y(e),[e]),w=m&&!b?[]:f.map(j),N=(0,i.useRef)(!0),S=(0,i.useRef)(f),_=(0,l.h)(()=>new Map),k=(0,i.useRef)(new Set),[C,$]=(0,i.useState)(f),[P,L]=(0,i.useState)(f);(0,r.L)(()=>{N.current=!1,S.current=f;for(let e=0;e<P.length;e++){let t=j(P[e]);w.includes(t)?(_.delete(t),k.current.delete(t)):!0!==_.get(t)&&_.set(t,!1)}},[P,w.length,w.join("-")]);let E=[];if(f!==C){let e=[...f];for(let t=0;t<P.length;t++){let s=P[t],a=j(s);w.includes(a)||(e.splice(t,0,s),E.push(s))}return"wait"===c&&E.length&&(e=E),L(y(e)),$(f),null}let{forceRender:R}=(0,i.useContext)(n.p);return(0,a.jsx)(a.Fragment,{children:P.map(e=>{let i=j(e),n=(!m||!!b)&&(f===P||w.includes(i));return(0,a.jsx)(p,{isPresent:n,initial:(!N.current||!!s)&&void 0,custom:t,presenceAffectsLayout:o,mode:c,root:x,onExitComplete:n?void 0:()=>{if(k.current.has(i)||(k.current.add(i),!_.has(i)))return;_.set(i,!0);let e=!0;_.forEach(t=>{t||(e=!1)}),e&&(R?.(),L(S.current),m&&v?.(),d&&d())},anchorX:h,anchorY:u,children:e},i)})})}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[62,240],()=>s(5181));module.exports=a})();