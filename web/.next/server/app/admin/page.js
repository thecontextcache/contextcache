(()=>{var e={};e.id=3,e.ids=[3],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5181:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.Z,__next_app__:()=>m,originalPathname:()=>o,pages:()=>c,routeModule:()=>h,tree:()=>d}),t(4305),t(9889),t(2001),t(784),t(1888);var a=t(3191),i=t(8716),n=t(7506),l=t(5231),r={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(r[e]=()=>l[e]);t.d(s,r);let d=["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,4305)),"/Users/nd/Documents/contextcache/web/app/admin/page.js"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,9889)),"/Users/nd/Documents/contextcache/web/app/layout.js"],template:[()=>Promise.resolve().then(t.bind(t,2001)),"/Users/nd/Documents/contextcache/web/app/template.js"],error:[()=>Promise.resolve().then(t.bind(t,784)),"/Users/nd/Documents/contextcache/web/app/error.js"],"not-found":[()=>Promise.resolve().then(t.bind(t,1888)),"/Users/nd/Documents/contextcache/web/app/not-found.js"]}],c=["/Users/nd/Documents/contextcache/web/app/admin/page.js"],o="/admin/page",m={require:t,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},8100:(e,s,t)=>{Promise.resolve().then(t.bind(t,7072))},7072:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>x,dynamic:()=>h});var a=t(326),i=t(7577),n=t.n(i),l=t(5047),r=t(1207),d=t(9776),c=t(874),o=t(4846),m=t(8129);let h="force-dynamic",u=[{id:"waitlist",label:"Waitlist"},{id:"invites",label:"Invites"},{id:"users",label:"Users"},{id:"login-ips",label:"Login IPs"},{id:"usage",label:"Usage"}];function p({status:e}){return a.jsx("span",{className:`badge ${{pending:"badge-warn",approved:"badge-ok",rejected:"badge-danger",active:"badge-ok",disabled:"badge-danger",accepted:"badge-ok",revoked:"badge-danger"}[e]||"badge-brand"}`,children:e})}function x(){let e=(0,l.useRouter)(),s=(0,d.p)(),[t,h]=(0,i.useState)("waitlist"),[x,j]=(0,i.useState)(!1),[y,b]=(0,i.useState)(!0),[v,f]=(0,i.useState)([]),[w,S]=(0,i.useState)([]),[N,k]=(0,i.useState)([]),[_,C]=(0,i.useState)([]),[P,$]=(0,i.useState)(""),[L,E]=(0,i.useState)(""),[A,M]=(0,i.useState)(!1),[T,z]=(0,i.useState)(""),[R,U]=(0,i.useState)("all"),[D,I]=(0,i.useState)(""),[F,O]=(0,i.useState)("all"),[W,B]=(0,i.useState)(""),[q,G]=(0,i.useState)("all"),[H,V]=(0,i.useState)(null),[J,X]=(0,i.useState)(""),[Z,K]=(0,i.useState)([]),[Q,Y]=(0,i.useState)(!1),[ee,es]=(0,i.useState)({}),[et,ea]=(0,i.useState)({});function ei(t){if(t instanceof r.MS){if("auth"===t.kind){e.replace("/auth?reason=expired");return}if("forbidden"===t.kind){e.replace("/app");return}}s.error(t.message||"Something went wrong.")}async function en(){b(!0);try{if(!(await (0,r.SC)("/auth/me")).is_admin){e.replace("/app");return}j(!0)}catch(e){ei(e),e instanceof r.MS&&("auth"===e.kind||"forbidden"===e.kind)||b(!1);return}let[t,a,i,n]=await Promise.allSettled([(0,r.SC)("/admin/waitlist"),(0,r.SC)("/admin/invites"),(0,r.SC)("/admin/users"),(0,r.SC)("/admin/usage")]);"fulfilled"===t.status?f(t.value):s.error(`Waitlist: ${t.reason?.message||"failed to load"}`),"fulfilled"===a.status?S(a.value):s.error(`Invites: ${a.reason?.message||"failed to load"}`),"fulfilled"===i.status?k(i.value):s.error(`Users: ${i.reason?.message||"failed to load"}`),"fulfilled"===n.status?C(n.value):s.error(`Usage: ${n.reason?.message||"failed to load"}`),b(!1)}async function el(e,t){try{await (0,r.SC)(`/admin/waitlist/${e}/approve`,{method:"POST"}),s.success(`${t} approved — invite created.`),await en()}catch(e){ei(e)}}async function er(e,t){try{await (0,r.SC)(`/admin/waitlist/${e}/reject`,{method:"POST"}),s.info(`${t} rejected.`),await en()}catch(e){ei(e)}}async function ed(e){if(e.preventDefault(),!A){M(!0);try{await (0,r.SC)("/admin/invites",{method:"POST",body:JSON.stringify({email:P.trim(),notes:L})}),s.success(`Invite sent to ${P.trim()}`),$(""),E(""),await en()}catch(e){ei(e)}finally{M(!1)}}}async function ec(e,t){try{await (0,r.SC)(`/admin/invites/${e}/revoke`,{method:"POST"}),s.success(`Invite for ${t} revoked.`),await en()}catch(e){ei(e)}}async function eo(e,t){try{await (0,r.SC)(`/admin/users/${e}/${t?"disable":"enable"}`,{method:"POST"}),s.success(t?"User disabled.":"User enabled."),await en()}catch(e){ei(e)}}async function em(e,t){try{await (0,r.SC)(`/admin/users/${e}/revoke-sessions`,{method:"POST"}),s.success(`Sessions for ${t} revoked.`),await en()}catch(e){ei(e)}}async function eh(e,t,a){try{await (0,r.SC)(`/admin/users/${e}/${a?"grant-admin":"revoke-admin"}`,{method:"POST"}),s.success(`${t} ${a?"granted":"revoked"} admin.`),await en()}catch(e){ei(e)}}async function eu(e,t){try{await (0,r.SC)(`/admin/users/${e}/set-unlimited?unlimited=${t}`,{method:"POST"}),s.success(t?"User marked as unlimited.":"Unlimited removed."),await en()}catch(e){ei(e)}}async function ep(e){ea(s=>({...s,[e]:!0}));try{let s=await (0,r.SC)(`/admin/users/${e}/stats`);es(t=>({...t,[e]:s}))}catch(e){s.error(`Stats: ${e.message||"failed"}`)}finally{ea(s=>({...s,[e]:!1}))}}async function ex(e,t){V(e),X(t),Y(!0),K([]);try{let s=await (0,r.SC)(`/admin/users/${e}/login-events`);K(s||[])}catch(e){s.error(`Login IPs: ${e.message||"failed to load"}`)}finally{Y(!1)}}let[eg,ej]=(0,i.useState)(1),[ey,eb]=(0,i.useState)(1),[ev,ef]=(0,i.useState)(1),ew=(0,i.useCallback)(e=>{z(e),ej(1)},[]),eS=(0,i.useCallback)(e=>{I(e),eb(1)},[]),eN=(0,i.useCallback)(e=>{B(e),ef(1)},[]),ek=(0,i.useMemo)(()=>v.filter(e=>{let s=!T||e.email.toLowerCase().includes(T.toLowerCase()),t="all"===R||e.status===R;return s&&t}),[v,T,R]),e_=(0,i.useMemo)(()=>w.filter(e=>{let s=!D||e.email.toLowerCase().includes(D.toLowerCase()),t=e.revoked_at?"revoked":e.accepted_at?"accepted":"pending",a="all"===F||t===F;return s&&a}),[w,D,F]),eC=(0,i.useMemo)(()=>N.filter(e=>{let s=!W||e.email.toLowerCase().includes(W.toLowerCase());return"all"===q?s:"disabled"===q?s&&e.is_disabled:"active"===q?s&&!e.is_disabled:"admin"===q?s&&e.is_admin:"unlimited"===q?s&&e.is_unlimited:s}),[N,W,q]),eP=(0,i.useMemo)(()=>ek.slice((eg-1)*20,20*eg),[ek,eg]),e$=(0,i.useMemo)(()=>e_.slice((ey-1)*20,20*ey),[e_,ey]),eL=(0,i.useMemo)(()=>eC.slice((ev-1)*20,20*ev),[eC,ev]),eE=Math.max(..._.map(e=>e.count||0),1),eA=v.filter(e=>"pending"===e.status).length;return y||!x?(0,a.jsxs)("div",{className:"stack-lg",children:[a.jsx(c.A,{rows:2}),a.jsx(c.A,{rows:5}),a.jsx(c.A,{rows:5})]}):(0,a.jsxs)("div",{className:"stack-lg",children:[a.jsx("section",{className:"card",children:(0,a.jsxs)("div",{className:"row spread",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"row",style:{gap:8,marginBottom:4},children:[a.jsx("h1",{style:{margin:0,fontSize:"1.4rem"},children:"Admin"}),a.jsx("span",{className:"badge badge-warn",children:"Alpha controls"})]}),a.jsx("p",{className:"muted",children:"Manage waitlist, invitations, users, and usage."})]}),(0,a.jsxs)("div",{className:"row",style:{flexWrap:"wrap",gap:6},children:[eA>0&&(0,a.jsxs)("span",{className:"badge badge-warn",children:[eA," pending"]}),(0,a.jsxs)("span",{className:"badge badge-brand",children:[N.length," users"]}),(0,a.jsxs)("span",{className:"badge badge-ok",children:[w.filter(e=>e.accepted_at&&!e.revoked_at).length," accepted"]})]})]})}),a.jsx("div",{className:"tab-bar",role:"tablist",children:u.map(({id:e,label:s})=>(0,a.jsxs)("button",{role:"tab","aria-selected":t===e,className:`tab${t===e?" active":""}`,onClick:()=>h(e),style:{position:"relative"},children:[s,"waitlist"===e&&eA>0&&a.jsx("span",{className:"badge badge-warn",style:{marginLeft:6,fontSize:"0.65rem",padding:"1px 6px"},children:eA}),t===e&&a.jsx(o.E.div,{layoutId:"activeTabIndicator",style:{position:"absolute",bottom:-2,left:0,right:0,height:2,backgroundColor:"var(--brand)",borderRadius:"2px 2px 0 0"},transition:{type:"spring",stiffness:300,damping:30}})]},e))}),(0,a.jsxs)(m.M,{mode:"wait",children:["waitlist"===t&&(0,a.jsxs)(o.E.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"card",children:[(0,a.jsxs)("div",{className:"row spread",style:{marginBottom:12},children:[(0,a.jsxs)("h2",{style:{margin:0},children:["Waitlist",a.jsx("span",{className:"badge badge-brand",style:{marginLeft:8,verticalAlign:"middle"},children:ek.length})]}),(0,a.jsxs)("div",{className:"row",style:{gap:8},children:[a.jsx("input",{placeholder:"Filter by email…",value:T,onChange:e=>ew(e.target.value),style:{maxWidth:220},"aria-label":"Filter waitlist by email"}),(0,a.jsxs)("select",{value:R,onChange:e=>{U(e.target.value),ej(1)},style:{width:140},"aria-label":"Filter waitlist by status",children:[a.jsx("option",{value:"all",children:"all"}),a.jsx("option",{value:"pending",children:"pending"}),a.jsx("option",{value:"approved",children:"approved"}),a.jsx("option",{value:"rejected",children:"rejected"})]})]})]}),a.jsx("div",{className:"table-wrap",children:(0,a.jsxs)("table",{children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"Email"}),a.jsx("th",{children:"Status"}),a.jsx("th",{children:"Submitted"}),a.jsx("th",{children:"Notes"}),a.jsx("th",{children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[0===ek.length&&a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center",color:"var(--muted)",padding:20},children:T?"No entries match.":"Waitlist is empty."})}),eP.map(e=>(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"mono",children:e.email}),a.jsx("td",{children:a.jsx(p,{status:e.status})}),a.jsx("td",{className:"muted",style:{fontSize:"0.8rem"},children:new Date(e.created_at).toLocaleDateString()}),a.jsx("td",{className:"muted",style:{fontSize:"0.82rem"},children:e.notes||"—"}),a.jsx("td",{children:"pending"===e.status&&(0,a.jsxs)("div",{className:"td-actions",children:[a.jsx("button",{className:"btn primary sm",onClick:()=>el(e.id,e.email),children:"Approve"}),a.jsx("button",{className:"btn danger sm",onClick:()=>er(e.id,e.email),children:"Reject"})]})})]},e.id))]})]})}),a.jsx(g,{total:ek.length,page:eg,pageSize:20,onPage:ej})]},"waitlist"),"invites"===t&&(0,a.jsxs)(o.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"stack-lg",children:[(0,a.jsxs)("section",{className:"card",children:[a.jsx("h2",{style:{marginBottom:14},children:"Send invitation"}),(0,a.jsxs)("form",{onSubmit:ed,className:"grid-2",style:{alignItems:"end"},children:[(0,a.jsxs)("div",{className:"field",children:[a.jsx("label",{htmlFor:"inv-email",children:"Email address"}),a.jsx("input",{id:"inv-email",type:"email",required:!0,placeholder:"user@company.com",value:P,onChange:e=>$(e.target.value),disabled:A})]}),(0,a.jsxs)("div",{className:"field",children:[(0,a.jsxs)("label",{htmlFor:"inv-notes",children:["Notes ",a.jsx("span",{className:"muted",children:"(optional)"})]}),a.jsx("input",{id:"inv-notes",placeholder:"e.g. From waitlist, referral",value:L,onChange:e=>E(e.target.value),disabled:A})]}),a.jsx("div",{style:{paddingBottom:1},children:(0,a.jsxs)("button",{type:"submit",className:"btn primary",disabled:A||!P.trim(),"aria-busy":A,children:[A&&a.jsx("span",{className:"spinner"}),A?"Sending…":"Send invite"]})})]})]}),(0,a.jsxs)("section",{className:"card",children:[(0,a.jsxs)("div",{className:"row spread",style:{marginBottom:12},children:[(0,a.jsxs)("h2",{style:{margin:0},children:["Invitations",a.jsx("span",{className:"badge badge-brand",style:{marginLeft:8,verticalAlign:"middle"},children:e_.length})]}),(0,a.jsxs)("div",{className:"row",style:{gap:8},children:[a.jsx("input",{placeholder:"Filter by email…",value:D,onChange:e=>eS(e.target.value),style:{maxWidth:220},"aria-label":"Filter invitations by email"}),(0,a.jsxs)("select",{value:F,onChange:e=>{O(e.target.value),eb(1)},style:{width:140},"aria-label":"Filter invitations by status",children:[a.jsx("option",{value:"all",children:"all"}),a.jsx("option",{value:"pending",children:"pending"}),a.jsx("option",{value:"accepted",children:"accepted"}),a.jsx("option",{value:"revoked",children:"revoked"})]})]})]}),a.jsx("div",{className:"table-wrap",children:(0,a.jsxs)("table",{children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"Email"}),a.jsx("th",{children:"Status"}),a.jsx("th",{children:"Expires"}),a.jsx("th",{children:"Notes"}),a.jsx("th",{})]})}),(0,a.jsxs)("tbody",{children:[0===e_.length&&a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center",color:"var(--muted)",padding:20},children:"No invitations found."})}),e$.map(e=>(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"mono",children:e.email}),a.jsx("td",{children:a.jsx(p,{status:e.revoked_at?"revoked":e.accepted_at?"accepted":"pending"})}),a.jsx("td",{className:"muted",style:{fontSize:"0.8rem"},children:new Date(e.expires_at).toLocaleDateString()}),a.jsx("td",{className:"muted",style:{fontSize:"0.82rem"},children:e.notes||"—"}),a.jsx("td",{children:!e.revoked_at&&!e.accepted_at&&a.jsx("button",{className:"btn danger sm",onClick:()=>ec(e.id,e.email),children:"Revoke"})})]},e.id))]})]})}),a.jsx(g,{total:e_.length,page:ey,pageSize:20,onPage:eb})]})]},"invites"),"users"===t&&(0,a.jsxs)(o.E.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"card",children:[(0,a.jsxs)("div",{className:"row spread",style:{marginBottom:12},children:[(0,a.jsxs)("h2",{style:{margin:0},children:["Users",a.jsx("span",{className:"badge badge-brand",style:{marginLeft:8,verticalAlign:"middle"},children:eC.length})]}),(0,a.jsxs)("div",{className:"row",style:{gap:8},children:[a.jsx("input",{placeholder:"Filter by email…",value:W,onChange:e=>eN(e.target.value),style:{maxWidth:220},"aria-label":"Filter users by email"}),(0,a.jsxs)("select",{value:q,onChange:e=>{G(e.target.value),ef(1)},style:{width:140},"aria-label":"Filter users by status",children:[a.jsx("option",{value:"all",children:"all"}),a.jsx("option",{value:"active",children:"active"}),a.jsx("option",{value:"disabled",children:"disabled"}),a.jsx("option",{value:"admin",children:"admin"}),a.jsx("option",{value:"unlimited",children:"unlimited"})]})]})]}),a.jsx("div",{className:"table-wrap",children:(0,a.jsxs)("table",{children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"Email"}),a.jsx("th",{children:"Roles"}),a.jsx("th",{children:"Last login"}),a.jsx("th",{children:"Status"}),a.jsx("th",{children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[0===eC.length&&a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center",color:"var(--muted)",padding:20},children:"No users found."})}),eL.map(e=>{let s=ee[e.id],t=void 0!==s;return(0,a.jsxs)(n().Fragment,{children:[(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"mono",children:e.email}),(0,a.jsxs)("td",{style:{whiteSpace:"nowrap"},children:[e.is_admin&&a.jsx("span",{className:"badge badge-brand",style:{marginRight:4},children:"admin"}),e.is_unlimited&&a.jsx("span",{className:"badge badge-ok",title:"No daily usage limits",children:"∞ unlimited"}),!e.is_admin&&!e.is_unlimited&&a.jsx("span",{className:"muted",children:"—"})]}),a.jsx("td",{className:"muted",style:{fontSize:"0.8rem"},children:e.last_login_at?new Date(e.last_login_at).toLocaleDateString():"never"}),a.jsx("td",{children:a.jsx(p,{status:e.is_disabled?"disabled":"active"})}),a.jsx("td",{children:(0,a.jsxs)("div",{className:"td-actions",style:{flexWrap:"wrap"},children:[a.jsx("button",{className:"btn secondary sm",onClick:()=>eo(e.id,!e.is_disabled),children:e.is_disabled?"Enable":"Disable"}),a.jsx("button",{className:"btn secondary sm",onClick:()=>em(e.id,e.email),children:"Revoke sessions"}),a.jsx("button",{className:`btn sm ${e.is_admin?"danger":"secondary"}`,onClick:()=>eh(e.id,e.email,!e.is_admin),title:e.is_admin?"Remove admin privileges":"Grant admin privileges",children:e.is_admin?"Revoke admin":"Grant admin"}),a.jsx("button",{className:`btn sm ${e.is_unlimited?"danger":"secondary"}`,onClick:()=>eu(e.id,!e.is_unlimited),title:e.is_unlimited?"Remove unlimited limits bypass":"Remove all daily usage limits for this user",children:e.is_unlimited?"Set limited":"Set unlimited"}),a.jsx("button",{className:"btn secondary sm",onClick:()=>t?es(s=>{let t={...s};return delete t[e.id],t}):ep(e.id),title:"Toggle usage stats",children:et[e.id]?"Loading…":t?"Hide stats":"Stats"})]})})]}),t&&a.jsx("tr",{style:{background:"var(--panel-2)"},children:a.jsx("td",{colSpan:5,style:{padding:"6px 12px 10px 12px"},children:(0,a.jsxs)("div",{style:{display:"flex",gap:"1.5rem",fontSize:"0.82rem",color:"var(--ink-2)",flexWrap:"wrap"},children:[(0,a.jsxs)("span",{children:["Total memories: ",a.jsx("strong",{style:{color:"var(--brand)"},children:s.memory_count})]}),(0,a.jsxs)("span",{children:["Today memories: ",a.jsx("strong",{children:s.today_memories})]}),(0,a.jsxs)("span",{children:["Today recalls: ",a.jsx("strong",{children:s.today_recalls})]}),(0,a.jsxs)("span",{children:["Today projects: ",a.jsx("strong",{children:s.today_projects})]})]})})})]},e.id)})]})]})}),a.jsx(g,{total:eC.length,page:ev,pageSize:20,onPage:ef})]},"users"),"login-ips"===t&&(0,a.jsxs)(o.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"stack-lg",children:[(0,a.jsxs)("section",{className:"card",children:[a.jsx("h2",{style:{marginBottom:8},children:"Login IP History"}),a.jsx("p",{className:"muted",style:{marginBottom:16,fontSize:"0.88rem"},children:"Select a user to view their last 10 login IP addresses and timestamps. IPs are stored verbatim — no tokens, cookies, or secrets are shown."}),a.jsx("div",{className:"table-wrap",children:(0,a.jsxs)("table",{children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"Email"}),a.jsx("th",{children:"Last login"}),a.jsx("th",{children:"Status"}),a.jsx("th",{})]})}),(0,a.jsxs)("tbody",{children:[0===N.length&&a.jsx("tr",{children:a.jsx("td",{colSpan:4,style:{textAlign:"center",color:"var(--muted)",padding:20},children:"No users found."})}),N.map(e=>(0,a.jsxs)("tr",{style:H===e.id?{background:"var(--panel-2)"}:{},children:[a.jsx("td",{className:"mono",children:e.email}),a.jsx("td",{className:"muted",style:{fontSize:"0.8rem"},children:e.last_login_at?new Date(e.last_login_at).toLocaleString():"never"}),a.jsx("td",{children:a.jsx(p,{status:e.is_disabled?"disabled":"active"})}),a.jsx("td",{children:a.jsx("button",{className:`btn sm ${H===e.id?"primary":"secondary"}`,onClick:()=>ex(e.id,e.email),"aria-pressed":H===e.id,children:H===e.id?"Viewing":"View IPs"})})]},e.id))]})]})})]}),null!==H&&(0,a.jsxs)("section",{className:"card",children:[(0,a.jsxs)("div",{className:"row spread",style:{marginBottom:12},children:[(0,a.jsxs)("h3",{style:{margin:0},children:["Login events for"," ",a.jsx("span",{className:"mono",style:{fontSize:"0.9em"},children:J})]}),a.jsx("button",{className:"btn secondary sm",onClick:()=>ex(H,J),disabled:Q,children:Q?"Loading…":"Refresh"})]}),Q?a.jsx("p",{className:"muted",children:"Loading…"}):0===Z.length?a.jsx("p",{className:"muted",children:"No login events recorded for this user."}):a.jsx("div",{className:"table-wrap",children:(0,a.jsxs)("table",{children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"#"}),a.jsx("th",{children:"IP Address"}),a.jsx("th",{children:"Date & Time (UTC)"}),a.jsx("th",{children:"User Agent"})]})}),a.jsx("tbody",{children:Z.map((e,s)=>(0,a.jsxs)("tr",{children:[a.jsx("td",{className:"muted",style:{fontSize:"0.8rem"},children:s+1}),a.jsx("td",{className:"mono",style:{fontSize:"0.88rem"},children:e.ip}),a.jsx("td",{className:"muted",style:{fontSize:"0.8rem"},children:new Date(e.created_at).toUTCString()}),a.jsx("td",{className:"muted",style:{fontSize:"0.75rem",maxWidth:280,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:e.user_agent||"",children:e.user_agent||"—"})]},e.id))})]})}),a.jsx("p",{className:"muted",style:{fontSize:"0.75rem",marginTop:10},children:"Showing up to 10 most recent login events. Older records are automatically deleted."})]})]},"login-ips"),"usage"===t&&(0,a.jsxs)(o.E.section,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"card",children:[a.jsx("h2",{style:{marginBottom:16},children:"Usage — last 30 days"}),0===_.length?a.jsx("p",{className:"muted",children:"No usage events recorded yet."}):a.jsx("div",{className:"usage-chart",children:_.map((e,s)=>(0,a.jsxs)("div",{className:"usage-bar-row",children:[a.jsx("span",{className:"usage-bar-label",title:`${e.date} \xb7 ${e.event_type}`,children:e.event_type}),a.jsx("div",{className:"usage-bar-track","aria-label":`${e.count} events`,children:a.jsx("div",{className:"usage-bar-fill",style:{width:`${Math.round(e.count/eE*100)}%`}})}),a.jsx("span",{className:"usage-bar-count",children:e.count})]},`${e.date}-${s}`))})]},"usage")]})]})}function g({total:e,page:s,pageSize:t,onPage:i}){let n=Math.ceil(e/t);if(n<=1)return null;let l=Math.min(s*t,e);return(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:12,marginTop:8,borderTop:"1px solid var(--line)",fontSize:"0.8rem",color:"var(--ink-2)"},children:[(0,a.jsxs)("span",{children:[(s-1)*t+1,"–",l," of ",e]}),(0,a.jsxs)("div",{style:{display:"flex",gap:4},children:[a.jsx("button",{className:"btn ghost sm",disabled:s<=1,onClick:()=>i(1),title:"First page",style:{padding:"2px 8px"},children:"\xab"}),a.jsx("button",{className:"btn ghost sm",disabled:s<=1,onClick:()=>i(s-1),title:"Previous page",style:{padding:"2px 8px"},children:"‹"}),(0,a.jsxs)("span",{style:{padding:"2px 8px",color:"var(--ink)",fontWeight:600},children:[s," / ",n]}),a.jsx("button",{className:"btn ghost sm",disabled:s>=n,onClick:()=>i(s+1),title:"Next page",style:{padding:"2px 8px"},children:"›"}),a.jsx("button",{className:"btn ghost sm",disabled:s>=n,onClick:()=>i(n),title:"Last page",style:{padding:"2px 8px"},children:"\xbb"})]})]})}},874:(e,s,t)=>{"use strict";t.d(s,{A:()=>n,O:()=>i});var a=t(326);function i({height:e="1rem",width:s="100%",radius:t="8px",className:i=""}){return a.jsx("div",{className:`skeleton ${i}`,style:{height:e,width:s,borderRadius:t},"aria-hidden":"true"})}function n({rows:e=3}){return(0,a.jsxs)("div",{className:"card","aria-busy":"true","aria-label":"Loading…",children:[a.jsx(i,{height:"1.1rem",width:"40%",radius:"6px"}),a.jsx("div",{style:{marginTop:12,display:"grid",gap:8},children:Array.from({length:e}).map((s,t)=>a.jsx(i,{height:"0.85rem",width:t===e-1?"70%":"100%"},t))})]})}},4305:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n,dynamic:()=>i});var a=t(8570);let i=(0,a.createProxy)(String.raw`/Users/nd/Documents/contextcache/web/app/admin/page.js#dynamic`),n=(0,a.createProxy)(String.raw`/Users/nd/Documents/contextcache/web/app/admin/page.js#default`)},8129:(e,s,t)=>{"use strict";t.d(s,{M:()=>j});var a=t(326),i=t(7577),n=t(339),l=t(4749),r=t(295),d=t(3965);class c extends i.Component{getSnapshotBeforeUpdate(e){let s=this.props.childRef.current;if(s&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=s.offsetHeight||0,e.width=s.offsetWidth||0,e.top=s.offsetTop,e.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function o({children:e,isPresent:s}){let t=(0,i.useId)(),n=(0,i.useRef)(null),l=(0,i.useRef)({width:0,height:0,top:0,left:0}),{nonce:r}=(0,i.useContext)(d._);return(0,i.useInsertionEffect)(()=>{let{width:e,height:a,top:i,left:d}=l.current;if(s||!n.current||!e||!a)return;n.current.dataset.motionPopId=t;let c=document.createElement("style");return r&&(c.nonce=r),document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${a}px !important;
            top: ${i}px !important;
            left: ${d}px !important;
          }
        `),()=>{document.head.removeChild(c)}},[s]),(0,a.jsx)(c,{isPresent:s,childRef:n,sizeRef:l,children:i.cloneElement(e,{ref:n})})}let m=({children:e,initial:s,isPresent:t,onExitComplete:n,custom:d,presenceAffectsLayout:c,mode:m})=>{let u=(0,l.h)(h),p=(0,i.useId)(),x=(0,i.useCallback)(e=>{for(let s of(u.set(e,!0),u.values()))if(!s)return;n&&n()},[u,n]),g=(0,i.useMemo)(()=>({id:p,initial:s,isPresent:t,custom:d,onExitComplete:x,register:e=>(u.set(e,!1),()=>u.delete(e))}),c?[Math.random(),x]:[t,x]);return(0,i.useMemo)(()=>{u.forEach((e,s)=>u.set(s,!1))},[t]),i.useEffect(()=>{t||u.size||!n||n()},[t]),"popLayout"===m&&(e=(0,a.jsx)(o,{isPresent:t,children:e})),(0,a.jsx)(r.O.Provider,{value:g,children:e})};function h(){return new Map}var u=t(6933);let p=e=>e.key||"";function x(e){let s=[];return i.Children.forEach(e,e=>{(0,i.isValidElement)(e)&&s.push(e)}),s}var g=t(2482);let j=({children:e,custom:s,initial:t=!0,onExitComplete:r,presenceAffectsLayout:d=!0,mode:c="sync",propagate:o=!1})=>{let[h,j]=(0,u.oO)(o),y=(0,i.useMemo)(()=>x(e),[e]),b=o&&!h?[]:y.map(p),v=(0,i.useRef)(!0),f=(0,i.useRef)(y),w=(0,l.h)(()=>new Map),[S,N]=(0,i.useState)(y),[k,_]=(0,i.useState)(y);(0,g.L)(()=>{v.current=!1,f.current=y;for(let e=0;e<k.length;e++){let s=p(k[e]);b.includes(s)?w.delete(s):!0!==w.get(s)&&w.set(s,!1)}},[k,b.length,b.join("-")]);let C=[];if(y!==S){let e=[...y];for(let s=0;s<k.length;s++){let t=k[s],a=p(t);b.includes(a)||(e.splice(s,0,t),C.push(t))}"wait"===c&&C.length&&(e=C),_(x(e)),N(y);return}let{forceRender:P}=(0,i.useContext)(n.p);return(0,a.jsx)(a.Fragment,{children:k.map(e=>{let i=p(e),n=(!o||!!h)&&(y===k||b.includes(i));return(0,a.jsx)(m,{isPresent:n,initial:(!v.current||!!t)&&void 0,custom:n?void 0:s,presenceAffectsLayout:d,mode:c,onExitComplete:n?void 0:()=>{if(!w.has(i))return;w.set(i,!0);let e=!0;w.forEach(s=>{s||(e=!1)}),e&&(null==P||P(),_(f.current),o&&(null==j||j()),r&&r())},children:e},i)})})}}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[276,397,733],()=>t(5181));module.exports=a})();