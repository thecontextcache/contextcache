(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{2751:function(e,t,s){Promise.resolve().then(s.bind(s,2598))},2598:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m},dynamic:function(){return c}});var a=s(7437),n=s(2265),i=s(9376),l=s(3113),r=s(5110),d=s(935);let c="force-dynamic",o=[{id:"waitlist",label:"Waitlist"},{id:"invites",label:"Invites"},{id:"users",label:"Users"},{id:"login-ips",label:"Login IPs"},{id:"usage",label:"Usage"}];function u(e){let{status:t}=e;return(0,a.jsx)("span",{className:"badge ".concat({pending:"badge-warn",approved:"badge-ok",rejected:"badge-danger",active:"badge-ok",disabled:"badge-danger",accepted:"badge-ok",revoked:"badge-danger"}[t]||"badge-brand"),children:t})}function m(){let e=(0,i.useRouter)(),t=(0,r.p)(),[s,c]=(0,n.useState)("waitlist"),[m,x]=(0,n.useState)(!1),[p,g]=(0,n.useState)(!0),[j,v]=(0,n.useState)([]),[f,b]=(0,n.useState)([]),[y,w]=(0,n.useState)([]),[N,S]=(0,n.useState)([]),[k,C]=(0,n.useState)(""),[_,T]=(0,n.useState)(""),[L,P]=(0,n.useState)(!1),[A,E]=(0,n.useState)(""),[z,O]=(0,n.useState)("all"),[R,I]=(0,n.useState)(""),[U,D]=(0,n.useState)("all"),[B,F]=(0,n.useState)(""),[M,W]=(0,n.useState)("all"),[X,q]=(0,n.useState)(null),[G,H]=(0,n.useState)(""),[V,J]=(0,n.useState)([]),[$,K]=(0,n.useState)(!1),[Q,Y]=(0,n.useState)({}),[Z,ee]=(0,n.useState)({});function et(s){if(s instanceof l.MS){if("auth"===s.kind){e.replace("/auth?reason=expired");return}if("forbidden"===s.kind){e.replace("/app");return}}t.error(s.message||"Something went wrong.")}async function es(){var s,a,n,i;g(!0);try{if(!(await (0,l.SC)("/auth/me")).is_admin){e.replace("/app");return}x(!0)}catch(e){et(e),e instanceof l.MS&&("auth"===e.kind||"forbidden"===e.kind)||g(!1);return}let[r,d,c,o]=await Promise.allSettled([(0,l.SC)("/admin/waitlist"),(0,l.SC)("/admin/invites"),(0,l.SC)("/admin/users"),(0,l.SC)("/admin/usage")]);"fulfilled"===r.status?v(r.value):t.error("Waitlist: ".concat((null===(s=r.reason)||void 0===s?void 0:s.message)||"failed to load")),"fulfilled"===d.status?b(d.value):t.error("Invites: ".concat((null===(a=d.reason)||void 0===a?void 0:a.message)||"failed to load")),"fulfilled"===c.status?w(c.value):t.error("Users: ".concat((null===(n=c.reason)||void 0===n?void 0:n.message)||"failed to load")),"fulfilled"===o.status?S(o.value):t.error("Usage: ".concat((null===(i=o.reason)||void 0===i?void 0:i.message)||"failed to load")),g(!1)}async function ea(e,s){try{await (0,l.SC)("/admin/waitlist/".concat(e,"/approve"),{method:"POST"}),t.success("".concat(s," approved — invite created.")),await es()}catch(e){et(e)}}async function en(e,s){try{await (0,l.SC)("/admin/waitlist/".concat(e,"/reject"),{method:"POST"}),t.info("".concat(s," rejected.")),await es()}catch(e){et(e)}}async function ei(e){if(e.preventDefault(),!L){P(!0);try{await (0,l.SC)("/admin/invites",{method:"POST",body:JSON.stringify({email:k.trim(),notes:_})}),t.success("Invite sent to ".concat(k.trim())),C(""),T(""),await es()}catch(e){et(e)}finally{P(!1)}}}async function el(e,s){try{await (0,l.SC)("/admin/invites/".concat(e,"/revoke"),{method:"POST"}),t.success("Invite for ".concat(s," revoked.")),await es()}catch(e){et(e)}}async function er(e,s){try{await (0,l.SC)("/admin/users/".concat(e,"/").concat(s?"disable":"enable"),{method:"POST"}),t.success(s?"User disabled.":"User enabled."),await es()}catch(e){et(e)}}async function ed(e,s){try{await (0,l.SC)("/admin/users/".concat(e,"/revoke-sessions"),{method:"POST"}),t.success("Sessions for ".concat(s," revoked.")),await es()}catch(e){et(e)}}async function ec(e,s,a){try{await (0,l.SC)("/admin/users/".concat(e,"/").concat(a?"grant-admin":"revoke-admin"),{method:"POST"}),t.success("".concat(s," ").concat(a?"granted":"revoked"," admin.")),await es()}catch(e){et(e)}}async function eo(e,s){try{await (0,l.SC)("/admin/users/".concat(e,"/set-unlimited?unlimited=").concat(s),{method:"POST"}),t.success(s?"User marked as unlimited.":"Unlimited removed."),await es()}catch(e){et(e)}}async function eu(e){ee(t=>({...t,[e]:!0}));try{let t=await (0,l.SC)("/admin/users/".concat(e,"/stats"));Y(s=>({...s,[e]:t}))}catch(e){t.error("Stats: ".concat(e.message||"failed"))}finally{ee(t=>({...t,[e]:!1}))}}async function em(e,s){q(e),H(s),K(!0),J([]);try{let t=await (0,l.SC)("/admin/users/".concat(e,"/login-events"));J(t||[])}catch(e){t.error("Login IPs: ".concat(e.message||"failed to load"))}finally{K(!1)}}(0,n.useEffect)(()=>{es()},[]);let[eh,ex]=(0,n.useState)(1),[ep,eg]=(0,n.useState)(1),[ej,ev]=(0,n.useState)(1),ef=(0,n.useCallback)(e=>{E(e),ex(1)},[]),eb=(0,n.useCallback)(e=>{I(e),eg(1)},[]),ey=(0,n.useCallback)(e=>{F(e),ev(1)},[]),ew=(0,n.useMemo)(()=>j.filter(e=>{let t=!A||e.email.toLowerCase().includes(A.toLowerCase()),s="all"===z||e.status===z;return t&&s}),[j,A,z]),eN=(0,n.useMemo)(()=>f.filter(e=>{let t=!R||e.email.toLowerCase().includes(R.toLowerCase()),s=e.revoked_at?"revoked":e.accepted_at?"accepted":"pending",a="all"===U||s===U;return t&&a}),[f,R,U]),eS=(0,n.useMemo)(()=>y.filter(e=>{let t=!B||e.email.toLowerCase().includes(B.toLowerCase());return"all"===M?t:"disabled"===M?t&&e.is_disabled:"active"===M?t&&!e.is_disabled:"admin"===M?t&&e.is_admin:"unlimited"===M?t&&e.is_unlimited:t}),[y,B,M]),ek=(0,n.useMemo)(()=>ew.slice((eh-1)*20,20*eh),[ew,eh]),eC=(0,n.useMemo)(()=>eN.slice((ep-1)*20,20*ep),[eN,ep]),e_=(0,n.useMemo)(()=>eS.slice((ej-1)*20,20*ej),[eS,ej]),eT=Math.max(...N.map(e=>e.count||0),1),eL=j.filter(e=>"pending"===e.status).length;return p||!m?(0,a.jsxs)("div",{className:"stack-lg",children:[(0,a.jsx)(d.A,{rows:2}),(0,a.jsx)(d.A,{rows:5}),(0,a.jsx)(d.A,{rows:5})]}):(0,a.jsxs)("div",{className:"stack-lg",children:[(0,a.jsx)("section",{className:"card",children:(0,a.jsxs)("div",{className:"row spread",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"row",style:{gap:8,marginBottom:4},children:[(0,a.jsx)("h1",{style:{margin:0,fontSize:"1.4rem"},children:"Admin"}),(0,a.jsx)("span",{className:"badge badge-warn",children:"Alpha controls"})]}),(0,a.jsx)("p",{className:"muted",children:"Manage waitlist, invitations, users, and usage."})]}),(0,a.jsxs)("div",{className:"row",style:{flexWrap:"wrap",gap:6},children:[eL>0&&(0,a.jsxs)("span",{className:"badge badge-warn",children:[eL," pending"]}),(0,a.jsxs)("span",{className:"badge badge-brand",children:[y.length," users"]}),(0,a.jsxs)("span",{className:"badge badge-ok",children:[f.filter(e=>e.accepted_at&&!e.revoked_at).length," accepted"]})]})]})}),(0,a.jsx)("div",{className:"tab-bar",role:"tablist",children:o.map(e=>{let{id:t,label:n}=e;return(0,a.jsxs)("button",{role:"tab","aria-selected":s===t,className:"tab".concat(s===t?" active":""),onClick:()=>c(t),style:{position:"relative"},children:[n,"waitlist"===t&&eL>0&&(0,a.jsx)("span",{className:"badge badge-warn",style:{marginLeft:6,fontSize:"0.65rem",padding:"1px 6px"},children:eL})]},t)})}),(0,a.jsxs)("div",{style:{marginTop:24,paddingBottom:64},children:["waitlist"===s&&(0,a.jsxs)("section",{className:"card animate-fade-in",children:[(0,a.jsxs)("div",{className:"row spread",style:{marginBottom:12},children:[(0,a.jsxs)("h2",{style:{margin:0},children:["Waitlist",(0,a.jsx)("span",{className:"badge badge-brand",style:{marginLeft:8,verticalAlign:"middle"},children:ew.length})]}),(0,a.jsxs)("div",{className:"row",style:{gap:8},children:[(0,a.jsx)("input",{placeholder:"Filter by email…",value:A,onChange:e=>ef(e.target.value),style:{maxWidth:220},"aria-label":"Filter waitlist by email"}),(0,a.jsxs)("select",{value:z,onChange:e=>{O(e.target.value),ex(1)},style:{width:140},"aria-label":"Filter waitlist by status",children:[(0,a.jsx)("option",{value:"all",children:"all"}),(0,a.jsx)("option",{value:"pending",children:"pending"}),(0,a.jsx)("option",{value:"approved",children:"approved"}),(0,a.jsx)("option",{value:"rejected",children:"rejected"})]})]})]}),(0,a.jsx)("div",{className:"table-wrap",children:(0,a.jsxs)("table",{children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Email"}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsx)("th",{children:"Submitted"}),(0,a.jsx)("th",{children:"Notes"}),(0,a.jsx)("th",{children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[0===ew.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,style:{textAlign:"center",color:"var(--muted)",padding:20},children:A?"No entries match.":"Waitlist is empty."})}),ek.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"mono",children:e.email}),(0,a.jsx)("td",{children:(0,a.jsx)(u,{status:e.status})}),(0,a.jsx)("td",{className:"muted",style:{fontSize:"0.8rem"},children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)("td",{className:"muted",style:{fontSize:"0.82rem"},children:e.notes||"—"}),(0,a.jsx)("td",{children:"pending"===e.status&&(0,a.jsxs)("div",{className:"td-actions",children:[(0,a.jsx)("button",{className:"btn primary sm",onClick:()=>ea(e.id,e.email),children:"Approve"}),(0,a.jsx)("button",{className:"btn danger sm",onClick:()=>en(e.id,e.email),children:"Reject"})]})})]},e.id))]})]})}),(0,a.jsx)(h,{total:ew.length,page:eh,pageSize:20,onPage:ex})]},"waitlist"),"invites"===s&&(0,a.jsxs)("div",{className:"stack-lg animate-fade-in",children:[(0,a.jsxs)("section",{className:"card",children:[(0,a.jsx)("h2",{style:{marginBottom:14},children:"Send invitation"}),(0,a.jsxs)("form",{onSubmit:ei,className:"grid-2",style:{alignItems:"end"},children:[(0,a.jsxs)("div",{className:"field",children:[(0,a.jsx)("label",{htmlFor:"inv-email",children:"Email address"}),(0,a.jsx)("input",{id:"inv-email",type:"email",required:!0,placeholder:"user@company.com",value:k,onChange:e=>C(e.target.value),disabled:L})]}),(0,a.jsxs)("div",{className:"field",children:[(0,a.jsxs)("label",{htmlFor:"inv-notes",children:["Notes ",(0,a.jsx)("span",{className:"muted",children:"(optional)"})]}),(0,a.jsx)("input",{id:"inv-notes",placeholder:"e.g. From waitlist, referral",value:_,onChange:e=>T(e.target.value),disabled:L})]}),(0,a.jsx)("div",{style:{paddingBottom:1},children:(0,a.jsxs)("button",{type:"submit",className:"btn primary",disabled:L||!k.trim(),"aria-busy":L,children:[L&&(0,a.jsx)("span",{className:"spinner"}),L?"Sending…":"Send invite"]})})]})]}),(0,a.jsxs)("section",{className:"card",children:[(0,a.jsxs)("div",{className:"row spread",style:{marginBottom:12},children:[(0,a.jsxs)("h2",{style:{margin:0},children:["Invitations",(0,a.jsx)("span",{className:"badge badge-brand",style:{marginLeft:8,verticalAlign:"middle"},children:eN.length})]}),(0,a.jsxs)("div",{className:"row",style:{gap:8},children:[(0,a.jsx)("input",{placeholder:"Filter by email…",value:R,onChange:e=>eb(e.target.value),style:{maxWidth:220},"aria-label":"Filter invitations by email"}),(0,a.jsxs)("select",{value:U,onChange:e=>{D(e.target.value),eg(1)},style:{width:140},"aria-label":"Filter invitations by status",children:[(0,a.jsx)("option",{value:"all",children:"all"}),(0,a.jsx)("option",{value:"pending",children:"pending"}),(0,a.jsx)("option",{value:"accepted",children:"accepted"}),(0,a.jsx)("option",{value:"revoked",children:"revoked"})]})]})]}),(0,a.jsx)("div",{className:"table-wrap",children:(0,a.jsxs)("table",{children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Email"}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsx)("th",{children:"Expires"}),(0,a.jsx)("th",{children:"Notes"}),(0,a.jsx)("th",{})]})}),(0,a.jsxs)("tbody",{children:[0===eN.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,style:{textAlign:"center",color:"var(--muted)",padding:20},children:"No invitations found."})}),eC.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"mono",children:e.email}),(0,a.jsx)("td",{children:(0,a.jsx)(u,{status:e.revoked_at?"revoked":e.accepted_at?"accepted":"pending"})}),(0,a.jsx)("td",{className:"muted",style:{fontSize:"0.8rem"},children:new Date(e.expires_at).toLocaleDateString()}),(0,a.jsx)("td",{className:"muted",style:{fontSize:"0.82rem"},children:e.notes||"—"}),(0,a.jsx)("td",{children:!e.revoked_at&&!e.accepted_at&&(0,a.jsx)("button",{className:"btn danger sm",onClick:()=>el(e.id,e.email),children:"Revoke"})})]},e.id))]})]})}),(0,a.jsx)(h,{total:eN.length,page:ep,pageSize:20,onPage:eg})]})]},"invites"),"users"===s&&(0,a.jsxs)("section",{className:"card animate-fade-in",children:[(0,a.jsxs)("div",{className:"row spread",style:{marginBottom:12},children:[(0,a.jsxs)("h2",{style:{margin:0},children:["Users",(0,a.jsx)("span",{className:"badge badge-brand",style:{marginLeft:8,verticalAlign:"middle"},children:eS.length})]}),(0,a.jsxs)("div",{className:"row",style:{gap:8},children:[(0,a.jsx)("input",{placeholder:"Filter by email…",value:B,onChange:e=>ey(e.target.value),style:{maxWidth:220},"aria-label":"Filter users by email"}),(0,a.jsxs)("select",{value:M,onChange:e=>{W(e.target.value),ev(1)},style:{width:140},"aria-label":"Filter users by status",children:[(0,a.jsx)("option",{value:"all",children:"all"}),(0,a.jsx)("option",{value:"active",children:"active"}),(0,a.jsx)("option",{value:"disabled",children:"disabled"}),(0,a.jsx)("option",{value:"admin",children:"admin"}),(0,a.jsx)("option",{value:"unlimited",children:"unlimited"})]})]})]}),(0,a.jsx)("div",{className:"table-wrap",children:(0,a.jsxs)("table",{children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Email"}),(0,a.jsx)("th",{children:"Roles"}),(0,a.jsx)("th",{children:"Last login"}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsx)("th",{children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[0===eS.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,style:{textAlign:"center",color:"var(--muted)",padding:20},children:"No users found."})}),e_.map(e=>{let t=Q[e.id],s=void 0!==t;return(0,a.jsxs)(n.Fragment,{children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"mono",children:e.email}),(0,a.jsxs)("td",{style:{whiteSpace:"nowrap"},children:[e.is_admin&&(0,a.jsx)("span",{className:"badge badge-brand",style:{marginRight:4},children:"admin"}),e.is_unlimited&&(0,a.jsx)("span",{className:"badge badge-ok",title:"No daily usage limits",children:"∞ unlimited"}),!e.is_admin&&!e.is_unlimited&&(0,a.jsx)("span",{className:"muted",children:"—"})]}),(0,a.jsx)("td",{className:"muted",style:{fontSize:"0.8rem"},children:e.last_login_at?new Date(e.last_login_at).toLocaleDateString():"never"}),(0,a.jsx)("td",{children:(0,a.jsx)(u,{status:e.is_disabled?"disabled":"active"})}),(0,a.jsx)("td",{children:(0,a.jsxs)("div",{className:"td-actions",style:{flexWrap:"wrap"},children:[(0,a.jsx)("button",{className:"btn secondary sm",onClick:()=>er(e.id,!e.is_disabled),children:e.is_disabled?"Enable":"Disable"}),(0,a.jsx)("button",{className:"btn secondary sm",onClick:()=>ed(e.id,e.email),children:"Revoke sessions"}),(0,a.jsx)("button",{className:"btn sm ".concat(e.is_admin?"danger":"secondary"),onClick:()=>ec(e.id,e.email,!e.is_admin),title:e.is_admin?"Remove admin privileges":"Grant admin privileges",children:e.is_admin?"Revoke admin":"Grant admin"}),(0,a.jsx)("button",{className:"btn sm ".concat(e.is_unlimited?"danger":"secondary"),onClick:()=>eo(e.id,!e.is_unlimited),title:e.is_unlimited?"Remove unlimited limits bypass":"Remove all daily usage limits for this user",children:e.is_unlimited?"Set limited":"Set unlimited"}),(0,a.jsx)("button",{className:"btn secondary sm",onClick:()=>s?Y(t=>{let s={...t};return delete s[e.id],s}):eu(e.id),title:"Toggle usage stats",children:Z[e.id]?"Loading…":s?"Hide stats":"Stats"})]})})]}),s&&(0,a.jsx)("tr",{style:{background:"var(--panel-2)"},children:(0,a.jsx)("td",{colSpan:5,style:{padding:"6px 12px 10px 12px"},children:(0,a.jsxs)("div",{style:{display:"flex",gap:"1.5rem",fontSize:"0.82rem",color:"var(--ink-2)",flexWrap:"wrap"},children:[(0,a.jsxs)("span",{children:["Total memories: ",(0,a.jsx)("strong",{style:{color:"var(--brand)"},children:t.memory_count})]}),(0,a.jsxs)("span",{children:["Today memories: ",(0,a.jsx)("strong",{children:t.today_memories})]}),(0,a.jsxs)("span",{children:["Today recalls: ",(0,a.jsx)("strong",{children:t.today_recalls})]}),(0,a.jsxs)("span",{children:["Today projects: ",(0,a.jsx)("strong",{children:t.today_projects})]})]})})})]},e.id)})]})]})}),(0,a.jsx)(h,{total:eS.length,page:ej,pageSize:20,onPage:ev})]},"users"),"login-ips"===s&&(0,a.jsxs)("div",{className:"stack-lg animate-fade-in",children:[(0,a.jsxs)("section",{className:"card",children:[(0,a.jsx)("h2",{style:{marginBottom:8},children:"Login IP History"}),(0,a.jsx)("p",{className:"muted",style:{marginBottom:16,fontSize:"0.88rem"},children:"Select a user to view their last 10 login IP addresses and timestamps. IPs are stored verbatim — no tokens, cookies, or secrets are shown."}),(0,a.jsx)("div",{className:"table-wrap",children:(0,a.jsxs)("table",{children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Email"}),(0,a.jsx)("th",{children:"Last login"}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsx)("th",{})]})}),(0,a.jsxs)("tbody",{children:[0===y.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,style:{textAlign:"center",color:"var(--muted)",padding:20},children:"No users found."})}),y.map(e=>(0,a.jsxs)("tr",{style:X===e.id?{background:"var(--panel-2)"}:{},children:[(0,a.jsx)("td",{className:"mono",children:e.email}),(0,a.jsx)("td",{className:"muted",style:{fontSize:"0.8rem"},children:e.last_login_at?new Date(e.last_login_at).toLocaleString():"never"}),(0,a.jsx)("td",{children:(0,a.jsx)(u,{status:e.is_disabled?"disabled":"active"})}),(0,a.jsx)("td",{children:(0,a.jsx)("button",{className:"btn sm ".concat(X===e.id?"primary":"secondary"),onClick:()=>em(e.id,e.email),"aria-pressed":X===e.id,children:X===e.id?"Viewing":"View IPs"})})]},e.id))]})]})})]}),null!==X&&(0,a.jsxs)("section",{className:"card",children:[(0,a.jsxs)("div",{className:"row spread",style:{marginBottom:12},children:[(0,a.jsxs)("h3",{style:{margin:0},children:["Login events for"," ",(0,a.jsx)("span",{className:"mono",style:{fontSize:"0.9em"},children:G})]}),(0,a.jsx)("button",{className:"btn secondary sm",onClick:()=>em(X,G),disabled:$,children:$?"Loading…":"Refresh"})]}),$?(0,a.jsx)("p",{className:"muted",children:"Loading…"}):0===V.length?(0,a.jsx)("p",{className:"muted",children:"No login events recorded for this user."}):(0,a.jsx)("div",{className:"table-wrap",children:(0,a.jsxs)("table",{children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"#"}),(0,a.jsx)("th",{children:"IP Address"}),(0,a.jsx)("th",{children:"Date & Time (UTC)"}),(0,a.jsx)("th",{children:"User Agent"})]})}),(0,a.jsx)("tbody",{children:V.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"muted",style:{fontSize:"0.8rem"},children:t+1}),(0,a.jsx)("td",{className:"mono",style:{fontSize:"0.88rem"},children:e.ip}),(0,a.jsx)("td",{className:"muted",style:{fontSize:"0.8rem"},children:new Date(e.created_at).toUTCString()}),(0,a.jsx)("td",{className:"muted",style:{fontSize:"0.75rem",maxWidth:280,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:e.user_agent||"",children:e.user_agent||"—"})]},e.id))})]})}),(0,a.jsx)("p",{className:"muted",style:{fontSize:"0.75rem",marginTop:10},children:"Showing up to 10 most recent login events. Older records are automatically deleted."})]})]},"login-ips"),"usage"===s&&(0,a.jsxs)("section",{className:"card animate-fade-in",children:[(0,a.jsx)("h2",{style:{marginBottom:16},children:"Usage — last 30 days"}),0===N.length?(0,a.jsx)("p",{className:"muted",children:"No usage events recorded yet."}):(0,a.jsx)("div",{className:"usage-chart",children:N.map((e,t)=>(0,a.jsxs)("div",{className:"usage-bar-row",children:[(0,a.jsx)("span",{className:"usage-bar-label",title:"".concat(e.date," \xb7 ").concat(e.event_type),children:e.event_type}),(0,a.jsx)("div",{className:"usage-bar-track","aria-label":"".concat(e.count," events"),children:(0,a.jsx)("div",{className:"usage-bar-fill",style:{width:"".concat(Math.round(e.count/eT*100),"%")}})}),(0,a.jsx)("span",{className:"usage-bar-count",children:e.count})]},"".concat(e.date,"-").concat(t)))})]},"usage")]})]})}function h(e){let{total:t,page:s,pageSize:n,onPage:i}=e,l=Math.ceil(t/n);if(l<=1)return null;let r=Math.min(s*n,t);return(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:12,marginTop:8,borderTop:"1px solid var(--line)",fontSize:"0.8rem",color:"var(--ink-2)"},children:[(0,a.jsxs)("span",{children:[(s-1)*n+1,"–",r," of ",t]}),(0,a.jsxs)("div",{style:{display:"flex",gap:4},children:[(0,a.jsx)("button",{className:"btn ghost sm",disabled:s<=1,onClick:()=>i(1),title:"First page",style:{padding:"2px 8px"},children:"\xab"}),(0,a.jsx)("button",{className:"btn ghost sm",disabled:s<=1,onClick:()=>i(s-1),title:"Previous page",style:{padding:"2px 8px"},children:"‹"}),(0,a.jsxs)("span",{style:{padding:"2px 8px",color:"var(--ink)",fontWeight:600},children:[s," / ",l]}),(0,a.jsx)("button",{className:"btn ghost sm",disabled:s>=l,onClick:()=>i(s+1),title:"Next page",style:{padding:"2px 8px"},children:"›"}),(0,a.jsx)("button",{className:"btn ghost sm",disabled:s>=l,onClick:()=>i(l),title:"Last page",style:{padding:"2px 8px"},children:"\xbb"})]})]})}},935:function(e,t,s){"use strict";s.d(t,{A:function(){return i},O:function(){return n}});var a=s(7437);function n(e){let{height:t="1rem",width:s="100%",radius:n="8px",className:i=""}=e;return(0,a.jsx)("div",{className:"skeleton ".concat(i),style:{height:t,width:s,borderRadius:n},"aria-hidden":"true"})}function i(e){let{rows:t=3}=e;return(0,a.jsxs)("div",{className:"card","aria-busy":"true","aria-label":"Loading…",children:[(0,a.jsx)(n,{height:"1.1rem",width:"40%",radius:"6px"}),(0,a.jsx)("div",{style:{marginTop:12,display:"grid",gap:8},children:Array.from({length:t}).map((e,s)=>(0,a.jsx)(n,{height:"0.85rem",width:s===t-1?"70%":"100%"},s))})]})}},5110:function(e,t,s){"use strict";s.d(t,{ToastProvider:function(){return r},p:function(){return d}});var a=s(7437),n=s(2265);let i=(0,n.createContext)({addToast:()=>{}}),l=0;function r(e){let{children:t}=e,[s,r]=(0,n.useState)([]),d=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3,a=++l;r(s=>[...s,{id:a,message:e,variant:t,leaving:!1}]),setTimeout(()=>{r(e=>e.map(e=>e.id===a?{...e,leaving:!0}:e)),setTimeout(()=>{r(e=>e.filter(e=>e.id!==a))},300)},s)},[]),o=(0,n.useCallback)(e=>{r(t=>t.map(t=>t.id===e?{...t,leaving:!0}:t)),setTimeout(()=>{r(t=>t.filter(t=>t.id!==e))},300)},[]);return(0,a.jsxs)(i.Provider,{value:{addToast:d},children:[t,s.length>0&&(0,a.jsx)("div",{className:"toast-stack",role:"region","aria-label":"Notifications","aria-live":"polite",children:s.map(e=>(0,a.jsxs)("div",{className:"toast toast-".concat(e.variant).concat(e.leaving?" toast-leave":""),role:"alert",children:[(0,a.jsx)("span",{className:"toast-icon",children:c[e.variant]}),(0,a.jsx)("span",{className:"toast-msg",children:e.message}),(0,a.jsx)("button",{className:"toast-close",onClick:()=>o(e.id),"aria-label":"Dismiss",children:"\xd7"})]},e.id))})]})}function d(){let{addToast:e}=(0,n.useContext)(i);return{success:(t,s)=>e(t,"success",s),error:(t,s)=>e(t,"error",null!=s?s:6e3),info:(t,s)=>e(t,"info",s),warn:(t,s)=>e(t,"warn",s)}}let c={success:"✓",error:"✕",info:"ℹ",warn:"⚠"}},3113:function(e,t,s){"use strict";s.d(t,{B3:function(){return n},EN:function(){return l},MS:function(){return r},Rt:function(){return c},SC:function(){return d}});var a=s(257);function n(){return"/api"}let i="thecontextcache.com";function l(){if(a.env.NEXT_PUBLIC_DOCS_URL)return a.env.NEXT_PUBLIC_DOCS_URL.replace(/\/$/,"");{let{protocol:e,hostname:t}=window.location;if("https:"===e&&(t===i||t.endsWith(".".concat(i))))return"https://docs.".concat(i)}return"/docs"}class r extends Error{constructor(e,t,s){super(e),this.status=t,this.kind=s}}async function d(e){let t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n(),i="/api"===a?[a]:[a,"/api"],l=e.startsWith("/auth/")||"/health"===e||"/me/orgs"===e?"":(window.localStorage.getItem("CONTEXTCACHE_ORG_ID")||"").trim(),d=0,c={...s},o=c.headers||{};for(let s of(delete c.headers,i))try{t=await fetch("".concat(s).concat(e),{...c,credentials:"include",headers:{"Content-Type":"application/json",...l?{"X-Org-Id":l}:{},...o}});break}catch(e){if((d+=1)>=i.length)throw new r("Cannot reach the backend. Check your network or server status.",0,"network")}if(!t)throw new r("Cannot reach the backend. Check your network or server status.",0,"network");let u=await t.json().catch(()=>({}));if(!t.ok){let e=u.detail||"Request failed";if(401===t.status)throw new r(e,401,"auth");if(403===t.status)throw new r(e,403,"forbidden");if(429===t.status)throw new r("Too many requests — please wait a moment and try again.",429,"rate_limit");if(t.status>=500)throw new r("Server error. Please try again shortly.",t.status,"server");throw new r(e,t.status,"client")}return u}async function c(e){let t=n();for(let s of"/api"===t?[t]:[t,"/api"])try{if((await fetch("".concat(s,"/health"),{credentials:"include",signal:null!=e?e:function(e){if("undefined"!=typeof AbortSignal&&"function"==typeof AbortSignal.timeout)return AbortSignal.timeout(5e3);let t=new AbortController;return setTimeout(()=>t.abort(),5e3),t.signal}(0)})).ok)return!0}catch(e){}return!1}},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},257:function(e,t,s){"use strict";var a,n;e.exports=(null==(a=s.g.process)?void 0:a.env)&&"object"==typeof(null==(n=s.g.process)?void 0:n.env)?s.g.process:s(4227)},4227:function(e){!function(){var t={229:function(e){var t,s,a,n=e.exports={};function i(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function r(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(s){try{return t.call(null,e,0)}catch(s){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{s="function"==typeof clearTimeout?clearTimeout:l}catch(e){s=l}}();var d=[],c=!1,o=-1;function u(){c&&a&&(c=!1,a.length?d=a.concat(d):o=-1,d.length&&m())}function m(){if(!c){var e=r(u);c=!0;for(var t=d.length;t;){for(a=d,d=[];++o<t;)a&&a[o].run();o=-1,t=d.length}a=null,c=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===l||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function x(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];d.push(new h(e,t)),1!==d.length||c||r(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=x,n.addListener=x,n.once=x,n.off=x,n.removeListener=x,n.removeAllListeners=x,n.emit=x,n.prependListener=x,n.prependOnceListener=x,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},s={};function a(e){var n=s[e];if(void 0!==n)return n.exports;var i=s[e]={exports:{}},l=!0;try{t[e](i,i.exports,a),l=!1}finally{l&&delete s[e]}return i.exports}a.ab="//";var n=a(229);e.exports=n}()}},function(e){e.O(0,[971,117,744],function(){return e(e.s=2751)}),_N_E=e.O()}]);