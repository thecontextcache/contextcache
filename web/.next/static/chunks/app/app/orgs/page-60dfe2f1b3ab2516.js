(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[907],{4150:function(e,t,n){Promise.resolve().then(n.bind(n,3144))},3144:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h},dynamic:function(){return l}});var r=n(7437),a=n(2265),i=n(9376),o=n(3113),s=n(5110);let l="force-dynamic";function c(e){let{title:t,body:n,confirmLabel:a="Delete",onConfirm:i,onCancel:o,loading:s}=e;return(0,r.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.65)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(4px)"},children:(0,r.jsxs)("div",{style:{background:"var(--bg-2)",border:"1px solid rgba(239,68,68,0.4)",borderRadius:16,padding:32,maxWidth:420,width:"90%",boxShadow:"0 20px 60px rgba(0,0,0,0.5)"},children:[(0,r.jsx)("h3",{style:{margin:"0 0 8px",fontSize:"1.05rem",color:"#ef4444"},children:t}),(0,r.jsx)("p",{style:{fontSize:"0.85rem",color:"var(--muted)",margin:"0 0 24px",lineHeight:1.6},children:n}),(0,r.jsxs)("div",{style:{display:"flex",gap:10,justifyContent:"flex-end"},children:[(0,r.jsx)("button",{className:"btn ghost",onClick:o,disabled:s,children:"Cancel"}),(0,r.jsx)("button",{className:"btn",style:{background:"rgba(239,68,68,0.15)",color:"#ef4444",border:"1px solid rgba(239,68,68,0.4)"},onClick:i,disabled:s,children:s?"Deleting…":a})]})]})})}function u(e){let{org:t,onSave:n,onCancel:i}=e,[o,s]=(0,a.useState)(t.name),[l,c]=(0,a.useState)(!1),u=(0,a.useRef)(null);async function d(e){if(e.preventDefault(),!o.trim()||o.trim()===t.name){i();return}c(!0);try{await n(o.trim())}finally{c(!1)}}return(0,a.useEffect)(()=>{var e,t;null===(e=u.current)||void 0===e||e.focus(),null===(t=u.current)||void 0===t||t.select()},[]),(0,r.jsxs)("form",{onSubmit:d,style:{display:"flex",gap:8,flex:1},children:[(0,r.jsx)("input",{ref:u,type:"text",value:o,onChange:e=>s(e.target.value),maxLength:200,disabled:l,style:{flex:1,padding:"6px 10px",borderRadius:7,border:"1px solid var(--line)",background:"var(--bg)",color:"var(--ink)",fontSize:"0.9rem"}}),(0,r.jsx)("button",{type:"submit",className:"btn primary sm",disabled:!o.trim()||l,children:l?"Saving…":"Save"}),(0,r.jsx)("button",{type:"button",className:"btn ghost sm",onClick:i,disabled:l,children:"Cancel"})]})}function d(e){let{org:t,isCurrent:n,onRename:i,onDelete:o,onSwitch:s}=e,[l,c]=(0,a.useState)(!1);return(0,r.jsx)("div",{style:{background:"var(--bg-2)",border:"1px solid ".concat(n?"rgba(0,212,255,0.3)":"var(--line-2)"),borderRadius:12,padding:"16px 20px",boxShadow:n?"0 0 0 1px rgba(0,212,255,0.1)":"none"},children:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[(0,r.jsxs)("div",{style:{flex:1,minWidth:0},children:[l?(0,r.jsx)(u,{org:t,onSave:async e=>{await i(t.id,e),c(!1)},onCancel:()=>c(!1)}):(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"},children:[(0,r.jsx)("span",{style:{fontWeight:700,fontSize:"0.95rem",color:"var(--ink)"},children:t.name}),n&&(0,r.jsx)("span",{style:{fontSize:"0.68rem",fontWeight:700,padding:"2px 8px",borderRadius:999,background:"rgba(0,212,255,0.12)",color:"#00D4FF",border:"1px solid rgba(0,212,255,0.3)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Current"})]}),!l&&(0,r.jsxs)("div",{style:{fontSize:"0.75rem",color:"var(--muted)",marginTop:4},children:["ID: ",t.id," \xb7 Created ",function(e){if(!e)return"—";try{return new Date(e).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"})}catch(t){return e}}(t.created_at)]})]}),!l&&(0,r.jsxs)("div",{style:{display:"flex",gap:8,flexShrink:0},children:[!n&&(0,r.jsx)("button",{className:"btn ghost sm",onClick:()=>s(t),children:"Switch"}),(0,r.jsx)("button",{className:"btn ghost sm",onClick:()=>c(!0),children:"Rename"}),(0,r.jsx)("button",{className:"btn ghost sm",style:{color:"#ef4444",borderColor:"rgba(239,68,68,0.3)"},onClick:()=>o(t),children:"Delete"})]})]})})}function h(){let e=(0,i.useRouter)(),t=(0,s.p)(),[n,l]=(0,a.useState)([]),[u,h]=(0,a.useState)(null),[f,m]=(0,a.useState)(!0),[g,p]=(0,a.useState)(""),[x,v]=(0,a.useState)(!1),[y,b]=(0,a.useState)(null),[w,C]=(0,a.useState)(!1),j=(0,a.useCallback)(async()=>{m(!0);try{var n,r;let e=await (0,o.SC)("/orgs");l(null!=e?e:[]);let t=localStorage.getItem("CONTEXTCACHE_ORG_ID");h(t?Number(t):null!==(r=null==e?void 0:null===(n=e[0])||void 0===n?void 0:n.id)&&void 0!==r?r:null)}catch(n){n instanceof o.MS&&(401===n.status||403===n.status)?e.push("/auth"):t.error("Could not load organisations.")}finally{m(!1)}},[]);(0,a.useEffect)(()=>{j()},[j]);let S=async e=>{if(e.preventDefault(),g.trim()&&!x){v(!0);try{await (0,o.SC)("/orgs",{method:"POST",body:JSON.stringify({name:g.trim()})}),p(""),t.success('Organisation "'.concat(g.trim(),'" created.')),await j()}catch(e){var n;t.error(null!==(n=e.message)&&void 0!==n?n:"Failed to create organisation.")}finally{v(!1)}}},T=async(e,n)=>{try{await (0,o.SC)("/orgs/".concat(e),{method:"PATCH",body:JSON.stringify({name:n})}),t.success("Organisation renamed."),e===u&&(localStorage.setItem("CONTEXTCACHE_ORG_NAME",n),window.dispatchEvent(new Event("cc:org-changed"))),await j()}catch(e){var r;throw t.error(null!==(r=e.message)&&void 0!==r?r:"Failed to rename organisation."),e}},k=e=>{localStorage.setItem("CONTEXTCACHE_ORG_ID",String(e.id)),localStorage.setItem("CONTEXTCACHE_ORG_NAME",e.name),window.dispatchEvent(new Event("cc:org-changed")),h(e.id),t.success('Switched to "'.concat(e.name,'".'))},E=async()=>{if(y&&!w){C(!0);try{await (0,o.SC)("/orgs/".concat(y.id),{method:"DELETE"}),t.success('Organisation "'.concat(y.name,'" deleted.')),y.id===u&&(localStorage.removeItem("CONTEXTCACHE_ORG_ID"),localStorage.removeItem("CONTEXTCACHE_ORG_NAME"),window.dispatchEvent(new Event("cc:org-changed"))),b(null),await j()}catch(n){var e;t.error(null!==(e=n.message)&&void 0!==e?e:"Failed to delete organisation.")}finally{C(!1)}}};return(0,r.jsxs)(r.Fragment,{children:[y&&(0,r.jsx)(c,{title:'Delete "'.concat(y.name,'"?'),body:"This permanently deletes the organisation and all its API keys, memberships, and audit logs. Projects must be deleted first. This action cannot be undone.",confirmLabel:"Yes, delete it",onConfirm:E,onCancel:()=>b(null),loading:w}),(0,r.jsxs)("div",{style:{minHeight:"100vh",background:"var(--bg)",color:"var(--ink)"},children:[(0,r.jsx)("div",{style:{borderBottom:"1px solid var(--line)",padding:"20px 28px",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:12},children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{style:{margin:0,fontSize:"1.15rem",fontWeight:700},children:"Organisation"}),(0,r.jsxs)("div",{style:{fontSize:"0.78rem",color:"var(--muted)",marginTop:2},children:[n.length," workspace",1!==n.length?"s":""]})]})}),(0,r.jsxs)("div",{style:{maxWidth:680,margin:"0 auto",padding:"32px 24px"},children:[(0,r.jsxs)("div",{className:"card",style:{marginBottom:24},children:[(0,r.jsx)("h2",{style:{margin:"0 0 4px",fontSize:"1rem"},children:"Create a New Organisation"}),(0,r.jsx)("p",{style:{fontSize:"0.82rem",color:"var(--muted)",margin:"0 0 16px"},children:"Each organisation has its own projects, memories, and API keys."}),(0,r.jsxs)("form",{onSubmit:S,style:{display:"flex",gap:10},children:[(0,r.jsx)("input",{type:"text",value:g,onChange:e=>p(e.target.value),placeholder:"e.g. Acme Corp",maxLength:200,disabled:x,style:{flex:1}}),(0,r.jsx)("button",{type:"submit",className:"btn primary",disabled:!g.trim()||x,children:x?"Creating…":"Create"})]})]}),(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("h2",{style:{margin:"0 0 16px",fontSize:"1rem"},children:"Your Organisations"}),f?(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[0,1].map(e=>(0,r.jsx)("div",{style:{height:72,borderRadius:10,background:"var(--panel-2)",animation:"pulse 1.5s ease-in-out infinite",animationDelay:"".concat(.1*e,"s")}},e))}):0===n.length?(0,r.jsx)("div",{style:{textAlign:"center",padding:"32px 16px",color:"var(--muted)",fontSize:"0.88rem"},children:"No organisations yet. Create one above."}):(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:n.map(e=>(0,r.jsx)(d,{org:e,isCurrent:e.id===u,onRename:T,onDelete:b,onSwitch:k},e.id))})]}),(0,r.jsxs)("div",{style:{marginTop:24,padding:"16px 20px",borderRadius:12,background:"rgba(0,212,255,0.06)",border:"1px solid rgba(0,212,255,0.15)",fontSize:"0.82rem",color:"var(--muted)",lineHeight:1.6},children:[(0,r.jsx)("strong",{style:{color:"var(--ink)"},children:"Note:"})," To delete an organisation, all its projects must be deleted first. You can do that from the Dashboard. Deleting an org also removes all its API keys and audit history."]})]})]}),(0,r.jsx)("style",{children:"\n        @keyframes pulse {\n          0%,100% { opacity: 1; }\n          50% { opacity: 0.45; }\n        }\n      "})]})}},5110:function(e,t,n){"use strict";n.d(t,{ToastProvider:function(){return s},p:function(){return l}});var r=n(7437),a=n(2265);let i=(0,a.createContext)({addToast:()=>{}}),o=0;function s(e){let{children:t}=e,[n,s]=(0,a.useState)([]),l=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3,r=++o;s(n=>[...n,{id:r,message:e,variant:t,leaving:!1}]),setTimeout(()=>{s(e=>e.map(e=>e.id===r?{...e,leaving:!0}:e)),setTimeout(()=>{s(e=>e.filter(e=>e.id!==r))},300)},n)},[]),u=(0,a.useCallback)(e=>{s(t=>t.map(t=>t.id===e?{...t,leaving:!0}:t)),setTimeout(()=>{s(t=>t.filter(t=>t.id!==e))},300)},[]);return(0,r.jsxs)(i.Provider,{value:{addToast:l},children:[t,n.length>0&&(0,r.jsx)("div",{className:"toast-stack",role:"region","aria-label":"Notifications","aria-live":"polite",children:n.map(e=>(0,r.jsxs)("div",{className:"toast toast-".concat(e.variant).concat(e.leaving?" toast-leave":""),role:"alert",children:[(0,r.jsx)("span",{className:"toast-icon",children:c[e.variant]}),(0,r.jsx)("span",{className:"toast-msg",children:e.message}),(0,r.jsx)("button",{className:"toast-close",onClick:()=>u(e.id),"aria-label":"Dismiss",children:"\xd7"})]},e.id))})]})}function l(){let{addToast:e}=(0,a.useContext)(i);return{success:(t,n)=>e(t,"success",n),error:(t,n)=>e(t,"error",null!=n?n:6e3),info:(t,n)=>e(t,"info",n),warn:(t,n)=>e(t,"warn",n)}}let c={success:"✓",error:"✕",info:"ℹ",warn:"⚠"}},3113:function(e,t,n){"use strict";n.d(t,{B3:function(){return a},EN:function(){return o},MS:function(){return s},Rt:function(){return c},SC:function(){return l}});var r=n(257);function a(){return"/api"}let i="thecontextcache.com";function o(){if(r.env.NEXT_PUBLIC_DOCS_URL)return r.env.NEXT_PUBLIC_DOCS_URL.replace(/\/$/,"");{let{protocol:e,hostname:t}=window.location;if("https:"===e&&(t===i||t.endsWith(".".concat(i))))return"https://docs.".concat(i)}return"/docs"}class s extends Error{constructor(e,t,n){super(e),this.status=t,this.kind=n}}async function l(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=a(),i="/api"===r?[r]:[r,"/api"],o=e.startsWith("/auth/")||"/health"===e||"/me/orgs"===e?"":(window.localStorage.getItem("CONTEXTCACHE_ORG_ID")||"").trim(),l=0,c={...n},u=c.headers||{};for(let n of(delete c.headers,i))try{t=await fetch("".concat(n).concat(e),{...c,credentials:"include",headers:{"Content-Type":"application/json",...o?{"X-Org-Id":o}:{},...u}});break}catch(e){if((l+=1)>=i.length)throw new s("Cannot reach the backend. Check your network or server status.",0,"network")}if(!t)throw new s("Cannot reach the backend. Check your network or server status.",0,"network");let d=await t.json().catch(()=>({}));if(!t.ok){let e=d.detail||"Request failed";if(401===t.status)throw new s(e,401,"auth");if(403===t.status)throw new s(e,403,"forbidden");if(429===t.status)throw new s("Too many requests — please wait a moment and try again.",429,"rate_limit");if(t.status>=500)throw new s("Server error. Please try again shortly.",t.status,"server");throw new s(e,t.status,"client")}return d}async function c(e){let t=a();for(let n of"/api"===t?[t]:[t,"/api"])try{if((await fetch("".concat(n,"/health"),{credentials:"include",signal:null!=e?e:function(e){if("undefined"!=typeof AbortSignal&&"function"==typeof AbortSignal.timeout)return AbortSignal.timeout(5e3);let t=new AbortController;return setTimeout(()=>t.abort(),5e3),t.signal}(0)})).ok)return!0}catch(e){}return!1}},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},257:function(e,t,n){"use strict";var r,a;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(a=n.g.process)?void 0:a.env)?n.g.process:n(4227)},4227:function(e){!function(){var t={229:function(e){var t,n,r,a=e.exports={};function i(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l=[],c=!1,u=-1;function d(){c&&r&&(c=!1,r.length?l=r.concat(l):u=-1,l.length&&h())}function h(){if(!c){var e=s(d);c=!0;for(var t=l.length;t;){for(r=l,l=[];++u<t;)r&&r[u].run();u=-1,t=l.length}r=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new f(e,t)),1!==l.length||c||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var i=n[e]={exports:{}},o=!0;try{t[e](i,i.exports,r),o=!1}finally{o&&delete n[e]}return i.exports}r.ab="//";var a=r(229);e.exports=a}()}},function(e){e.O(0,[971,117,744],function(){return e(e.s=4150)}),_N_E=e.O()}]);