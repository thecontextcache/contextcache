{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"ContextCache Docs","text":"<p>ContextCache is an invite-only alpha for team memory recall.</p>"},{"location":"#start-here","title":"Start here","text":"<ul> <li>Overview</li> <li>Data Model</li> <li>API Contract</li> <li>Dev Workflow</li> <li>Security</li> <li>Legal</li> </ul>"},{"location":"#current-product-shape","title":"Current product shape","text":"<ul> <li>Magic-link login + session cookie for web UI</li> <li>Admin invite controls for alpha access</li> <li>API key auth retained for programmatic access</li> <li>Org-scoped projects/memories with RBAC and audit logs</li> <li>Hybrid recall: CAG pre-check + FTS + pgvector + Hilbert prefilter + recency</li> <li>Pheromone-guided CAG cache eviction with periodic evaporation</li> </ul>"},{"location":"00-overview/","title":"Overview","text":"<p>ContextCache is a shared project memory layer for teams using different AI tools.</p>"},{"location":"00-overview/#the-problem","title":"The Problem","text":"<p>Teams today face a fragmented AI landscape:</p> <ol> <li> <p>Tool fragmentation \u2014 Different team members use different AI tools (ChatGPT, Claude, Ollama, Copilot). Insights discovered in one tool don't transfer to another.</p> </li> <li> <p>Scattered context \u2014 Project knowledge lives in dozens of chat threads, each tool siloed with no shared memory.</p> </li> <li> <p>Context window limits \u2014 Every model has a finite context window. Long projects exceed it, and the AI \"forgets\" earlier decisions.</p> </li> <li> <p>No intentional curation \u2014 Most tools auto-save everything, flooding memory with noise. High-signal insights get buried.</p> </li> </ol>"},{"location":"00-overview/#the-solution","title":"The Solution","text":"<p>ContextCache takes a different approach:</p> <ol> <li> <p>Human-curated memory cards \u2014 Users intentionally publish high-signal insights (decisions, definitions, findings) into a shared project memory. No auto-scraping, no noise.</p> </li> <li> <p>Paste-ready memory packs \u2014 When you need context, you call the Recall endpoint. It returns a formatted text block you paste into any AI tool\u2014ChatGPT, Claude, Ollama, or anything else.</p> </li> <li> <p>Tool-agnostic by design \u2014 No plugins, no integrations needed for MVP. One API, paste anywhere.</p> </li> </ol> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      CONTEXTCACHE                           \u2502\n\u2502                                                             \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502\n\u2502   \u2502  Memory Card \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6   \u2502 Memory Pack  \u2502      \u2502\n\u2502   \u2502  (decision)  \u2502     Recall API     \u2502 (paste-ready)\u2502      \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502              \u2502\n\u2502   \u2502  Memory Card \u2502                           \u25bc              \u2502\n\u2502   \u2502  (finding)   \u2502                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2502   Any AI     \u2502      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502   ChatGPT    \u2502      \u2502\n\u2502   \u2502  Memory Card \u2502                    \u2502   Claude     \u2502      \u2502\n\u2502   \u2502  (definition)\u2502                    \u2502   Ollama     \u2502      \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"00-overview/#what-this-is-not-mvp","title":"What This Is NOT (MVP)","text":"<p>To keep scope clear, here's what ContextCache is not in the MVP:</p> Not This Why AI-to-AI chat We don't connect AI models to each other Agent platform No autonomous agents scraping or acting MCP-focused MCP is Phase 3+, not MVP Unlimited context magic We don't expand model limits; we curate packs"},{"location":"00-overview/#core-vocabulary","title":"Core Vocabulary","text":"Term Definition Project A container for related memory cards (e.g., \"Backend Refactor\") Memory Card A single piece of curated knowledge (decision, finding, definition, note, link, todo) Memory Pack A formatted text block returned by Recall, ready to paste into any AI Recall The API endpoint that generates a memory pack from stored cards"},{"location":"00-overview/#next-steps","title":"Next Steps","text":"<ul> <li>MVP Scope \u2014 What's in and out of MVP</li> <li>Architecture \u2014 How the system works</li> <li>API Contract \u2014 Endpoints and payloads</li> </ul>"},{"location":"01-mvp-scope/","title":"MVP Scope","text":""},{"location":"01-mvp-scope/#mvp-goal-one-sentence","title":"MVP Goal (One Sentence)","text":"<p>Ship a minimal product where teams can create projects, publish memory cards, and recall a paste-ready memory pack for any AI tool.</p>"},{"location":"01-mvp-scope/#in-scope-mvp","title":"In Scope (MVP)","text":"<p>These features WILL be built in MVP:</p>"},{"location":"01-mvp-scope/#projects","title":"Projects","text":"<ul> <li>Create a project with a name</li> <li>List all projects</li> <li>Projects are the top-level container for memory cards</li> </ul>"},{"location":"01-mvp-scope/#memory-cards","title":"Memory Cards","text":"<ul> <li>Create a memory card with type and content</li> <li>List memory cards for a project (newest first)</li> <li>Supported types: <code>decision</code>, <code>finding</code>, <code>definition</code>, <code>note</code>, <code>link</code>, <code>todo</code></li> </ul>"},{"location":"01-mvp-scope/#recall-endpoint","title":"Recall Endpoint","text":"<ul> <li>Query memories by keyword using Postgres FTS ranking</li> <li>Return a formatted \"memory pack\" text block</li> <li>Limit results with <code>?limit=N</code> parameter</li> </ul>"},{"location":"01-mvp-scope/#infrastructure","title":"Infrastructure","text":"<ul> <li>FastAPI backend</li> <li>Postgres database</li> <li>Docker Compose for local/server deployment</li> <li>MkDocs for documentation (this site)</li> <li>Tiny Next.js UI for quick sharing/demo workflows</li> <li>Single environment: dev/staging on Ubuntu server via Tailscale</li> </ul>"},{"location":"01-mvp-scope/#audit-metadata","title":"Audit Metadata","text":"<ul> <li><code>created_at</code> timestamp on all records</li> <li><code>created_by</code> field (prepared for Phase 2)</li> </ul>"},{"location":"01-mvp-scope/#out-of-scope-later-phases","title":"Out of Scope (Later Phases)","text":"<p>These features will NOT be built in MVP:</p> Feature Phase Reason for Deferral Multi-user auth / roles / teams Phase 2 Adds complexity; single-user fine for MVP Embeddings / semantic search Phase 2 Postgres FTS is good enough before vectors Update/delete memory cards Phase 2 Create + list covers core workflow Full production web app Phase 2 MVP UI stays intentionally small Graph database / knowledge graph Phase 3 Premature optimization Tool plugins (ChatGPT/Claude integrations) Phase 3 Paste workflow proves value first MCP server integration Phase 3 Focus on core API first Automatic scraping / agents Never (MVP) Intentional human curation is a core principle"},{"location":"01-mvp-scope/#definition-of-done-mvp","title":"Definition of Done (MVP)","text":"<p>MVP is complete when:</p> <ul> <li>[ ] A user can create a project via API</li> <li>[ ] A user can add memory cards to that project</li> <li>[ ] A user can list memory cards</li> <li>[ ] A user can call <code>/recall?query=...</code> and get a paste-ready text block</li> <li>[ ] The system runs via Docker Compose on the Ubuntu server</li> <li>[ ] Documentation is complete and accessible at the docs site</li> <li>[ ] Demo workflow works end-to-end (create \u2192 add \u2192 recall \u2192 paste into ChatGPT)</li> </ul>"},{"location":"01-mvp-scope/#decisions-made","title":"Decisions Made","text":"Decision Rationale No auto-save High-signal curation requires human intent Postgres FTS + recency fallback Better ranked recall with low complexity No UI in MVP API validates the model; UI is cosmetic Single user Auth is complexity; defer until multi-user needed"},{"location":"02-architecture/","title":"Architecture","text":""},{"location":"02-architecture/#system-overview","title":"System Overview","text":"<pre><code>graph TB\n    subgraph Server [\"Ubuntu Server (Tailscale / private network)\"]\n        WEB[\"Next.js UI&lt;br/&gt;:3000\"]\n        API[\"FastAPI&lt;br/&gt;:8000\"]\n        DB[\"Postgres 16&lt;br/&gt;:5432 (internal)\"]\n        REDIS[\"Redis&lt;br/&gt;:6379 (internal)\"]\n        WORKER[\"Celery Worker/Beat&lt;br/&gt;optional profile\"]\n        DOCS[\"MkDocs&lt;br/&gt;:8001\"]\n    end\n\n    Browser[\"Browser / curl\"] --&gt;|\"HTTP (CORS)\"| WEB\n    Browser --&gt;|\"HTTP + X-API-Key\"| API\n    Browser --&gt;|\"HTTP\"| DOCS\n    WEB --&gt;|\"fetch + credentials:include\"| API\n    API --&gt;|\"asyncpg\"| DB\n    API --&gt;|\"alembic migrations on startup\"| DB\n    API --&gt;|\"rate limits / counters\"| REDIS\n    WORKER --&gt;|\"broker/result\"| REDIS\n    WORKER --&gt;|\"embeddings + cleanup jobs\"| DB\n\n    style Server fill:#f0fdf4,stroke:#14b8a6,stroke-width:2px\n    style API fill:#ecfdf5,stroke:#0d9488\n    style DB fill:#eff6ff,stroke:#2563eb</code></pre>"},{"location":"02-architecture/#auth-flow-magic-link","title":"Auth Flow \u2014 Magic Link","text":"<pre><code>sequenceDiagram\n    actor User\n    participant Web as Next.js UI\n    participant API as FastAPI\n    participant DB as Postgres\n    participant Email as Email (SES / dev log)\n\n    User-&gt;&gt;Web: Enter invited email\n    Web-&gt;&gt;API: POST /auth/request-link {email}\n    API-&gt;&gt;DB: Lookup invite, create magic token\n    API-&gt;&gt;Email: Send link (dev: log debug_link)\n    Email--&gt;&gt;User: Email with ?token=...\n\n    User-&gt;&gt;Web: Click link \u2192 /auth/verify?token=...\n    Web-&gt;&gt;API: GET /auth/verify?token=...\n    API-&gt;&gt;DB: Validate token (expire + mark used)\n    API--&gt;&gt;Web: Set-Cookie: session=... (HttpOnly)\n    Web-&gt;&gt;User: Redirect to /app</code></pre>"},{"location":"02-architecture/#request-lifecycle","title":"Request Lifecycle","text":"<pre><code>sequenceDiagram\n    participant Browser\n    participant API as FastAPI Middleware\n    participant DB as Postgres\n\n    Browser-&gt;&gt;API: Request + Cookie (session) or X-API-Key\n    API-&gt;&gt;DB: Validate session or API key hash\n    DB--&gt;&gt;API: AuthSession / ApiKey row\n    API-&gt;&gt;API: Resolve org_id, role, actor_user_id\n    API-&gt;&gt;DB: Execute business query\n    DB--&gt;&gt;API: Result rows\n    API--&gt;&gt;Browser: JSON response</code></pre>"},{"location":"02-architecture/#components","title":"Components","text":""},{"location":"02-architecture/#1-fastapi-api-server","title":"1. FastAPI (API Server)","text":"<p>Purpose: Handle all HTTP requests for projects, memory cards, and recall.</p> <p>Key details: - Written in Python with FastAPI framework - Connects to Postgres via SQLAlchemy (async) - Runs in Docker container - Exposes port 8000</p> <p>Endpoints: See API Contract</p>"},{"location":"02-architecture/#2-postgres-database","title":"2. Postgres (Database)","text":"<p>Purpose: Persistent storage for projects and memory cards.</p> <p>Key details: - Standard Postgres 16 image - Data persisted in Docker volume (<code>postgres_data</code>) - Only accessible from within Docker network (not exposed externally) - Schema managed by SQLAlchemy models</p> <p>Tables: See Data Model</p>"},{"location":"02-architecture/#3-mkdocs-documentation","title":"3. MkDocs (Documentation)","text":"<p>Purpose: This documentation site\u2014project dashboard and runbooks.</p> <p>Key details: - Material theme for clean UI - Runs in Docker container - Exposes port 8001 - Auto-rebuilds on file changes (dev mode)</p>"},{"location":"02-architecture/#4-nextjs-tiny-web-ui","title":"4. Next.js (Tiny Web UI)","text":"<p>Purpose: Fast shareable interface for creating memories and exporting recall output.</p> <p>Key details: - Next.js app-router frontend - Runs in Docker container - Exposes port 3000 - Proxies <code>/api/*</code> server-side to FastAPI (<code>api:8000</code>) in production mode</p>"},{"location":"02-architecture/#5-backend-module-layout-apiapp","title":"5. Backend module layout (<code>api/app/</code>)","text":"<ul> <li><code>analyzer/algorithm.py</code>: single source of truth for scoring/ranking logic   (FTS/vector/recency weighting, normalization, embedding helpers, Hilbert prefilter mapping).</li> <li><code>analyzer/core.py</code>: compatibility shim; delegates to <code>algorithm.py</code>.</li> <li><code>analyzer/cag.py</code>: cache-augmented generation preload + lookup, pheromone reinforcement/evaporation, KV-cache prep stub.</li> <li><code>auth_routes.py</code>: magic-link/session/admin auth endpoints.</li> <li><code>routes.py</code>: API orchestration and IO; calls analyzer functions for ranking.</li> <li><code>ingestion/</code>: incremental ingestion scaffolding (<code>cocoindex_flow.py</code>, <code>pipeline.py</code>).</li> <li><code>worker/</code>: Celery app/tasks for embeddings and cleanup.</li> <li><code>rate_limit.py</code>: Redis-backed limits and counters.</li> </ul>"},{"location":"02-architecture/#data-flow","title":"Data Flow","text":""},{"location":"02-architecture/#write-path-create-memory-card","title":"Write Path (Create Memory Card)","text":"<pre><code>User                    API                     Postgres\n  \u2502                      \u2502                         \u2502\n  \u2502  POST /memories      \u2502                         \u2502\n  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502                         \u2502\n  \u2502                      \u2502  INSERT INTO memories   \u2502\n  \u2502                      \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n  \u2502                      \u2502                         \u2502\n  \u2502                      \u2502  Return new record      \u2502\n  \u2502                      \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n  \u2502  { id, type, ... }   \u2502                         \u2502\n  \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                         \u2502\n</code></pre>"},{"location":"02-architecture/#read-path-recall-memory-pack","title":"Read Path (Recall Memory Pack)","text":"<pre><code>User                    API                     Postgres\n  \u2502                      \u2502                         \u2502\n  \u2502  GET /recall?query=  \u2502                         \u2502\n  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502                         \u2502\n  \u2502                      \u2502  CAG pre-check (golden docs)  \u2502\n  \u2502                      \u2502  + pheromone cache metadata   \u2502\n  \u2502                      \u2502  if miss: hybrid query        \u2502\n  \u2502                      \u2502  FTS + Hilbert prefilter +    \u2502\n  \u2502                      \u2502  pgvector + recency           \u2502\n  \u2502                      \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502\n  \u2502                      \u2502                         \u2502\n  \u2502                      \u2502  Return matching rows   \u2502\n  \u2502                      \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n  \u2502                      \u2502                         \u2502\n  \u2502                      \u2502  Format as memory pack  \u2502\n  \u2502                      \u2502  (text block)           \u2502\n  \u2502                      \u2502                         \u2502\n  \u2502  { memory_pack_text, \u2502                         \u2502\n  \u2502    items: [...] }    \u2502                         \u2502\n  \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                         \u2502\n</code></pre>"},{"location":"02-architecture/#why-this-works-for-unlimited-context","title":"Why This Works for \"Unlimited Context\"","text":"<p>We don't try to expand the model's context window. That's the model's job.</p> <p>Instead, we produce a curated memory pack:</p> <ol> <li>Human curation \u2014 Only high-signal cards are stored (no noise)</li> <li>Query-scoped \u2014 Recall returns only relevant cards for the query</li> <li>Size-limited \u2014 The <code>limit</code> parameter caps output size</li> <li>Paste-ready \u2014 Formatted text is easy to paste without editing</li> </ol> <p>Result: Prompts stay small, signal stays high.</p>"},{"location":"02-architecture/#technology-choices","title":"Technology Choices","text":"Component Choice Rationale Language Python 3.11+ Team familiarity, ecosystem Framework FastAPI Modern, fast, auto-docs Database Postgres Reliable, battle-tested ORM SQLAlchemy Flexible, async support Package manager uv Fast, lockfile-based Containers Docker Compose Simple multi-service orchestration Docs MkDocs Material Clean, markdown-based"},{"location":"02-architecture/#future-architecture-post-mvp","title":"Future Architecture (Post-MVP)","text":"<p>Phase 2+ may add: - advanced re-ranking (RRF / learned ranking) - dedicated analyzer microservice - external auth providers (OIDC/SSO) - multi-region deployment patterns</p> <p>Beta currently runs hybrid retrieval, Redis-backed limits, and optional worker jobs.</p>"},{"location":"03-data-model/","title":"Data Model","text":""},{"location":"03-data-model/#core-multi-tenant-tables","title":"Core multi-tenant tables","text":""},{"location":"03-data-model/#organizations","title":"<code>organizations</code>","text":"<ul> <li><code>id</code> (PK)</li> <li><code>name</code></li> <li><code>created_at</code></li> </ul>"},{"location":"03-data-model/#users-domain-membership-identity","title":"<code>users</code> (domain membership identity)","text":"<ul> <li><code>id</code> (PK)</li> <li><code>email</code> (unique)</li> <li><code>display_name</code></li> <li><code>created_at</code></li> </ul>"},{"location":"03-data-model/#memberships","title":"<code>memberships</code>","text":"<ul> <li><code>id</code> (PK)</li> <li><code>org_id</code> (FK -&gt; organizations)</li> <li><code>user_id</code> (FK -&gt; users)</li> <li><code>role</code> (<code>owner|admin|member|viewer</code>)</li> <li><code>created_at</code></li> </ul> <p>Unique: <code>(org_id, user_id)</code>.</p>"},{"location":"03-data-model/#projects","title":"<code>projects</code>","text":"<ul> <li><code>id</code> (PK)</li> <li><code>org_id</code> (FK -&gt; organizations)</li> <li><code>created_by_user_id</code> (FK -&gt; users, nullable)</li> <li><code>name</code></li> <li><code>created_at</code></li> </ul>"},{"location":"03-data-model/#memories","title":"<code>memories</code>","text":"<ul> <li><code>id</code> (PK)</li> <li><code>project_id</code> (FK -&gt; projects)</li> <li><code>type</code></li> <li><code>content</code></li> <li><code>search_vector</code> (<code>jsonb</code>, deterministic/local embedding fallback payload)</li> <li><code>embedding_vector</code> (<code>vector(1536)</code>, pgvector cosine search)</li> <li><code>hilbert_index</code> (<code>bigint</code>, locality-preserving prefilter key)</li> <li><code>search_tsv</code> (<code>tsvector</code>)</li> <li><code>created_at</code></li> </ul> <p>FTS index: <code>GIN(search_tsv)</code>. Vector index: <code>ivfflat(embedding_vector vector_cosine_ops)</code>. Prefilter index: <code>BTREE(project_id, hilbert_index)</code>.</p>"},{"location":"03-data-model/#api_keys","title":"<code>api_keys</code>","text":"<ul> <li><code>id</code> (PK)</li> <li><code>org_id</code> (FK -&gt; organizations)</li> <li><code>name</code></li> <li><code>key_hash</code> (SHA-256 hex, unique)</li> <li><code>prefix</code></li> <li><code>created_at</code></li> <li><code>revoked_at</code> (nullable)</li> </ul>"},{"location":"03-data-model/#audit_logs","title":"<code>audit_logs</code>","text":"<ul> <li><code>id</code> (PK)</li> <li><code>org_id</code> (FK -&gt; organizations)</li> <li><code>actor_user_id</code> (FK -&gt; users, nullable)</li> <li><code>api_key_prefix</code> (nullable)</li> <li><code>action</code></li> <li><code>entity_type</code></li> <li><code>entity_id</code></li> <li><code>metadata</code> (<code>jsonb</code>)</li> <li><code>created_at</code></li> </ul>"},{"location":"03-data-model/#auth-tables-invite-only-alpha","title":"Auth tables (invite-only alpha)","text":""},{"location":"03-data-model/#auth_users","title":"<code>auth_users</code>","text":"<ul> <li><code>id</code> (PK)</li> <li><code>email</code> (unique, lowercase)</li> <li><code>created_at</code></li> <li><code>last_login_at</code> (nullable)</li> <li><code>is_admin</code> (bool)</li> <li><code>is_disabled</code> (bool)</li> <li><code>invite_accepted_at</code> (nullable)</li> <li><code>invite_token_hash</code> (nullable)</li> </ul>"},{"location":"03-data-model/#auth_magic_links","title":"<code>auth_magic_links</code>","text":"<ul> <li><code>id</code> (PK)</li> <li><code>email</code> (indexed)</li> <li><code>token_hash</code> (unique, indexed)</li> <li><code>created_at</code></li> <li><code>expires_at</code></li> <li><code>consumed_at</code> (nullable)</li> <li><code>request_ip</code> (nullable)</li> <li><code>user_agent</code> (nullable)</li> <li><code>purpose</code> (<code>login</code> now)</li> <li><code>send_status</code> (<code>sent|failed|logged</code>)</li> </ul>"},{"location":"03-data-model/#auth_sessions","title":"<code>auth_sessions</code>","text":"<ul> <li><code>id</code> (PK)</li> <li><code>user_id</code> (FK -&gt; auth_users)</li> <li><code>session_token_hash</code> (unique)</li> <li><code>created_at</code></li> <li><code>expires_at</code></li> <li><code>revoked_at</code> (nullable)</li> <li><code>last_seen_at</code></li> <li><code>ip</code> (nullable)</li> <li><code>user_agent</code> (nullable)</li> <li><code>device_label</code> (nullable)</li> </ul>"},{"location":"03-data-model/#auth_invites","title":"<code>auth_invites</code>","text":"<ul> <li><code>id</code> (PK)</li> <li><code>email</code> (indexed)</li> <li><code>invited_by_user_id</code> (FK -&gt; auth_users, nullable)</li> <li><code>created_at</code></li> <li><code>expires_at</code></li> <li><code>accepted_at</code> (nullable)</li> <li><code>revoked_at</code> (nullable)</li> <li><code>notes</code> (nullable)</li> </ul>"},{"location":"03-data-model/#usage_events","title":"<code>usage_events</code>","text":"<ul> <li><code>id</code> (PK)</li> <li><code>user_id</code> (FK -&gt; auth_users, nullable)</li> <li><code>event_type</code> (<code>login_requested|login_success|project_created|memory_created|recall_called</code>)</li> <li><code>created_at</code></li> <li><code>ip_prefix</code> (coarse <code>/24</code> or <code>/64</code>)</li> <li><code>user_agent_hash</code> (nullable)</li> <li><code>project_id</code> (nullable)</li> <li><code>org_id</code> (nullable)</li> </ul>"},{"location":"03-data-model/#recall-behavior","title":"Recall behavior","text":"<p>Primary retrieval uses hybrid ranking: - <code>websearch_to_tsquery('english', query)</code> - FTS filter/rank: <code>search_tsv @@ tsquery</code>, <code>ts_rank_cd(search_tsv, tsquery)</code> - vector kNN: <code>ORDER BY embedding_vector &lt;=&gt; query_vector ASC</code> - Hilbert prefilter: <code>hilbert_index BETWEEN low AND high</code> before vector kNN - CAG pre-check: in-memory static corpus with semantic match - tie-break: <code>created_at desc</code></p> <p>Fallback: latest memories when hybrid candidates are empty.</p>"},{"location":"04-api-contract/","title":"API Contract","text":"<p>Base URL: <code>http://&lt;host&gt;:8000</code></p>"},{"location":"04-api-contract/#public-endpoints","title":"Public endpoints","text":"<ul> <li><code>GET /health</code></li> <li><code>GET /docs</code></li> <li><code>GET /openapi.json</code></li> <li><code>POST /auth/request-link</code></li> <li><code>GET /auth/verify?token=...</code></li> </ul>"},{"location":"04-api-contract/#authentication","title":"Authentication","text":"<p>Protected endpoints accept either:</p> <ol> <li>Session cookie (<code>contextcache_session</code>) from magic-link login (web flow)</li> <li><code>X-API-Key</code> (programmatic/dev flow)</li> </ol> <p>Org scoping: - API-key requests can send <code>X-Org-Id</code> (must match key org). - Session requests derive org from domain membership; optional <code>X-Org-Id</code> must be one of user memberships.</p> <p>Dev-only header: - <code>X-User-Email</code> is honored only in <code>APP_ENV=dev</code>.</p> <p>If no active API keys exist: - <code>APP_ENV=dev</code>: bootstrap convenience may allow keyless API-key path. - non-dev: protected requests return <code>503</code> until keys exist.</p>"},{"location":"04-api-contract/#auth-endpoints","title":"Auth endpoints","text":""},{"location":"04-api-contract/#post-authrequest-link","title":"<code>POST /auth/request-link</code>","text":"<p>Body: <pre><code>{\"email\":\"user@example.com\"}\n</code></pre> Rules: - invite-only (or existing user) - rate-limited per IP + per email</p> <p>Response <code>200</code>: <pre><code>{\"status\":\"ok\",\"detail\":\"Check your email for a sign-in link.\",\"debug_link\":null}\n</code></pre> <code>debug_link</code> is only returned in dev when SES fallback logging is used. If the email already belongs to an existing user, <code>detail</code> is a friendly \"already registered\" sign-in message.</p>"},{"location":"04-api-contract/#get-authverifytoken","title":"<code>GET /auth/verify?token=...</code>","text":"<ul> <li>validates single-use token</li> <li>consumes token</li> <li>creates/updates user</li> <li>sets HttpOnly session cookie</li> </ul> <p>Response <code>200</code>: <pre><code>{\"status\":\"ok\",\"redirect_to\":\"/app\"}\n</code></pre></p>"},{"location":"04-api-contract/#post-authlogout","title":"<code>POST /auth/logout</code>","text":"<p>Revokes current session cookie.</p>"},{"location":"04-api-contract/#get-authme","title":"<code>GET /auth/me</code>","text":"<p>Session-only endpoint.</p> <p>Response: <pre><code>{\"email\":\"user@example.com\",\"is_admin\":true,\"is_unlimited\":false,\"created_at\":\"...\",\"last_login_at\":\"...\"}\n</code></pre></p>"},{"location":"04-api-contract/#admin-endpoints","title":"Admin endpoints","text":"<p>Admin routes allow either: - session auth with <code>is_admin=true</code> - API key auth where resolved org role is <code>admin</code> or <code>owner</code></p> <p>Non-admin returns <code>403</code>.</p>"},{"location":"04-api-contract/#invite-management","title":"Invite management","text":"Method Path Description <code>POST</code> <code>/admin/invites</code> Create invite \u2014 body: <code>{\"email\":\"...\",\"notes\":\"...\"}</code> (returns <code>409</code> when user already exists or active invite exists) <code>GET</code> <code>/admin/invites</code> List invites (<code>limit</code>, <code>offset</code>, <code>email_q</code>, <code>status</code>) <code>POST</code> <code>/admin/invites/{id}/revoke</code> Revoke a pending invite"},{"location":"04-api-contract/#waitlist-management","title":"Waitlist management","text":"Method Path Description <code>POST</code> <code>/waitlist</code> Public \u2014 join waitlist; body: <code>{\"email\":\"...\"}</code> (<code>409</code> if already waitlisted) <code>POST</code> <code>/waitlist/join</code> Alias for the above <code>GET</code> <code>/admin/waitlist</code> List waitlist entries (admin only), supports <code>limit</code>, <code>offset</code>, <code>status</code>, <code>email_q</code> <code>POST</code> <code>/admin/waitlist/{id}/approve</code> Approve \u2192 creates invite (<code>409</code> when user already exists or active invite exists) <code>POST</code> <code>/admin/waitlist/{id}/reject</code> Reject waitlist entry"},{"location":"04-api-contract/#user-management","title":"User management","text":"Method Path Description <code>GET</code> <code>/admin/users</code> List users (<code>limit</code>, <code>offset</code>, <code>email_q</code>, <code>status=active|disabled</code>, <code>is_admin</code>, <code>is_disabled</code>) <code>POST</code> <code>/admin/users/{id}/disable</code> Disable user account <code>POST</code> <code>/admin/users/{id}/enable</code> Re-enable user account <code>POST</code> <code>/admin/users/{id}/revoke-sessions</code> Revoke all active sessions <code>POST</code> <code>/admin/users/{id}/grant-admin</code> Grant admin role <code>POST</code> <code>/admin/users/{id}/revoke-admin</code> Remove admin role <code>POST</code> <code>/admin/users/{id}/set-unlimited?unlimited=true\\|false</code> Toggle daily usage limit bypass <code>GET</code> <code>/admin/users/{id}/stats</code> Per-user usage stats (total memories, today counters) <code>GET</code> <code>/admin/users/{id}/login-events</code> Last 10 login IP records <p>Response for <code>GET /admin/users/{id}/stats</code>: <pre><code>{\n  \"user_id\": 1,\n  \"memory_count\": 42,\n  \"today_memories\": 3,\n  \"today_recalls\": 7,\n  \"today_projects\": 1\n}\n</code></pre></p>"},{"location":"04-api-contract/#usage-summary","title":"Usage summary","text":"Method Path Description <code>GET</code> <code>/admin/usage</code> Usage summary across all users <code>GET</code> <code>/admin/recall/logs</code> Last recall decision logs (<code>limit</code>, <code>offset</code>, <code>project_id</code>) <code>GET</code> <code>/admin/cag/cache-stats</code> CAG cache metrics (pheromone/LRU state, hit rate, KV stub budget) <code>POST</code> <code>/admin/cag/evaporate</code> Trigger immediate pheromone evaporation pass <code>GET</code> <code>/me/usage</code> Current user's today usage + configured limits <p>Example <code>GET /admin/recall/logs</code> item:</p> <pre><code>{\n  \"id\": 12,\n  \"org_id\": 1,\n  \"project_id\": 3,\n  \"actor_user_id\": 5,\n  \"strategy\": \"hybrid\",\n  \"query_text\": \"migration reliability\",\n  \"input_memory_ids\": [44, 45, 46],\n  \"ranked_memory_ids\": [45, 44],\n  \"weights\": {\"fts\": 0.65, \"vector\": 0.25, \"recency\": 0.1},\n  \"score_details\": {\"45\": {\"fts\": 1.0, \"vector\": 0.51, \"recency\": 0.92, \"total\": 0.78}},\n  \"created_at\": \"2026-02-20T01:23:45Z\"\n}\n</code></pre> <p>Response for <code>GET /me/usage</code>: <pre><code>{\n  \"day\": \"2026-02-19\",\n  \"week_start\": \"2026-02-17\",\n  \"memories_created\": 4,\n  \"recall_queries\": 2,\n  \"projects_created\": 1,\n  \"weekly_memories_created\": 9,\n  \"weekly_recall_queries\": 7,\n  \"weekly_projects_created\": 2,\n  \"limits\": {\n    \"memories_per_day\": 100,\n    \"recalls_per_day\": 50,\n    \"projects_per_day\": 10,\n    \"memories_per_week\": 500,\n    \"recalls_per_week\": 300,\n    \"projects_per_week\": 50\n  }\n}\n</code></pre></p> <p>Daily + weekly limits are configured via environment variables (<code>DAILY_MAX_*</code>, <code>WEEKLY_MAX_*</code>). Set to <code>0</code> to disable. Users with <code>is_unlimited=true</code> bypass all limits regardless of global values.</p>"},{"location":"04-api-contract/#core-orgproject-endpoints","title":"Core org/project endpoints","text":"<ul> <li><code>GET /me</code></li> <li><code>GET /me/orgs</code></li> <li><code>POST /orgs</code></li> <li><code>GET /orgs</code></li> <li><code>POST /orgs/{org_id}/projects</code></li> <li><code>GET /orgs/{org_id}/projects</code></li> <li><code>POST /projects</code></li> <li><code>GET /projects</code></li> <li><code>POST /projects/{project_id}/memories</code></li> <li><code>POST /integrations/memories</code></li> <li><code>GET /integrations/memories?project_id=...&amp;limit=...&amp;offset=...</code></li> <li><code>POST /integrations/memories/{memory_id}/contextualize</code></li> <li><code>GET /projects/{project_id}/memories</code></li> <li><code>GET /projects/{project_id}/recall?query=...&amp;limit=10</code></li> <li><code>GET /health/worker</code></li> <li><code>GET /health/redis</code></li> </ul>"},{"location":"04-api-contract/#recall-response","title":"Recall response","text":"<pre><code>{\n  \"project_id\": 1,\n  \"query\": \"migrations reliability\",\n  \"memory_pack_text\": \"...\",\n  \"items\": [\n    {\n      \"id\": 11,\n      \"project_id\": 1,\n      \"type\": \"finding\",\n      \"content\": \"...\",\n      \"created_at\": \"...\",\n      \"rank_score\": 0.42\n    }\n  ]\n}\n</code></pre> <ul> <li>Recall ranking uses hybrid scoring:</li> <li>CAG pre-check: static golden-knowledge cache can short-circuit with a direct pack answer.</li> <li>CAG matching uses in-memory semantic embeddings plus pheromone-guided cache reinforcement.</li> <li>Postgres FTS with <code>websearch_to_tsquery('english', query)</code> + <code>ts_rank_cd</code></li> <li>pgvector cosine similarity from <code>memories.embedding_vector</code> (when vectors exist)</li> <li>Hilbert 1D prefilter on <code>memories.hilbert_index</code> before pgvector kNN distance ordering</li> <li>Recency boost</li> <li>Vector candidate query is index-friendly (HNSW/IVFFlat) and orders by raw distance:</li> <li><code>ORDER BY memories.embedding_vector &lt;=&gt; :query_vector ASC</code></li> <li><code>vector_score</code> is still returned/merged as <code>1 - distance</code></li> <li>Prefilter window: <code>memories.hilbert_index BETWEEN :low AND :high</code></li> <li>Recall execution uses request hedging:</li> <li>Local CAG mode (<code>CAG_MODE=local</code>): run CAG synchronously first, then immediate RAG fallback on miss.</li> <li>Remote CAG mode: CAG starts first, and RAG starts speculatively after hedge delay.</li> <li>Hedge delay uses cached org-local p95 (written by worker task) when <code>HEDGE_USE_P95_CACHE=true</code>.</li> <li>If no cached p95 is available, hedge delay falls back to static <code>HEDGE_DELAY_MS</code>.</li> <li>First completed backend response is returned; slower task is canceled.</li> <li>Strategy and score details are written to <code>recall_logs</code> and visible via admin endpoint.</li> <li>Latency telemetry is written to <code>recall_timings</code> (<code>served_by</code>, <code>cag_duration_ms</code>, <code>rag_duration_ms</code>, <code>total_duration_ms</code>, <code>hedge_delay_ms</code>).</li> <li>Weights are env-configurable (<code>FTS_WEIGHT</code>, <code>VECTOR_WEIGHT</code>, <code>RECENCY_WEIGHT</code>).</li> <li>Hedging envs: <code>HEDGE_DELAY_MS</code>, <code>HEDGE_MIN_DELAY_MS</code>, <code>HEDGE_USE_P95_CACHE</code>, <code>HEDGE_P95_CACHE_TTL_SECONDS</code>.</li> <li>Vector prefilter envs: <code>HILBERT_ENABLED</code>, <code>HILBERT_BITS</code>, <code>HILBERT_RADIUS</code>, <code>HILBERT_MIN_ROWS</code>, <code>HILBERT_WIDEN_MULT</code>.</li> <li>CAG envs: <code>CAG_MODE</code>, <code>CAG_EMBEDDING_MODEL_NAME</code>, <code>CAG_EMBEDDING_PROVIDER</code>, <code>CAG_EMBEDDING_DIMS</code>, <code>CAG_MATCH_THRESHOLD</code>, <code>CAG_CACHE_MAX_ITEMS</code>, <code>CAG_PHEROMONE_HIT_BOOST</code>, <code>CAG_PHEROMONE_EVAPORATION</code>, <code>CAG_EVAPORATION_INTERVAL_SECONDS</code>.</li> <li>Rows returned from hybrid scoring include <code>rank_score</code> (float).</li> <li>Recency fallback rows use <code>rank_score: null</code>.</li> <li>CAG short-circuit responses return <code>items: []</code> and keep the same <code>memory_pack_text</code> format.</li> <li><code>memory_pack_text</code> remains grouped and paste-ready.</li> </ul>"},{"location":"04-api-contract/#integration-capture-endpoint","title":"Integration capture endpoint","text":"<p><code>POST /integrations/memories</code> accepts:</p> <pre><code>{\n  \"project_id\": 1,\n  \"type\": \"note\",\n  \"source\": \"extension\",\n  \"title\": \"Optional\",\n  \"content\": \"Captured content\",\n  \"metadata\": {},\n  \"tags\": []\n}\n</code></pre> <p>It is functionally equivalent to <code>POST /projects/{project_id}/memories</code> and keeps the same auth + rate-limit behavior.</p> <p>Optional signing header for inbound integrations: - <code>X-Integration-Signature: sha256=&lt;hex-hmac&gt;</code> - HMAC is computed over raw request body with <code>INTEGRATION_SIGNING_SECRET</code>. - If <code>INTEGRATION_SIGNING_SECRET</code> is unset, signature checking is skipped.</p> <p><code>GET /integrations/memories</code> returns recent ingested memories: - with <code>project_id</code>: scoped to one project - without <code>project_id</code>: scoped to current org</p>"},{"location":"04-api-contract/#session-org-switching","title":"Session org switching","text":"<ul> <li><code>GET /me/orgs</code> returns organizations available to the current actor.</li> <li>session auth: all org memberships for the signed-in user</li> <li>API key auth: the key-scoped org only</li> <li>The web app uses <code>X-Org-Id</code> on org-scoped requests so users can switch orgs without re-login.</li> </ul> <p><code>POST /integrations/memories/{memory_id}/contextualize</code> queues an Ollama contextualization worker task.</p>"},{"location":"04-api-contract/#workerredis-health","title":"Worker/Redis health","text":"<ul> <li><code>GET /health/worker</code></li> <li>returns worker enablement and broker URL (<code>status: ok|disabled</code>)</li> <li><code>GET /health/redis</code></li> <li>connectivity probe to the Redis broker host (<code>status: ok|unreachable</code>)</li> </ul>"},{"location":"04-api-contract/#errors","title":"Errors","text":"<pre><code>{\"detail\":\"...\"}\n</code></pre> <p>Common codes: <code>400</code>, <code>401</code>, <code>403</code>, <code>404</code>, <code>422</code>, <code>429</code>, <code>500</code>, <code>503</code>.</p>"},{"location":"05-aco-cache/","title":"Ant Colony Optimization (ACO) Cache","text":"<p>The ContextCache platform implements a dynamic, reinforcement-based caching layer inspired by Ant Colony Optimization algorithms, replacing a traditional static Cache-Augmented Generation (CAG) mechanism.</p> <p>This document describes how the ACO cache works, how pheromones are applied, and how data evaporates or gets evicted to maintain fresh context budgets.</p>"},{"location":"05-aco-cache/#principles-of-aco-in-contextcache","title":"Principles of ACO in ContextCache","text":"<p>The objective is to ensure that the most relevant and frequently useful data chunk memories remain in the fast, in-memory KV-cache budget of LLM generation models, while obsolete or low-value information gracefully decays and drops out.</p>"},{"location":"05-aco-cache/#1-pheromone-reinforcement","title":"1. Pheromone Reinforcement","text":"<p>Whenever a Memory Chunk is surfaced repeatedly through standard Hybrid Recall (FTS + Vector search) and actively selected or interacted with by a downstream consumer, the system deposits a \"pheromone\" boost on that specific chunk (<code>CAG_PHEROMONE_HIT_BOOST=0.2</code>). Check <code>promote_cag_chunk</code> in the core engine.</p> <pre><code># In api/app/analyzer/cag.py\nchunk.pheromone_level = max(\n    CAG_PHEROMONE_MIN,\n    min(CAG_PHEROMONE_MAX, chunk.pheromone_level + CAG_PHEROMONE_HIT_BOOST)\n)\n</code></pre>"},{"location":"05-aco-cache/#2-evaporation-layer-decay","title":"2. Evaporation Layer (Decay)","text":"<p>Pheromones naturally decay (evaporate) over time if the chunk is not continually accessed. A background worker loop in <code>main.py</code> explicitly runs an evaporation function (<code>cag.maybe_evaporate_due()</code>) at configured intervals (<code>CAG_EVAPORATION_INTERVAL_SECONDS</code>).</p> <p>Each cycle decreases the pheromone concentration for all loaded chunks by <code>CAG_PHEROMONE_EVAP_RATE</code> (e.g., <code>0.05</code>). </p> <pre><code>chunk.pheromone_level = max(CAG_PHEROMONE_MIN, chunk.pheromone_level - CAG_PHEROMONE_EVAP_RATE)\n</code></pre>"},{"location":"05-aco-cache/#3-hybrid-eviction-policy","title":"3. Hybrid Eviction Policy","text":"<p>Because the memory budget is finite (<code>CAG_MAX_TOKENS=32000</code>, <code>CAG_CACHE_MAX_ITEMS=1000</code>), the cache will eventually fill up. The eviction process triggers an evict-to-capacity response when bounds are exceeded. </p> <p>Chunks compete to stay alive based on: 1. Pheromone Level: The primary metric. Lowest pheromones are popped first. 2. Access Recency (Tiebreaker): Older chunk access is evicted before recently hit ones. 3. Creation At (Tiebreaker): LIFO style last resort.</p>"},{"location":"05-aco-cache/#integrating-with-the-rag-loop","title":"Integrating with the RAG Loop","text":"<p>When a standard RAG hit clears an upper confidence threshold (e.g., <code>vector_min_score</code>), the top result gets immediately processed by <code>promote_cag_chunk()</code>. This creates a secondary flywheel that keeps high-fidelity facts immediately accessible on the \"hot\" path without waiting for explicit promotion protocols.</p>"},{"location":"05-aco-cache/#monitoring","title":"Monitoring","text":"<p>System performance related to the CAG is exposed at the <code>/health/perf</code> admin endpoint. It yields: - Enabled state - Active memory Mode - Item Count - Current Estimated Tokens - Total Eviction counts - Cache creation/update timestamps</p>"},{"location":"05-dev-workflow/","title":"Dev Workflow","text":""},{"location":"05-dev-workflow/#start-stack","title":"Start stack","text":"<pre><code>docker compose up -d --build\n</code></pre> <p><code>docker compose</code> loads <code>.env</code> automatically. Prefer that over <code>source .env</code>. If you source manually, quote values that contain spaces.</p> <p>Services: - API: <code>:8000</code> - Web: <code>:3000</code> - Docs: <code>:8001</code> - DB: internal only</p>"},{"location":"05-dev-workflow/#run-tests","title":"Run tests","text":"<pre><code>docker compose --profile test run --rm api-test\n</code></pre>"},{"location":"05-dev-workflow/#linting","title":"Linting","text":"<pre><code>uv --project api run black --check app tests\nuv --project api run flake8 app tests\nuv --project api run bandit -r app -x tests\nuv --project api run pip-audit -r requirements.lock\nnpm --prefix web run lint\n</code></pre> <p>Optional hooks:</p> <pre><code>pip install pre-commit\npre-commit install\n</code></pre> <p>Optional explicit test DB boot:</p> <pre><code>docker compose --profile test up -d db-test\ndocker compose --profile test run --rm api-test\ndocker compose --profile test down -v\n</code></pre>"},{"location":"05-dev-workflow/#invite-only-auth-flow","title":"Invite-only auth flow","text":"<ol> <li>Sign in as admin (existing session) and open <code>/admin</code>.</li> <li>Create invite for user email.</li> <li>User opens <code>/auth</code> and requests link.</li> <li>In dev, if SES fails/sandbox blocks, use <code>debug_link</code> returned by <code>/auth/request-link</code>.</li> <li><code>/auth/verify</code> sets session cookie and redirects to <code>/app</code>.</li> </ol>"},{"location":"05-dev-workflow/#multi-org-behavior-in-the-web-ui","title":"Multi-org behavior in the web UI","text":"<ul> <li>The <code>/app</code> sidebar always shows current Organization Scope.</li> <li>If your user belongs to multiple orgs, use the org selector to switch project context.</li> <li>The selected org id is saved in browser localStorage as <code>CONTEXTCACHE_ORG_ID</code>.</li> <li>If you seed data into another org and do not see it, switch org scope first.</li> </ul> <p>Admin guidance: - <code>POST /admin/invites</code> is for direct access grants (known email). - Waitlist flow is for inbound requests:   1. user joins via <code>POST /waitlist</code>   2. admin reviews in <code>/admin/waitlist</code>   3. approve creates an invite automatically.</p>"},{"location":"05-dev-workflow/#programmatic-api-flow-api-keys","title":"Programmatic API flow (API keys)","text":"<p>Use <code>X-API-Key</code> (and optional <code>X-Org-Id</code>) for scripts/CLI.</p> <pre><code>curl -s http://127.0.0.1:8000/projects \\\n  -H \"X-API-Key: $BOOTSTRAP_API_KEY\"\n</code></pre>"},{"location":"05-dev-workflow/#cors-preflight-check","title":"CORS preflight check","text":"<pre><code>curl -i -X OPTIONS \"http://127.0.0.1:8000/projects\" \\\n  -H \"Origin: http://127.0.0.1:3000\" \\\n  -H \"Access-Control-Request-Method: GET\" \\\n  -H \"Access-Control-Request-Headers: x-api-key,x-org-id,content-type\"\n</code></pre> <p>Expected: <code>200/204</code> and <code>Access-Control-Allow-*</code> headers including requested auth headers.</p>"},{"location":"05-dev-workflow/#migration-flow","title":"Migration flow","text":"<p>API runtime starts with:</p> <pre><code>python -m app.migrate\n</code></pre> <p>Behavior: - fresh DB: <code>upgrade head</code> - legacy DB without alembic row: stamp baseline then upgrade - normal DB: upgrade head</p> <p>Manual run:</p> <pre><code>docker compose exec api uv run python -m app.migrate\n</code></pre>"},{"location":"05-dev-workflow/#cag-cache-diagnostics-admin","title":"CAG cache diagnostics (admin)","text":"<pre><code>python cli/cc.py admin cag-stats --api-base https://api.thecontextcache.com --api-key cck_xxx --org-id 1\npython cli/cc.py admin cag-evaporate --api-base https://api.thecontextcache.com --api-key cck_xxx --org-id 1\n</code></pre>"},{"location":"05-dev-workflow/#server-docs-link","title":"Server docs link","text":"<p>Set <code>NEXT_PUBLIC_DOCS_URL</code> in <code>.env</code> when the docs host differs from <code>http://&lt;server&gt;:8001</code>.</p> <p>Example:</p> <pre><code>NEXT_PUBLIC_DOCS_URL=https://docs.thecontextcache.com\n</code></pre>"},{"location":"06-deployment/","title":"Deployment","text":"<p>Three supported deployment modes. Pick one, set the env vars, rebuild.</p>"},{"location":"06-deployment/#mode-c-cloudflare-tunnel-subdomain-deployment-recommended-for-production","title":"Mode C \u2014 Cloudflare Tunnel (Subdomain deployment \u2014 RECOMMENDED for production)","text":"<p>Each service gets its own public subdomain. No nginx sidecar needed.</p> <pre><code>https://thecontextcache.com       \u2192 web:3000   (Next.js)\nhttps://api.thecontextcache.com   \u2192 api:8000   (FastAPI)\nhttps://docs.thecontextcache.com  \u2192 docs:8001  (MkDocs)\n</code></pre> <p>The web UI calls <code>/api/*</code> through the Next.js server-side proxy \u2014 the browser never talks to <code>api.thecontextcache.com</code> directly. This means:</p> <ul> <li>Zero CORS issues for the web UI</li> <li>Session cookies set correctly on <code>thecontextcache.com</code></li> <li>The API subdomain is still exposed for CLI and direct API access</li> </ul>"},{"location":"06-deployment/#1-create-and-authenticate-the-tunnel","title":"1. Create and authenticate the tunnel","text":"<pre><code>cloudflared login\ncloudflared tunnel create contextcache\n</code></pre>"},{"location":"06-deployment/#2-add-dns-records-cloudflare-dashboard","title":"2. Add DNS records (Cloudflare dashboard)","text":"<p>In Zero Trust \u2192 Tunnels \u2192 your tunnel \u2192 Public Hostnames, add:</p> Subdomain Domain Type URL (blank) <code>thecontextcache.com</code> HTTP <code>http://localhost:3000</code> <code>api</code> <code>thecontextcache.com</code> HTTP <code>http://localhost:8000</code> <code>docs</code> <code>thecontextcache.com</code> HTTP <code>http://localhost:8001</code> <p>Or use the config file at <code>docs/examples/cloudflared-config.yml</code>.</p>"},{"location":"06-deployment/#3-install-config","title":"3. Install config","text":"<pre><code>sudo cp docs/examples/cloudflared-config.yml /etc/cloudflared/config.yml\n# Edit tunnel ID and credentials-file path\nsudo nano /etc/cloudflared/config.yml\n</code></pre>"},{"location":"06-deployment/#4-install-as-systemd-service","title":"4. Install as systemd service","text":"<pre><code>sudo cloudflared service install\nsudo systemctl enable --now cloudflared\n</code></pre>"},{"location":"06-deployment/#5-env-mode-c","title":"5. .env (Mode C)","text":"<pre><code>APP_ENV=prod\nAPP_PUBLIC_BASE_URL=https://thecontextcache.com\nCORS_ORIGINS=https://thecontextcache.com\n\n# Leave NEXT_PUBLIC_API_BASE_URL blank \u2014 the Next.js proxy handles /api/*\nNEXT_PUBLIC_API_BASE_URL=\nNEXT_PUBLIC_DOCS_URL=https://docs.thecontextcache.com\n\nAWS_REGION=us-east-1\nAWS_ACCESS_KEY_ID=&lt;from secrets&gt;\nAWS_SECRET_ACCESS_KEY=&lt;from secrets&gt;\nSES_FROM_EMAIL=support@thecontextcache.com\n\nPOSTGRES_USER=contextcache\nPOSTGRES_PASSWORD=&lt;strong-random-password&gt;\nPOSTGRES_DB=contextcache\n\nDAILY_MAX_MEMORIES=100\nDAILY_MAX_RECALLS=50\nDAILY_MAX_PROJECTS=10\n\n# Recall hedging (latency optimization)\nHEDGE_DELAY_MS=120\nHEDGE_MIN_DELAY_MS=25\nHEDGE_USE_P95_CACHE=true\nHEDGE_P95_CACHE_TTL_SECONDS=900\n\n# Hilbert prefilter for vector candidate narrowing\nHILBERT_ENABLED=false\nHILBERT_BITS=12\nHILBERT_RADIUS=500000\nHILBERT_MIN_ROWS=500\nHILBERT_WIDEN_MULT=2.0\nHILBERT_PREFILTER_CANDIDATES=5000\nCAG_CACHE_MAX_ITEMS=512\nCAG_PHEROMONE_BASE=1.0\nCAG_PHEROMONE_HIT_BOOST=0.15\nCAG_PHEROMONE_EVAPORATION=0.95\nCAG_EVAPORATION_INTERVAL_SECONDS=600\nCAG_KV_STUB_ENABLED=true\n</code></pre>"},{"location":"06-deployment/#6-start","title":"6. Start","text":"<pre><code>docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d --build\nsudo systemctl start cloudflared\n</code></pre>"},{"location":"06-deployment/#dev-vs-prod-compose","title":"Dev vs prod compose","text":"<ul> <li>Dev local/server testing:</li> </ul> <pre><code>docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d --build\n</code></pre> <ul> <li>Prod (localhost-only binds for Cloudflared):</li> </ul> <pre><code>docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d --build\n</code></pre>"},{"location":"06-deployment/#compose-profiles","title":"Compose profiles","text":"<ul> <li>default profile: <code>db</code>, <code>api</code>, <code>web</code>, <code>docs</code>, <code>redis</code></li> <li><code>test</code> profile: <code>db-test</code>, <code>api-test</code></li> <li><code>worker</code> profile: <code>worker</code>, <code>beat</code></li> </ul> <pre><code># default runtime\ndocker compose up -d --build\n\n# test stack\ndocker compose --profile test run --rm api-test\n\n# worker stack\ndocker compose --profile worker up -d worker beat\n</code></pre>"},{"location":"06-deployment/#hedged-recall-tuning","title":"Hedged recall tuning","text":"<p>Recall uses speculative execution between: - CAG (cache/golden-knowledge lookup) - RAG (hybrid FTS + vector retrieval)</p> <p>Behavior: - CAG starts first. - If CAG is still running after hedge delay, RAG starts. - First completed result wins; the slower task is canceled. - In <code>CAG_MODE=local</code>, hedging is bypassed and CAG runs synchronously before RAG fallback.</p> <p>Config: - <code>HEDGE_DELAY_MS</code>: base hedge delay in milliseconds. - <code>HEDGE_MIN_DELAY_MS</code>: lower bound guardrail. - <code>HEDGE_USE_P95_CACHE=true</code>: use cached org-local p95 from Redis instead of static delay. - <code>HEDGE_P95_CACHE_TTL_SECONDS</code>: Redis TTL for cached p95 values.</p> <p>Worker job: - Celery Beat refreshes p95 cache every 5 minutes via <code>contextcache.refresh_recall_hedge_p95_cache</code>. - It aggregates <code>recall_timings</code> per org and writes values to Redis keys <code>hedge:p95:org:&lt;id&gt;</code>. - If worker/beat is disabled, recall falls back to static <code>HEDGE_DELAY_MS</code>.</p> <p>Recommendation: - Start with <code>HEDGE_DELAY_MS=120</code>, then tune using observed <code>recall_timings</code> in production.</p>"},{"location":"06-deployment/#cag-pheromone-cache-behavior","title":"CAG pheromone cache behavior","text":"<p>CAG now maintains in-memory cache metadata for each golden-knowledge chunk:</p> <ul> <li><code>pheromone_level</code> (reinforced on cache hits)</li> <li><code>last_accessed_at</code> (LRU signal)</li> </ul> <p>Eviction policy: - Lowest pheromone first - LRU tiebreaker when pheromone is equal</p> <p>Evaporation: - API process runs an async evaporation loop every <code>CAG_EVAPORATION_INTERVAL_SECONDS</code> (default 600s). - Each pass multiplies pheromone by <code>CAG_PHEROMONE_EVAPORATION</code> (default <code>0.95</code>).</p> <p>Admin controls: - <code>GET /admin/cag/cache-stats</code> - <code>POST /admin/cag/evaporate</code></p>"},{"location":"06-deployment/#7-stale-codecache-troubleshooting-root-vs-app","title":"7. Stale code/cache troubleshooting (root vs <code>/app</code>)","text":"<p>If <code>/</code> shows an old layout or redirects don\u2019t apply:</p> <ol> <li>Rebuild web image without cache:</li> </ol> <pre><code>docker compose build --no-cache web\ndocker compose up -d web\n</code></pre> <ol> <li>Verify middleware is included in the built image:</li> </ol> <pre><code>docker compose exec web ls -la /app/middleware.js\n</code></pre> <ol> <li>Purge Cloudflare cache (dashboard):</li> <li>Caching \u2192 Purge cache \u2192 Purge everything</li> <li> <p>then hard-refresh browser (<code>Cmd/Ctrl+Shift+R</code>)</p> </li> <li> <p>Validate route behavior:</p> </li> <li>authenticated cookie + <code>GET /</code> \u2192 redirects to <code>/app</code></li> <li>no cookie + <code>GET /app</code> \u2192 redirects to <code>/auth</code></li> </ol>"},{"location":"06-deployment/#verification-checklist","title":"Verification checklist","text":"<p>Run these after deployment:</p> <pre><code># 1. API health\ncurl -s https://api.thecontextcache.com/health\n# \u2192 {\"status\":\"ok\"}\n\n# 2. CORS preflight (should return 200 with Access-Control-Allow-Origin)\ncurl -si -X OPTIONS https://api.thecontextcache.com/auth/me \\\n  -H \"Origin: https://thecontextcache.com\" \\\n  -H \"Access-Control-Request-Method: GET\" | grep -i \"access-control\"\n\n# 3. Docs site\ncurl -I https://docs.thecontextcache.com\n# \u2192 HTTP/2 200\n\n# 4. Web UI (check response is HTML)\ncurl -sI https://thecontextcache.com | head -5\n\n# 5. Browser: open https://thecontextcache.com/auth\n#    \u2192 request magic link \u2192 check docker logs for debug_link\n#    \u2192 verify \u2192 check /app loads + session cookie is set\ndocker compose logs api | grep -i \"MAGIC LINK\" | tail -3\n</code></pre>"},{"location":"06-deployment/#cookie-session-notes","title":"Cookie / session notes","text":"<ul> <li><code>APP_ENV=prod</code> sets <code>Secure=true; SameSite=Lax</code> on the session cookie.</li> <li>Cookies are set by the web origin (<code>thecontextcache.com</code>) because the   browser only ever talks to the Next.js proxy, not the API subdomain.</li> <li><code>SameSite=Lax</code> is sufficient here \u2014 no cross-site POST needed.</li> <li>If you ever route the frontend to call <code>api.thecontextcache.com</code> directly,   switch to <code>SameSite=None; Secure</code> and set <code>Domain=.thecontextcache.com</code>.</li> </ul>"},{"location":"06-deployment/#mode-a-tailscale-private-network","title":"Mode A \u2014 Tailscale / Private Network","text":"<p>All services are accessed directly by port. No reverse-proxy needed.</p> <pre><code>Browser \u2192 http://&lt;tailscale-ip&gt;:3000  (web)\nBrowser \u2192 http://&lt;tailscale-ip&gt;:8000  (api)\nBrowser \u2192 http://&lt;tailscale-ip&gt;:8001  (docs)\n</code></pre>"},{"location":"06-deployment/#env-mode-a","title":".env (Mode A)","text":"<pre><code>APP_ENV=dev\nAPP_PUBLIC_BASE_URL=http://&lt;tailscale-ip&gt;:3000\nCORS_ORIGINS=http://localhost:3000,http://&lt;tailscale-ip&gt;:3000\n\nPOSTGRES_USER=contextcache\nPOSTGRES_PASSWORD=&lt;strong-random-password&gt;\nPOSTGRES_DB=contextcache\n</code></pre> <p>Leave <code>NEXT_PUBLIC_API_BASE_URL</code> and <code>NEXT_PUBLIC_DOCS_URL</code> blank \u2014 the frontend automatically derives them from <code>window.location.hostname:8000/8001</code>.</p>"},{"location":"06-deployment/#start","title":"Start","text":"<pre><code>docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d --build\n</code></pre>"},{"location":"06-deployment/#ses-rejection-recovery-temporary","title":"SES rejection recovery (temporary)","text":"<p>If Amazon SES is still in sandbox/rejected and login links fail in non-dev:</p> <ol> <li>Set in <code>.env</code>:</li> <li><code>MAGIC_LINK_ALLOW_LOG_FALLBACK=true</code></li> <li>Rebuild/restart API:</li> </ol> <pre><code>docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d --build api\n</code></pre> <ol> <li>Request link again and use the <code>debug_link</code> response.</li> <li>After SES is fixed, revert:</li> <li><code>MAGIC_LINK_ALLOW_LOG_FALLBACK=false</code></li> </ol>"},{"location":"06-deployment/#mode-b-cloudflare-tunnel-https-domain-no-open-ports","title":"Mode B \u2014 Cloudflare Tunnel (HTTPS domain, no open ports)","text":"<p>All traffic reaches the server through a Cloudflare Tunnel. The public domain is <code>https://thecontextcache.com</code>. Cloudflare routes paths to the correct internal container:</p> <pre><code>https://thecontextcache.com        \u2192 web:3000   (Next.js)\nhttps://thecontextcache.com/api/*  \u2192 api:8000   (FastAPI)\nhttps://thecontextcache.com/docs/* \u2192 docs:8001  (MkDocs)\n</code></pre> <p>The frontend detects the production domain automatically and switches from port-based URLs to same-origin relative paths (<code>/api</code>, <code>/docs</code>), so no <code>NEXT_PUBLIC_*</code> env vars are needed in production.</p>"},{"location":"06-deployment/#prerequisites","title":"Prerequisites","text":"<ul> <li><code>cloudflared</code> installed on the server</li> <li>A Cloudflare Zero Trust account with a tunnel created</li> <li>DNS CNAME for <code>thecontextcache.com</code> pointing to the tunnel</li> </ul>"},{"location":"06-deployment/#cloudflared-config","title":"cloudflared config","text":"<p>Create <code>/etc/cloudflared/config.yml</code> (or <code>~/.cloudflared/config.yml</code>):</p> <pre><code>tunnel: &lt;YOUR-TUNNEL-ID&gt;\ncredentials-file: /etc/cloudflared/&lt;YOUR-TUNNEL-ID&gt;.json\n\ningress:\n  # API \u2014 prefix match, strip /api prefix before forwarding\n  - hostname: thecontextcache.com\n    path: ^/api(/.*)?$\n    service: http://localhost:8000\n    originRequest:\n      httpHostHeader: thecontextcache.com\n\n  # Docs site\n  - hostname: thecontextcache.com\n    path: ^/docs(/.*)?$\n    service: http://localhost:8001\n    originRequest:\n      httpHostHeader: thecontextcache.com\n\n  # Web UI (catch-all)\n  - hostname: thecontextcache.com\n    service: http://localhost:3000\n\n  # Catch-all 404\n  - service: http_status:404\n</code></pre> <p>Path stripping</p> <p>Cloudflare Tunnel does not strip path prefixes by default. The FastAPI app must be mounted at <code>/api</code> or the tunnel config must rewrite the path. The simplest approach for FastAPI is to add a root path setting or use a nginx/caddy sidecar for prefix stripping. See Nginx sidecar option below.</p> <p></p>"},{"location":"06-deployment/#nginx-sidecar-option-recommended-for-path-stripping","title":"Nginx sidecar option (recommended for path stripping)","text":"<p>Add a lightweight nginx container that rewrites <code>/api/</code> \u2192 <code>/</code> before proxying to FastAPI, and <code>/docs/</code> \u2192 <code>/</code> before proxying to MkDocs:</p> <pre><code># nginx/nginx.conf\nserver {\n    listen 80;\n\n    location /api/ {\n        proxy_pass         http://api:8000/;\n        proxy_set_header   Host $host;\n        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header   X-Forwarded-Proto $scheme;\n    }\n\n    location /docs/ {\n        proxy_pass         http://docs:8001/;\n        proxy_set_header   Host $host;\n    }\n\n    location / {\n        proxy_pass         http://web:3000;\n        proxy_set_header   Host $host;\n        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header   X-Forwarded-Proto $scheme;\n    }\n}\n</code></pre> <p>Add to <code>docker-compose.yml</code>:</p> <pre><code>  nginx:\n    image: nginx:alpine\n    volumes:\n      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf:ro\n    ports:\n      - \"80:80\"\n    depends_on:\n      - api\n      - web\n      - docs\n    restart: unless-stopped\n</code></pre> <p>Then point <code>cloudflared</code> at <code>http://localhost:80</code> instead of individual ports.</p>"},{"location":"06-deployment/#env-mode-b","title":".env (Mode B)","text":"<pre><code>APP_ENV=prod\nAPP_PUBLIC_BASE_URL=https://thecontextcache.com\nCORS_ORIGINS=https://thecontextcache.com\n\n# SES \u2014 required in prod; dev falls back to console log\nAWS_REGION=us-east-1\nAWS_ACCESS_KEY_ID=&lt;from-secrets-manager&gt;\nAWS_SECRET_ACCESS_KEY=&lt;from-secrets-manager&gt;\nSES_FROM_EMAIL=support@thecontextcache.com\n\nPOSTGRES_USER=contextcache\nPOSTGRES_PASSWORD=&lt;strong-random-password&gt;\nPOSTGRES_DB=contextcache\n</code></pre> <p>Leave <code>NEXT_PUBLIC_API_BASE_URL</code> and <code>NEXT_PUBLIC_DOCS_URL</code> blank \u2014 the frontend detects the production domain and uses <code>/api</code> / <code>/docs</code> automatically.</p>"},{"location":"06-deployment/#start_1","title":"Start","text":"<pre><code>docker compose up -d --build\ncloudflared tunnel run &lt;YOUR-TUNNEL-NAME&gt;\n</code></pre>"},{"location":"06-deployment/#aws-ses-production-checklist","title":"AWS SES production checklist","text":"<p>Domain and <code>support@thecontextcache.com</code> are verified in SES. Production access (sandbox removal) is pending AWS approval. Once approved:</p> <ol> <li> <p>Update <code>.env</code> with real credentials:    <pre><code>APP_ENV=prod\nAWS_REGION=us-east-1\nAWS_ACCESS_KEY_ID=&lt;your-key-id&gt;\nAWS_SECRET_ACCESS_KEY=&lt;your-secret&gt;\nSES_FROM_EMAIL=support@thecontextcache.com\nAPP_PUBLIC_BASE_URL=https://thecontextcache.com\n</code></pre></p> </li> <li> <p>Remove the <code>BOOTSTRAP_API_KEY</code> line (or leave blank) \u2014 it is only used in <code>APP_ENV=dev</code>.</p> </li> <li> <p>Rebuild and restart the API container:    <pre><code>docker compose up -d --build api\n</code></pre></p> </li> <li> <p>End-to-end smoke test \u2014 run once after switching to prod SES:    <pre><code># 1. Request a magic link (should send a real email, NOT log to console)\ncurl -s -X POST https://api.thecontextcache.com/auth/request-link \\\n  -H 'Content-Type: application/json' \\\n  -d '{\"email\":\"your-verified-address@example.com\"}'\n# Expected: {\"status\":\"ok\",\"detail\":\"Check your email...\",\"debug_link\":null}\n\n# 2. Confirm debug_link is null (would be a URL in dev mode)\n# 3. Check your inbox \u2014 magic link should arrive within ~30 s\n# 4. Click the link \u2192 confirm session cookie is set \u2192 /app loads\n</code></pre></p> </li> <li> <p>Monitor SES bounce/complaint rate in the AWS console \u2014 stay below 0.1% bounce / 0.1% complaint to avoid SES suspension.</p> </li> </ol>"},{"location":"06-deployment/#common-operations","title":"Common operations","text":""},{"location":"06-deployment/#verify-api-is-up","title":"Verify API is up","text":"<pre><code>curl -s http://127.0.0.1:8000/health\n# {\"status\":\"ok\"}\n</code></pre>"},{"location":"06-deployment/#run-migrations-manually","title":"Run migrations manually","text":"<pre><code>docker compose exec api uv run python -m app.migrate\n</code></pre>"},{"location":"06-deployment/#view-logs","title":"View logs","text":"<pre><code>docker compose logs -n 100 api web db\n</code></pre>"},{"location":"06-deployment/#run-tests","title":"Run tests","text":"<pre><code>docker compose --profile test run --rm api-test\ndocker compose --profile test down -v\n</code></pre>"},{"location":"06-deployment/#full-reset-dev-only-wipes-data","title":"Full reset (dev only \u2014 wipes data)","text":"<pre><code>docker compose down\ndocker volume rm contextcache_pgdata\ndocker compose up -d --build\n</code></pre>"},{"location":"06-deployment/#background-workers-optional","title":"Background Workers (optional)","text":"<p>Redis is part of the default stack. Worker/beat remain optional. Enable it when you need async heavy tasks (future: embedding indexing, batch recall, scheduled cleanup).</p>"},{"location":"06-deployment/#stack-components","title":"Stack components","text":"Service Image Role <code>redis</code> <code>redis:7-alpine</code> Shared rate-limit counters + Celery broker/result backend <code>worker</code> same as <code>api</code> Celery worker process <code>beat</code> same as <code>api</code> Celery Beat scheduler (periodic tasks)"},{"location":"06-deployment/#database-image-requirement-pgvector","title":"Database image requirement (pgvector)","text":"<p>Hybrid recall uses native pgvector columns, so Postgres must include the <code>vector</code> extension.</p> <p>Use:</p> <ul> <li><code>pgvector/pgvector:pg16</code> (recommended)</li> </ul> <p>If you run plain <code>postgres:16</code>, API startup can fail during migrations when <code>CREATE EXTENSION vector</code> runs.</p>"},{"location":"06-deployment/#enable-worker-mode","title":"Enable worker mode","text":"<ol> <li>Add to your <code>.env</code>:</li> </ol> <pre><code>WORKER_ENABLED=true\nCELERY_BROKER_URL=redis://redis:6379/0\nCELERY_RESULT_BACKEND=redis://redis:6379/0\nREDIS_URL=redis://redis:6379/0\n</code></pre> <ol> <li>Start the worker profile:</li> </ol> <pre><code>docker compose --profile worker up -d\n</code></pre> <ol> <li>Verify the worker is connected:</li> </ol> <pre><code>docker compose logs worker | tail -20\n# Should show: \"celery@... ready.\"\n</code></pre>"},{"location":"06-deployment/#disable-worker-mode","title":"Disable worker mode","text":"<pre><code>docker compose --profile worker down\n# or simply don't set WORKER_ENABLED=true \u2014 tasks are silently skipped\n</code></pre>"},{"location":"06-deployment/#periodic-tasks-celery-beat","title":"Periodic tasks (Celery Beat)","text":"<p>The <code>beat</code> service is included in the <code>worker</code> profile and starts automatically with <code>--profile worker</code>. It manages cleanup schedules:</p> Task Schedule Description <code>cleanup_expired_magic_links</code> Every hour Deletes magic links older than 24 h <code>cleanup_old_usage_counters</code> Daily Purges usage rows older than 90 days <code>cleanup_old_login_events</code> Daily Purges login-event rows older than 90 days (per-user cap of last 10 is also enforced at write time) <code>cleanup_old_waitlist_entries</code> Daily Purges waitlist entries older than 90 days <code>cleanup_expired_sessions</code> Daily Deletes expired auth sessions <code>cleanup_expired_invites</code> Daily Revokes expired invites <p>The schedule lives in <code>api/app/worker/celery_app.py</code> \u2014 edit that file to add or adjust tasks:</p> <pre><code>celery_app.conf.beat_schedule = {\n    \"cleanup-magic-links-hourly\": {\n        \"task\": \"contextcache.cleanup_expired_magic_links\",\n        \"schedule\": crontab(minute=0),           # top of every hour\n    },\n    \"cleanup-usage-counters-nightly\": {\n        \"task\": \"contextcache.cleanup_old_usage_counters\",\n        \"schedule\": crontab(hour=2, minute=0),   # 02:00 UTC\n    },\n    \"cleanup-login-events-nightly\": {\n        \"task\": \"contextcache.cleanup_old_login_events\",\n        \"schedule\": crontab(hour=3, minute=0),   # 03:00 UTC\n    },\n}\n</code></pre> <p>Verify beat is running: <pre><code>docker compose --profile worker logs beat | tail -20\n# Should show: \"beat: Starting... Scheduler: DatabaseScheduler\"\n</code></pre></p>"},{"location":"06-deployment/#worker-security-notes","title":"Worker security notes","text":"<ul> <li>Tasks must never receive tokens, API keys, cookies, or magic links.</li> <li>Pass only domain IDs (project_id, user_id) and safe content.</li> <li>The Redis port is not exposed to the host \u2014 internal Docker network only.</li> </ul>"},{"location":"06-deployment/#internal-analyzer-service-future","title":"Internal Analyzer Service (future)","text":"<p>The analyzer scoring/ranking logic currently runs in-process (<code>ANALYZER_MODE=local</code>). When you need to scale scoring independently, you can split it into a private internal service.</p>"},{"location":"06-deployment/#how-it-works","title":"How it works","text":"<pre><code>ANALYZER_MODE=local     \u2192 scoring runs inside the API process (default)\nANALYZER_MODE=service   \u2192 API calls http://analyzer:9000 on the internal network\n</code></pre> <p>The <code>analyzer</code> service is never exposed publicly \u2014 no ports are mapped to the host, and it is unreachable via Cloudflare Tunnel or any public route.</p>"},{"location":"06-deployment/#enable-analyzer-service-mode","title":"Enable analyzer service mode","text":"<ol> <li> <p>Build the analyzer service (separate repo/folder <code>./analyzer/</code>).</p> </li> <li> <p>Uncomment the <code>analyzer:</code> block in <code>docker-compose.yml</code>.</p> </li> <li> <p>Add to <code>.env</code>:</p> </li> </ol> <pre><code>ANALYZER_MODE=service\nANALYZER_SERVICE_URL=http://analyzer:9000\n</code></pre> <ol> <li>Start:</li> </ol> <pre><code>docker compose --profile analyzer up -d\n</code></pre>"},{"location":"06-deployment/#security-requirement","title":"Security requirement","text":"<p>The analyzer service must have no <code>ports:</code> mapping in <code>docker-compose.yml</code>. It communicates only on the Docker internal <code>default</code> network, which is unreachable from outside the host.</p>"},{"location":"06-deployment/#embedding-pipeline-hybrid-recall","title":"Embedding pipeline + hybrid recall","text":"<p>Current behavior:</p> <ul> <li>Every new memory stores embeddings in:</li> <li><code>memories.embedding_vector</code> (pgvector, 1536 dims)</li> <li><code>memories.search_vector</code> (JSON fallback/debug payload)</li> <li><code>compute_memory_embedding</code> (Celery) updates both <code>memories</code> and <code>memory_embeddings</code>.</li> <li>Embeddings use:</li> <li><code>EMBEDDING_PROVIDER=openai</code> when <code>OPENAI_API_KEY</code> is configured</li> <li>deterministic local fallback when provider/network is unavailable</li> <li>Recall uses hybrid ranking:</li> <li>FTS (<code>websearch_to_tsquery</code> + <code>ts_rank_cd</code>)</li> <li>vector cosine similarity over <code>embedding_vector</code></li> <li>recency boost</li> </ul> <p>Tune with:</p> <pre><code>FTS_WEIGHT=0.65\nVECTOR_WEIGHT=0.25\nRECENCY_WEIGHT=0.10\nRECALL_VECTOR_MIN_SCORE=0.20\nRECALL_VECTOR_CANDIDATES=200\nEMBEDDING_PROVIDER=local\n# OPENAI_API_KEY=...\n</code></pre>"},{"location":"06-deployment/#current-pgvector-schema","title":"Current pgvector schema","text":"<p>Applied via Alembic:</p> <ul> <li><code>CREATE EXTENSION IF NOT EXISTS vector</code></li> <li><code>memories.embedding_vector vector(1536)</code></li> <li>IVFFLAT index: <code>ix_memories_embedding_vector_ivfflat</code></li> </ul> <p>Scaling guidance (single-host beta):</p> <ul> <li>10-15 users: <code>worker --concurrency=2</code> is enough</li> <li>50+ active users: raise worker concurrency and <code>RECALL_VECTOR_CANDIDATES</code></li> <li>keep one <code>beat</code> instance only</li> </ul>"},{"location":"06-deployment/#hilbert-1d-pre-filtering-phase-32-optimization","title":"Hilbert 1D Pre-Filtering (Phase 3.2 Optimization)","text":"<p>When scaling past millions of rows, vector searches (<code>&lt;=&gt;</code> operator) become memory/CPU bottlenecked. Enable the Hilbert Curve Pre-Filter to prune the DB via a B-Tree lookup (O(1)) prior to vector evaluation.</p> <p>To enable: 1. Ensure the <code>hilbertcurve</code> pip package is installed (<code>uv add hilbertcurve</code> inside <code>api/</code>). 2. Set <code>HILBERT_ENABLED=true</code> in <code>.env</code>. 3. Stop the API container during the backfill (if safe), or run concurrently. 4. Execute the backfill script to generate indices for existing rows:    <pre><code>docker compose exec api uv run python -m scripts.backfill_hilbert --batch-size 1000\n</code></pre> 5. Restart the containers to pick up the ENV change.</p> <p>Tuning constraints: - <code>HILBERT_RADIUS</code> defines the initial integer window bounding box. - <code>HILBERT_MIN_ROWS</code> defines the minimum number of target rows retrieved before we widen the radius using <code>HILBERT_WIDEN_MULT</code>.</p>"},{"location":"07-security/","title":"Security","text":""},{"location":"07-security/#auth-model","title":"Auth model","text":"<p>ContextCache supports two auth modes:</p> <ol> <li>Session auth (web): invite-only magic links + HttpOnly cookie</li> <li>API key auth (programmatic): hashed DB keys scoped to org</li> </ol>"},{"location":"07-security/#session-protections","title":"Session protections","text":"<p>Cookie settings: - <code>HttpOnly=true</code> - <code>Secure=true</code> only in <code>APP_ENV=prod</code> - <code>SameSite=lax</code> - explicit <code>Max-Age</code>, <code>Expires</code>, <code>Path=/</code></p> <p>Session controls: - magic links are single-use (<code>consumed_at</code>) - magic link TTL defaults to 10 minutes - sessions are revocable (<code>revoked_at</code>) - max active sessions per user (default 3), oldest revoked first</p>"},{"location":"07-security/#invite-only-enforcement","title":"Invite-only enforcement","text":"<p><code>POST /auth/request-link</code> returns <code>403</code> when: - no invite and no existing user - invite revoked - invite expired</p> <p><code>GET /auth/verify</code>: - rejects expired/consumed tokens - marks token consumed on success - marks invite accepted when applicable - blocks disabled users</p>"},{"location":"07-security/#email-delivery-behavior","title":"Email delivery behavior","text":"<ul> <li>Uses AWS SES via <code>boto3</code></li> <li><code>APP_ENV=dev</code>: SES failures log <code>[magic-link-debug]</code> and flow returns success with <code>debug_link</code></li> <li>non-dev: SES failure returns <code>500</code> (<code>Email delivery failed</code>)</li> <li>emergency override: <code>MAGIC_LINK_ALLOW_LOG_FALLBACK=true</code> allows logged <code>debug_link</code> outside dev.   Use only as a temporary recovery switch; disable after SES is healthy.</li> </ul>"},{"location":"07-security/#api-key-storage-org-isolation","title":"API key storage + org isolation","text":"<ul> <li>plaintext key never stored</li> <li>SHA-256 hash in <code>api_keys.key_hash</code></li> <li>key prefix stored separately for identification</li> <li>revoked keys are rejected</li> <li>key org isolation enforced (cross-org blocked)</li> </ul>"},{"location":"07-security/#authorization","title":"Authorization","text":"<ul> <li><code>/admin/*</code> requires admin privileges via:</li> <li>session auth with <code>is_admin=true</code>, or</li> <li>org API key context with role <code>owner|admin</code></li> <li>Core APIs require session or API key</li> <li>Role checks on org resources: <code>viewer</code>, <code>member</code>, <code>admin</code>, <code>owner</code></li> </ul>"},{"location":"07-security/#rate-limiting","title":"Rate limiting","text":"<p>Current limiter is Redis-backed: - <code>/auth/request-link</code>: per-IP + per-email - <code>/auth/verify</code>: per-IP - <code>/projects/{id}/recall</code>: per-IP + per-account</p> <p>Behavior: - <code>APP_ENV=prod</code>: Redis is required; if Redis is unavailable, protected rate-limited routes return <code>503</code>. - <code>APP_ENV=dev/test</code>: temporary in-memory fallback is allowed for local convenience.</p>"},{"location":"07-security/#auditing-and-usage","title":"Auditing and usage","text":"<ul> <li>Writes produce <code>audit_logs</code> with actor context and key prefix where available</li> <li><code>usage_events</code> tracks coarse telemetry with <code>ip_prefix</code> (not raw long-term IP)</li> <li>No third-party analytics beacons or advertising trackers are embedded in the web UI.</li> </ul>"},{"location":"07-security/#operational-hardening-notes","title":"Operational hardening notes","text":"<ul> <li>Keep <code>.env</code> out of git</li> <li>Rotate leaked API keys immediately</li> <li>Use TLS in production</li> <li>Restrict CORS origins to trusted web hosts</li> <li>Keep <code>X-User-Email</code> disabled outside dev (enforced in middleware)</li> <li>Ignore untrusted forwarding headers; trust <code>CF-Connecting-IP</code> (or socket peer fallback).</li> </ul>"},{"location":"07-security/#security-best-practices-checklist","title":"Security best practices checklist","text":"<ul> <li>Rotate API keys regularly and revoke old keys on role changes.</li> <li>Keep Cloudflare/TLS enabled for all public endpoints.</li> <li>Restrict dashboard/API access by IP at the firewall when possible.</li> <li>Retain audit logs and usage records per your policy; purge old rows on schedule.</li> <li>Confirm only the last 10 login events per user are retained and older rows are purged after 90 days.</li> </ul>"},{"location":"07-security/#security-audit-automation","title":"Security audit automation","text":"<p>CI now runs a dedicated security job:</p> <ul> <li>Bandit static analysis over <code>api/app</code></li> <li>Python dependency audit (<code>pip-audit</code>) using locked requirements</li> <li>NPM dependency audit (<code>npm audit --audit-level=critical</code>) for web runtime deps</li> </ul> <p>Workflow file: <code>.github/workflows/ci.yml</code> (<code>security-scan</code> job).</p> <p>Use this as baseline coverage and add provider-native tooling (e.g. GitHub Advanced Security or Aikido) when available.</p>"},{"location":"08-roadmap/","title":"Roadmap &amp; Pending Tasks","text":""},{"location":"08-roadmap/#status-invite-only-alpha-february-2026","title":"Status: Invite-only Alpha (February 2026)","text":""},{"location":"08-roadmap/#completed-alpha","title":"\u2705 Completed (Alpha)","text":""},{"location":"08-roadmap/#auth-access","title":"Auth &amp; Access","text":"<ul> <li>Invite-only magic-link authentication (no passwords)</li> <li>Session-protected <code>/app</code>, <code>/brain</code>, and <code>/admin</code> pages</li> <li>Waitlist with approve/reject workflow</li> <li>Admin invite, user, and session controls</li> <li>Per-user <code>is_unlimited</code> flag to bypass daily limits</li> <li>Login IP tracking (last 10 per user, auto-purged after 90 days)</li> </ul>"},{"location":"08-roadmap/#core-product","title":"Core Product","text":"<ul> <li>Org-scoped projects and memory cards</li> <li>PostgreSQL FTS recall (<code>websearch_to_tsquery</code> + <code>ts_rank_cd</code>)</li> <li>Memory pack output grouped by type</li> <li>Server-only analyzer module (<code>analyzer/core.py</code> \u2014 never shipped to browser)</li> <li>Tags and metadata on memory cards</li> </ul>"},{"location":"08-roadmap/#infrastructure","title":"Infrastructure","text":"<ul> <li>Docker Compose with Redis in default stack + optional Celery worker profile</li> <li><code>infra/</code> baseline folder with Terraform + Cloudflare tunnel reference templates</li> <li>Celery Beat with nightly cleanup tasks:</li> <li>Purge expired magic links (hourly)</li> <li>Purge old usage counters (nightly, 90-day rolling)</li> <li>Purge old login events (nightly, 90-day rolling)</li> <li>Purge old waitlist entries (nightly, 90-day rolling)</li> <li>Purge expired sessions + expired invites (nightly)</li> <li>Cloudflare Tunnel \u2014 Mode C subdomain deployment (docs in <code>06-deployment.md</code>)</li> <li>Amazon SES integration (sandbox \u2014 awaiting production approval)</li> </ul>"},{"location":"08-roadmap/#usage-limits","title":"Usage Limits","text":"<ul> <li>Daily + weekly per-user counters (projects, memories, recall queries)</li> <li>Configurable via <code>DAILY_MAX_*</code> + <code>WEEKLY_MAX_*</code></li> <li>Per-user override via admin toggle</li> <li><code>/me/usage</code> endpoint</li> </ul>"},{"location":"08-roadmap/#retrieval","title":"Retrieval","text":"<ul> <li>Hybrid recall in production path:</li> <li>FTS (<code>websearch_to_tsquery</code> + <code>ts_rank_cd</code>)</li> <li>Hilbert prefilter (<code>memories.hilbert_index</code>) before vector search</li> <li>pgvector cosine similarity (<code>memories.embedding_vector</code>)</li> <li>recency boost</li> <li>Weight tuning via <code>FTS_WEIGHT</code>, <code>VECTOR_WEIGHT</code>, <code>RECENCY_WEIGHT</code></li> <li>Deterministic local embedding fallback when external providers are unavailable</li> <li>CAG pheromone-guided cache reinforcement + evaporation + LRU tiebreak eviction</li> <li>KV-cache prep stub path for future compressive memory integration</li> </ul>"},{"location":"08-roadmap/#ux","title":"UX","text":"<ul> <li>Next.js App Router with dark/light theme</li> <li>Brain visualization (<code>/brain</code>) \u2014 interactive neural graph of projects and memories</li> <li>Terms of Service checkbox on sign-in</li> <li>404 / 500 error pages</li> <li>Legal page with full terms, privacy, and IP retention details</li> <li>Admin panel: users, invites, waitlist, login IPs, usage stats</li> </ul>"},{"location":"08-roadmap/#cli-sdk","title":"CLI &amp; SDK","text":"<ul> <li><code>cc</code> CLI (Python, zero dependencies): health, projects, mem, recall, usage, invites, waitlist</li> <li>Python SDK (<code>cli/sdk.py</code>): full API wrapper for scripting and CI/CD</li> </ul>"},{"location":"08-roadmap/#documentation","title":"Documentation","text":"<ul> <li>API contract (<code>04-api-contract.md</code>)</li> <li>Deployment guide with Cloudflare Mode C (<code>06-deployment.md</code>)</li> <li>Security model (<code>07-security.md</code>)</li> <li>CLI &amp; SDK reference (<code>09-cli-sdk.md</code>)</li> <li>Branding guideline (<code>11-branding.md</code>)</li> <li>Legal &amp; licensing (<code>legal.md</code>)</li> </ul>"},{"location":"08-roadmap/#pending-near-term","title":"\ud83d\udd1c Pending (Near-term)","text":""},{"location":"08-roadmap/#ses-production","title":"SES Production","text":"<ul> <li>Blocked on: Amazon SES production access approval.</li> <li>Action: Once approved, set <code>APP_ENV=prod</code>, <code>AWS_ACCESS_KEY_ID</code>, <code>AWS_SECRET_ACCESS_KEY</code>,   <code>AWS_REGION</code>, <code>SES_FROM_EMAIL=support@thecontextcache.com</code>.</li> <li>Magic-link emails will then be sent via SES instead of logged to console.</li> </ul>"},{"location":"08-roadmap/#brain-visualization-enhancements","title":"Brain Visualization \u2014 Enhancements","text":"<ul> <li>Multi-project recall with cross-project edge highlighting.</li> <li>Touch/mobile support (pinch-zoom, tap to select).</li> <li>Animated node creation when a new memory is saved (pulse-in).</li> <li>Export graph as PNG / SVG.</li> </ul>"},{"location":"08-roadmap/#admin-ux-polish","title":"Admin UX Polish","text":"<ul> <li>Server/query pagination + status/email filters are now available for admin lists.</li> <li>Remaining: date-range filters and bulk actions.</li> </ul>"},{"location":"08-roadmap/#background-worker-expansion","title":"Background Worker Expansion","text":"<ul> <li>Embedding generation: Celery task computes and stores vectors + metadata.</li> <li>Ollama contextualization task scaffold (<code>contextualize_memory_with_ollama</code>).</li> <li>Reindex project task: rebuild FTS tsvector for all memories in a project.</li> <li>Remaining: production-grade model quality tuning and ANN index optimization.</li> </ul>"},{"location":"08-roadmap/#later-post-alpha","title":"\ud83d\uddd3 Later (Post-Alpha)","text":""},{"location":"08-roadmap/#payments-pricing","title":"Payments &amp; Pricing","text":"<ul> <li>Stripe integration for paid tiers.</li> <li>Usage limits tied to pricing tiers (free / pro / team).</li> <li>Invoice and subscription management.</li> </ul>"},{"location":"08-roadmap/#ml-analyzer-microservice","title":"ML / Analyzer Microservice","text":"<ul> <li>Split <code>analyzer/core.py</code> into a standalone internal service (Docker, no public port).</li> <li>Switch via <code>ANALYZER_MODE=service</code> + <code>ANALYZER_SERVICE_URL=http://analyzer:9000</code>.</li> <li>No custom model training required for v1; Postgres FTS + recency scoring suffices.</li> <li>Future: sentence-transformer embeddings for semantic recall.</li> </ul>"},{"location":"08-roadmap/#enterprise-features","title":"Enterprise Features","text":"<ul> <li>SSO / OIDC integration (Okta, Google Workspace, Azure AD).</li> <li>Organisation-level billing and per-seat pricing.</li> <li>Audit log export (CSV / JSON).</li> <li>Custom data retention policies.</li> <li>SCIM provisioning.</li> </ul>"},{"location":"08-roadmap/#observability","title":"Observability","text":"<ul> <li>Prometheus exporter for API and worker metrics.</li> <li>Grafana dashboard for request rates, memory counts, recall latency.</li> <li>Sentry / OpenTelemetry tracing.</li> <li>Uptime monitoring with alerting.</li> </ul>"},{"location":"08-roadmap/#redis-backed-rate-limiting","title":"Redis-backed Rate Limiting","text":"<ul> <li>Implemented for auth + recall sensitive endpoints.</li> <li>Remaining: migrate all usage counters to durable Redis/KV with observability dashboards.</li> </ul>"},{"location":"08-roadmap/#trademark-legal","title":"Trademark &amp; Legal","text":"<ul> <li>Register \"thecontextcache\u2122\" as a trademark (pending incorporation).</li> <li>Update \u2122 \u2192 \u00ae once registration is confirmed.</li> <li>Engage legal counsel for enterprise contract templates.</li> </ul>"},{"location":"08-roadmap/#architecture-decisions-deferred","title":"Architecture decisions deferred","text":"Decision Status Notes Vector DB (pgvector vs Pinecone) Deferred pgvector preferred \u2014 no extra infra Message queue (Redis vs Kafka) Redis chosen Kafka overkill for alpha Auth (magic link vs OAuth) Magic link only OAuth added post-alpha Embeddings model Deferred sentence-transformers or OpenAI ada-002 Kubernetes Deferred Docker Compose + Cloudflare sufficient for alpha"},{"location":"09-cli-sdk/","title":"CLI &amp; Python SDK","text":"<p>thecontextcache\u2122 ships a zero-dependency CLI and a Python SDK for scripting and integration work.</p>"},{"location":"09-cli-sdk/#cli-cc","title":"CLI (<code>cc</code>)","text":""},{"location":"09-cli-sdk/#installation","title":"Installation","text":"<pre><code># Clone or copy cli/cc.py to your PATH\ncp cli/cc.py /usr/local/bin/cc\nchmod +x /usr/local/bin/cc\n\n# Or use an alias:\nalias cc=\"python3 /path/to/contextcache/cli/cc.py\"\n</code></pre> <p>Requires Python 3.9+ \u2014 no external packages needed.</p>"},{"location":"09-cli-sdk/#authentication","title":"Authentication","text":"<pre><code>cc login --api-key cck_your_key_here\n# Optional: specify a custom API URL or org\ncc login --api-key cck_xxx --base-url https://api.thecontextcache.com --org-id 1\n\n# Any command can override runtime config:\ncc projects list --api-base https://api.thecontextcache.com --api-key cck_xxx --org-id 1\n</code></pre> <p>The API key and base URL are stored in <code>~/.contextcache/config.json</code> (mode 0600).</p>"},{"location":"09-cli-sdk/#commands","title":"Commands","text":""},{"location":"09-cli-sdk/#health-check","title":"Health check","text":"<pre><code>cc health\n# \u2192 \u2713 API is healthy: {'status': 'ok', ...}\n</code></pre>"},{"location":"09-cli-sdk/#projects","title":"Projects","text":"<pre><code>cc projects list\ncc projects create \"Sprint Planning Q1 2026\"\n</code></pre>"},{"location":"09-cli-sdk/#memories","title":"Memories","text":"<pre><code># Add a memory from text\ncc mem add --project 1 --type decision --text \"We use Postgres, not MySQL.\"\n\n# Add a memory from a file\ncc mem add --project 1 --type doc --file ./ADR-001.md --title \"ADR-001: Database\"\n\n# List memories in a project\ncc mem list --project 1\n</code></pre> <p>Supported types: <code>decision</code>, <code>finding</code>, <code>definition</code>, <code>note</code>, <code>link</code>, <code>todo</code>, <code>chat</code>, <code>doc</code>, <code>code</code></p>"},{"location":"09-cli-sdk/#recall","title":"Recall","text":"<pre><code>cc recall --project 1 \"postgres schema decisions\"\ncc recall --project 1 --limit 5 \"authentication flow\"\n</code></pre> <p>The output shows a ranked list and the full memory pack text.</p>"},{"location":"09-cli-sdk/#usage","title":"Usage","text":"<pre><code>cc usage\n# Usage for 2026-02-19\n#   Memories created : 4 / 100\n#   Recall queries   : 2 / 50\n#   Projects created : 1 / 10\n</code></pre>"},{"location":"09-cli-sdk/#invites-admin","title":"Invites (admin)","text":"<pre><code>cc invites list --status pending --email-q user --limit 20 --offset 0\ncc invites create user@example.com\ncc invites create user@example.com --notes \"Beta tester from Bluesky\"\ncc invites revoke 42\n</code></pre>"},{"location":"09-cli-sdk/#waitlist-admin","title":"Waitlist (admin)","text":"<pre><code>cc waitlist list --status pending --email-q gmail --limit 20 --offset 0\ncc waitlist approve 7      # converts waitlist entry \u2192 active invite\ncc waitlist reject 7\n</code></pre>"},{"location":"09-cli-sdk/#integrations-admin-helpers","title":"Integrations + Admin helpers","text":"<pre><code>cc integrations upload --project 1 --type note --text \"Captured from CLI\"\ncc integrations upload --project 1 --type doc --file ./notes.md\ncc integrations list --project 1 --limit 20 --offset 0\ncc integrations contextualize --memory-id 42\ncc seed-mock-data --num-projects 5 --memories-per-project 8\n\ncc admin users --status active --limit 20 --offset 0\ncc admin set-unlimited 5 --value true\ncc admin login-events 5\ncc admin stats 5\ncc admin recall-logs --project 1 --limit 20 --offset 0\ncc admin cag-stats\ncc admin cag-evaporate\ncc admin backfill-hilbert --batch-size 1000 --max-rows 50000\n</code></pre> <p><code>cc seed-mock-data</code> uses the SDK and uploads memories through <code>POST /integrations/memories</code> (HTTP), so audit/rate-limit/lineage paths stay identical to normal ingestion. It supports: - <code>--num-projects N</code> (default: <code>3</code>) - <code>--memories-per-project N</code> (default: <code>2</code>)</p>"},{"location":"09-cli-sdk/#python-sdk-clisdkpy","title":"Python SDK (<code>cli/sdk.py</code>)","text":"<p>The SDK is a thin synchronous wrapper with no external dependencies.</p>"},{"location":"09-cli-sdk/#installation_1","title":"Installation","text":"<pre><code># Add cli/ to your Python path\nimport sys\nsys.path.insert(0, \"/path/to/contextcache\")\nfrom cli.sdk import ContextCacheClient\n</code></pre>"},{"location":"09-cli-sdk/#quickstart","title":"Quickstart","text":"<pre><code>from cli.sdk import ContextCacheClient, ContextCacheError\n\nclient = ContextCacheClient(\n    api_key=\"cck_your_key_here\",\n    base_url=\"https://api.thecontextcache.com\",\n    org_id=1,\n)\n\n# Optional version hint header\nclient = ContextCacheClient(\n    api_key=\"cck_your_key_here\",\n    base_url=\"https://api.thecontextcache.com\",\n    org_id=1,\n    api_version=\"2026-02-beta\",\n)\n\n# Health check\nprint(client.health())\n\n# Projects\nprojects = client.projects.list()\nproject  = client.projects.create(\"My Sprint Notes\")\nprint(project[\"id\"], project[\"name\"])\n\n# Add memories\nmem = client.memories.add(\n    project_id=project[\"id\"],\n    type=\"decision\",\n    content=\"We use PostgreSQL 16 with FTS for memory recall.\",\n    title=\"DB decision\",\n    tags=[\"infra\", \"db\"],\n)\nprint(mem[\"id\"])\n\n# List memories\nmems = client.memories.list(project_id=project[\"id\"])\nfor m in mems:\n    print(m[\"type\"], m[\"title\"])\n\n# Recall\nresults = client.recall(project_id=project[\"id\"], query=\"database postgres\")\nfor item in results[\"items\"]:\n    print(f\"[{item['type']}] {item.get('title') or item['content'][:60]}\")\nprint(results[\"memory_pack_text\"])\n\n# Usage\nusage = client.usage()\nlim   = usage[\"limits\"]\nprint(f\"Memories: {usage['memories_created']} / {lim['memories_per_day']}\")\n</code></pre>"},{"location":"09-cli-sdk/#admin-operations-admin-api-key-required","title":"Admin operations (admin API key required)","text":"<pre><code># Invites\ninvite = client.invites.create(\"newuser@example.com\", notes=\"From blog post\")\nclient.invites.revoke(invite[\"id\"])\nall_invites = client.invites.list()\n\n# Waitlist\nentries = client.waitlist.list()\ninvite  = client.waitlist.approve(entries[0][\"id\"])\nclient.waitlist.reject(entries[1][\"id\"])\n\n# Integrations\nclient.integrations.upload_memory(\n    project_id=1,\n    type=\"note\",\n    content=\"Captured from SDK\",\n    tags=[\"sdk\"],\n)\nclient.integrations.list_memories(project_id=1, limit=20, offset=0)\nclient.integrations.contextualize_memory(42)\n\n# Admin namespace\nusers = client.admin.users.list(page=1, limit=20, is_admin=True)\nclient.admin.users.set_unlimited(users[0][\"id\"], unlimited=True)\nevents = client.admin.users.login_events(users[0][\"id\"])\nstats = client.admin.users.stats(users[0][\"id\"])\nrecall_logs = client.admin.recall_logs(limit=20, offset=0, project_id=1)\ncache_stats = client.admin.cag_cache_stats()\nclient.admin.evaporate_cag_cache()\nclient.admin.backfill_hilbert(batch_size=1000)\n\n# Public waitlist join (no auth required)\npublic = ContextCacheClient(api_key=\"\", base_url=\"https://api.thecontextcache.com\")\npublic.waitlist.join(\"user@example.com\", source=\"sdk\")\n</code></pre>"},{"location":"09-cli-sdk/#error-handling","title":"Error handling","text":"<pre><code>from cli.sdk import ContextCacheError\n\ntry:\n    client.memories.add(project_id=999, type=\"note\", content=\"test\")\nexcept ContextCacheError as e:\n    print(e.status, e.detail)   # e.g. 404, \"Project not found\"\n</code></pre>"},{"location":"09-cli-sdk/#raw-requests-escape-hatch","title":"Raw requests (escape hatch)","text":"<pre><code># Call any API path directly\nresult = client.request(\"GET\", \"/admin/users/1/stats\")\n</code></pre>"},{"location":"09-cli-sdk/#environment-variables-for-cicd","title":"Environment variables for CI/CD","text":"<pre><code>export CC_API_KEY=cck_xxx\nexport CC_BASE_URL=https://api.thecontextcache.com\nexport CC_ORG_ID=1\n</code></pre> <p>Aliases also supported by the CLI for shell compatibility:</p> <pre><code>export API_KEY=cck_xxx\nexport ORG_ID=1\n</code></pre> <p>When <code>CC_API_KEY</code> / <code>CC_BASE_URL</code> / <code>CC_ORG_ID</code> (or <code>API_KEY</code> / <code>ORG_ID</code>) are set, both the CLI and SDK will use them without a saved config file. (SDK: pass as constructor args; CLI: <code>--api-key</code> / <code>--base-url</code> / <code>--org-id</code> flags override any saved config.)</p>"},{"location":"10-integrations/","title":"Integrations (MCP-style capture)","text":"<p>ContextCache supports a simple ingestion API for external tools:</p> <ul> <li><code>POST /integrations/memories</code></li> <li><code>GET /integrations/memories</code></li> <li><code>POST /projects/{project_id}/memories</code> (equivalent direct route)</li> </ul> <p>Both routes enforce the same auth, RBAC, and usage limits.</p>"},{"location":"10-integrations/#external-llm-capture-architecture","title":"External LLM Capture Architecture","text":"<p>Integrating with external LLM tools requires specific architectural patterns due to security and environment constraints. The core web application cannot \"reach into\" other websites (like ChatGPT) due to browser CORS policies.</p>"},{"location":"10-integrations/#1-web-based-llms-chatgpt-claude-gemini","title":"1. Web-based LLMs (ChatGPT, Claude, Gemini)","text":"<p>To automatically capture chats from browser-based LLMs, you must build a Browser Extension. - Mechanism: The extension injects a content script into the LLM's page scope. - Action: It observes the DOM (e.g., using <code>MutationObserver</code> on chat message lists) or intercepts network requests. - Ingestion: When a significant answer is generated, the extension formats the payload and sends a <code>POST</code> request to <code>https://api.thecontextcache.com/integrations/memories</code>. - Auth: The extension should allow the user to input their <code>CONTEXTCACHE_API_KEY</code> and <code>CONTEXTCACHE_ORG_ID</code> in its options page.</p>"},{"location":"10-integrations/#2-programmatic-llms-langchain-ollama-cli-tools","title":"2. Programmatic LLMs (LangChain, Ollama, CLI tools)","text":"<p>To capture programmatic LLM generations, you must build an SDK Proxy Middleware or use lifecycle hooks. - Mechanism: Create a wrapper around the LLM generation call. - Action: Instead of just calling <code>llm.generate(prompt)</code>, call a wrapped function that first hits the LLM, then asynchronously sends the prompt/response pair to ContextCache. - Ingestion: Emit a <code>POST</code> to <code>/integrations/memories</code> using the environment's stored API keys. - Auth: Read <code>CONTEXTCACHE_API_KEY</code> directly from the environment variables.</p>"},{"location":"10-integrations/#auth","title":"Auth","text":"<p>Use either:</p> <ul> <li>Session cookie (<code>/auth/verify</code> login flow)</li> <li>API key header: <code>X-API-Key: &lt;key&gt;</code> (+ <code>X-Org-Id</code> when needed)</li> </ul>"},{"location":"10-integrations/#request-shape","title":"Request shape","text":"<pre><code>{\n  \"project_id\": 1,\n  \"type\": \"note\",\n  \"source\": \"extension\",\n  \"title\": \"Optional title\",\n  \"content\": \"Captured memory text\",\n  \"metadata\": {\"url\": \"https://example.com\"},\n  \"tags\": [\"capture\", \"browser\"]\n}\n</code></pre> <p>Optional request signing:</p> <ul> <li>Header: <code>X-Integration-Signature: sha256=&lt;hmac&gt;</code></li> <li>HMAC input: raw HTTP body bytes</li> <li>Secret source: <code>INTEGRATION_SIGNING_SECRET</code></li> <li>When secret is unset, signature enforcement is disabled.</li> </ul>"},{"location":"10-integrations/#vs-code-save-hook-minimal-example","title":"VS Code save hook (minimal example)","text":"<pre><code>import * as vscode from \"vscode\";\n\nasync function pushMemory(projectId, text) {\n  await fetch(\"https://api.thecontextcache.com/integrations/memories\", {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"X-API-Key\": process.env.CONTEXTCACHE_API_KEY,\n      \"X-Org-Id\": process.env.CONTEXTCACHE_ORG_ID,\n    },\n    body: JSON.stringify({\n      project_id: Number(projectId),\n      type: \"code\",\n      source: \"extension\",\n      content: text,\n      metadata: { tool: \"vscode\", event: \"onSave\" },\n      tags: [\"autosave\"],\n    }),\n  });\n}\n</code></pre>"},{"location":"10-integrations/#browser-bookmarklet-save-current-page","title":"Browser bookmarklet (save current page)","text":"<pre><code>javascript:(async()=&gt;{const api=\"https://api.thecontextcache.com/integrations/memories\";const key=prompt(\"X-API-Key\");const org=prompt(\"X-Org-Id\");const project=prompt(\"Project ID\");if(!key||!project){alert(\"Missing key or project\");return;}await fetch(api,{method:\"POST\",headers:{\"Content-Type\":\"application/json\",\"X-API-Key\":key,\"X-Org-Id\":org||\"\"},body:JSON.stringify({project_id:Number(project),type:\"web\",source:\"extension\",title:document.title,content:document.title+\"\\\\n\"+location.href,metadata:{url:location.href},tags:[\"bookmarklet\"]})});alert(\"Saved to ContextCache\");})(); \n</code></pre>"},{"location":"10-integrations/#dummy-slack-bot-handler-python","title":"Dummy Slack bot handler (Python)","text":"<pre><code>def handle_slack_message(text: str, project_id: int, api_key: str, org_id: int) -&gt; None:\n    import requests\n    requests.post(\n        \"https://api.thecontextcache.com/integrations/memories\",\n        headers={\"X-API-Key\": api_key, \"X-Org-Id\": str(org_id)},\n        json={\n            \"project_id\": project_id,\n            \"type\": \"chat\",\n            \"source\": \"api\",\n            \"content\": text,\n            \"metadata\": {\"tool\": \"slack-bot\"},\n            \"tags\": [\"slack\"],\n        },\n        timeout=10,\n    ).raise_for_status()\n</code></pre>"},{"location":"10-integrations/#notes","title":"Notes","text":"<ul> <li>For public beta scale, this API is enough for IDE plugins, bots, and scripts.</li> <li>Future hardening: signed webhooks, per-integration keys, and Redis-backed global rate limits.</li> </ul>"},{"location":"10-integrations/#cag-rag-retrieval-flow","title":"CAG + RAG retrieval flow","text":"<p>Recall uses a two-stage decision:</p> <ol> <li>CAG pre-check: query is matched against a static golden-knowledge cache (docs + built-ins) preloaded in memory.</li> <li>CAG scoring uses in-memory embedding similarity (<code>CAG_EMBEDDING_MODEL_NAME</code>).</li> <li>Default provider is deterministic hash embeddings for speed/stability; optional sentence-transformers can be enabled.</li> <li>RAG fallback: if CAG confidence is low, run hybrid retrieval over project memories:</li> <li>PostgreSQL FTS (<code>websearch_to_tsquery</code>)</li> <li>Hilbert prefilter (<code>hilbert_index</code> range) + pgvector cosine similarity</li> <li>recency boost</li> </ol> <p>This means global/product answers can return instantly, while project-specific queries still use memory retrieval.</p>"},{"location":"10-integrations/#cag-environment","title":"CAG environment","text":"<pre><code>CAG_ENABLED=true\nCAG_MODE=local\nCAG_MAX_TOKENS=180000\nCAG_MATCH_THRESHOLD=0.58\nCAG_EMBEDDING_MODEL_NAME=all-MiniLM-L6-v2\nCAG_EMBEDDING_PROVIDER=hash\nCAG_EMBEDDING_DIMS=384\nCAG_CACHE_MAX_ITEMS=512\nCAG_PHEROMONE_HIT_BOOST=0.15\nCAG_PHEROMONE_EVAPORATION=0.95\nCAG_EVAPORATION_INTERVAL_SECONDS=600\nCAG_KV_STUB_ENABLED=true\nCAG_SOURCE_FILES=docs/00-overview.md,docs/01-mvp-scope.md,docs/04-api-contract.md,docs/legal.md\n</code></pre> <p>Phase 3 cache behavior: - CAG entries reinforce <code>pheromone_level</code> on hits. - A background evaporation loop decays pheromone every 10 minutes. - Eviction removes the lowest pheromone entries, then least-recently-accessed ties.</p>"},{"location":"10-integrations/#cocoindex-ingestion-baseline","title":"CocoIndex ingestion baseline","text":"<p>The backend now includes <code>api/app/ingestion/</code> with:</p> <ul> <li><code>cocoindex_flow.py</code> (flow definition scaffolding)</li> <li><code>pipeline.py</code> incremental file ingestion</li> </ul> <p><code>ingest_path_incremental</code> stores metadata per chunk:</p> <ul> <li><code>source_filename</code></li> <li><code>source_last_modified</code></li> <li><code>ingestion_chunk_index</code></li> </ul> <p>and writes embeddings to <code>memories.embedding_vector</code> / <code>memories.search_vector</code>.</p> <p>Hashing + reprocessing rules: - chunk hash is based on <code>project_id + chunk_content</code> (not file mtime) - file <code>mtime</code> is used only to decide whether the file needs re-checking - if content is unchanged but mtime changes, chunks are rechecked but not re-embedded</p>"},{"location":"10-integrations/#ollama-integration-env","title":"Ollama integration env","text":"<pre><code>EMBEDDING_PROVIDER=ollama\nOLLAMA_BASE_URL=http://ollama:11434\nOLLAMA_EMBED_MODEL=nomic-embed-text\nOLLAMA_CONTEXT_MODEL=llama3.1\nOLLAMA_EMBED_ENDPOINT=http://ollama:11434/api/embeddings\nOLLAMA_CHAT_ENDPOINT=http://ollama:11434/api/generate\nANALYZER_MODE=ollama\n</code></pre> <p>Sensitive keys/URLs are read from env only and are never returned by API responses.</p>"},{"location":"10-integrations/#cli-examples","title":"CLI examples","text":"<pre><code># Upload via integration endpoint\npython cli/cc.py integrations upload --project 1 --type note --text \"Captured from CLI\"\n\n# Upload from file\npython cli/cc.py integrations upload --project 1 --type doc --file ./notes.md\n\n# List integration memories\npython cli/cc.py integrations list --project 1 --limit 20 --offset 0\n\n# Contextualize memory with Ollama worker\npython cli/cc.py integrations contextualize --memory-id 42\n\n# Seed demo projects/memories via HTTP integration API (uses SDK)\npython cli/cc.py seed-mock-data --num-projects 5 --memories-per-project 8\n</code></pre> <p>Seed flags: - <code>--num-projects</code> (default <code>3</code>) - <code>--memories-per-project</code> (default <code>2</code>)</p>"},{"location":"10-integrations/#sqlalchemy-seed-utility","title":"SQLAlchemy seed utility","text":"<p>For direct DB-side seeding (admin/demo setup), use:</p> <pre><code>docker compose exec api uv run python -m app.seed_mock_data\n\n# Host wrapper (only when DATABASE_URL is reachable from host)\npython scripts/seed_mock_data.py\n</code></pre> <p>This script: - ensures <code>dn@thecontextcache.com</code> exists and is admin (target auth user id <code>2</code>) - ensures a demo org + ownership membership - creates mock projects (<code>Alpha Launch</code>, <code>Q2 Planning</code>, <code>Research Roadmap</code>) - creates typed memories with metadata/tags over multiple dates - writes <code>memory_embeddings</code> rows and vector fields via SQLAlchemy</p>"},{"location":"11-branding/","title":"Branding Guidelines","text":""},{"location":"11-branding/#wordmark","title":"Wordmark","text":"<ul> <li>Primary brand text: <code>thecontextcache\u2122</code></li> <li>Keep the \u2122 symbol visible in app header, landing, and legal surfaces.</li> <li>Use lower-case spelling exactly as above.</li> </ul>"},{"location":"11-branding/#logo-system","title":"Logo system","text":"<ul> <li>Header logo: compact neural/interlocking-C glyph before the wordmark.</li> <li>Minimum size:</li> <li>Header icon: <code>20px</code></li> <li>Favicon: <code>32x32</code> SVG</li> <li>Theme-aware colors:</li> <li>Dark UI: cyan/violet glow</li> <li>Light UI: teal/indigo contrast</li> </ul>"},{"location":"11-branding/#theme-dependent-assets","title":"Theme-dependent assets","text":"<ul> <li>Favicons:</li> <li><code>/favicon-dark.svg</code></li> <li><code>/favicon-light.svg</code></li> <li>Runtime behavior:</li> <li>Theme provider updates <code>&lt;link id=\"dynamic-favicon\"&gt;</code> whenever theme changes.</li> <li>Layout boot script sets favicon before first paint.</li> <li>Cache busting uses <code>NEXT_PUBLIC_ASSET_VERSION</code> query suffix.</li> </ul>"},{"location":"11-branding/#placement-rules","title":"Placement rules","text":"<ul> <li>Top-left nav: <code>logo + wordmark</code> (never wordmark-only in app shell).</li> <li>Keep horizontal spacing at <code>8px</code> between icon and text.</li> <li>Avoid stretching or recoloring the logo outside the theme tokens.</li> </ul>"},{"location":"11-branding/#typography","title":"Typography","text":"<ul> <li>Product name in nav and legal: <code>thecontextcache\u2122</code></li> <li>Headline style uses display font tokens from <code>globals.css</code>.</li> <li>Monospace labels are reserved for technical chips and metadata only.</li> </ul>"},{"location":"11-branding/#accessibility","title":"Accessibility","text":"<ul> <li>Maintain WCAG AA contrast for logo and wordmark in both themes.</li> <li>Favicon variants should remain distinguishable against browser tab backgrounds.</li> </ul>"},{"location":"404/","title":"Not Found","text":"<p>The requested documentation page does not exist.</p> <p>Try the Home page and navigate from the sidebar.</p>"},{"location":"legal/","title":"Legal, Licensing &amp; Privacy","text":"<p>Trademark notice</p> <p>thecontextcache\u2122 is a pending trademark. The \u2122 symbol indicates an unregistered trademark claim. No licence to use the mark is granted beyond what is expressly stated in the Terms of Service.</p>"},{"location":"legal/#copyright","title":"Copyright","text":"<p>Copyright \u00a9 2026 thecontextcache\u2122. All Rights Reserved.</p> <p>This software and its source code, design, documentation, and associated materials (\"the Software\") are the exclusive property of thecontextcache\u2122 and are protected by copyright, trade secret, and other intellectual property laws.</p>"},{"location":"legal/#proprietary-software-licence","title":"Proprietary Software Licence","text":"<p>The Software is licensed, not sold.</p> <p>During the alpha phase, the Software is made available to invited users for evaluation and early-access use only. The following restrictions apply to all users, evaluators, and contributors:</p> <p>You may NOT:</p> <ul> <li>Copy, reproduce, distribute, sublicense, sell, resell, or otherwise exploit the   Software or any portion thereof.</li> <li>Modify, translate, adapt, merge, or create derivative works based on the Software,   its source code, documentation, or underlying algorithms.</li> <li>Reverse-engineer, decompile, disassemble, or attempt to derive source code,   algorithms, or trade secrets from the Software.</li> <li>Use the Software to build a competing product or service.</li> <li>Benchmark or publish performance comparisons without prior written consent.</li> <li>Remove, obscure, or alter any copyright, trademark, or proprietary notice.</li> <li>Circumvent, disable, or otherwise interfere with security controls, rate limits,   or access-control mechanisms.</li> </ul> <p>All rights not expressly granted herein are reserved by thecontextcache\u2122.</p>"},{"location":"legal/#disclaimer-of-warranty","title":"Disclaimer of Warranty","text":"<p>THE SOFTWARE IS PROVIDED \"AS IS\" AND \"AS AVAILABLE\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, TITLE, AND NON-INFRINGEMENT.</p> <p>THECONTEXTCACHE\u2122 DOES NOT WARRANT THAT THE SOFTWARE WILL BE UNINTERRUPTED, ERROR-FREE, FREE FROM HARMFUL COMPONENTS, OR THAT DEFECTS WILL BE CORRECTED.</p>"},{"location":"legal/#limitation-of-liability","title":"Limitation of Liability","text":"<p>TO THE MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW, THECONTEXTCACHE\u2122, ITS OFFICERS, DIRECTORS, EMPLOYEES, AND AGENTS SHALL NOT BE LIABLE FOR ANY INDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL, PUNITIVE, OR EXEMPLARY DAMAGES \u2014 INCLUDING LOSS OF PROFITS, DATA, GOODWILL, OR BUSINESS INTERRUPTION \u2014 ARISING OUT OF OR RELATING TO YOUR USE OF, OR INABILITY TO USE, THE SOFTWARE.</p> <p>IN NO EVENT SHALL TOTAL CUMULATIVE LIABILITY EXCEED THE GREATER OF (A) AMOUNTS PAID IN THE 12 MONTHS PRIOR TO THE CLAIM, OR (B) \u00a3100. DURING THE FREE ALPHA PHASE, LIABILITY SHALL NOT EXCEED \u00a30 (ZERO).</p>"},{"location":"legal/#data-privacy-summary","title":"Data &amp; Privacy Summary","text":"<p>This section summarises how user data is handled. The canonical Terms &amp; Privacy Policy is at /legal.</p>"},{"location":"legal/#what-we-collect","title":"What we collect","text":"Data Purpose Retention Email address Authentication &amp; invitations Until deletion requested Session token (SHA-256 hash) Session management Until revoked or expired Login IP address Security &amp; abuse prevention Last 10 per user; nightly purge after 90 days User-agent string Security context Last 10 per user Memory card content Core product functionality Until user deletes project Daily usage counters Limit enforcement 90-day rolling window"},{"location":"legal/#ip-address-logging","title":"IP address logging","text":"<p>On each successful magic-link sign-in, the client IP address is recorded. The system atomically retains only the last 10 login events per user \u2014 older records are deleted within the same database transaction on each new sign-in. A nightly Celery task (<code>cleanup_old_login_events</code>) removes any rows older than 90 days.</p> <p>The real client IP is extracted with the following priority:</p> <ol> <li><code>CF-Connecting-IP</code> (Cloudflare Tunnel header \u2014 present in production)</li> <li><code>X-Forwarded-For</code> (first IP in the chain)</li> <li><code>request.client.host</code> (direct connection fallback for dev)</li> </ol> <p>IP addresses are never logged in application logs, emails, or API responses. They are visible only to administrators via the admin panel (<code>/admin</code> \u2192 Login IPs tab).</p>"},{"location":"legal/#session-cookies","title":"Session cookies","text":"Attribute Dev Prod (APP_ENV=prod) HttpOnly \u2713 \u2713 Secure \u2717 \u2713 SameSite Lax Lax Domain unset unset (host-only) <p>SameSite=Lax prevents the session cookie from being sent on cross-site POST requests, providing strong CSRF protection without additional middleware.</p>"},{"location":"legal/#termination","title":"Termination","text":"<p>Either party may terminate your access at any time. On termination, all licences cease immediately. The warranty disclaimer, liability limitation, and IP sections survive.</p>"},{"location":"legal/#governing-law","title":"Governing Law","text":"<p>These terms are governed by the laws of England and Wales.</p>"},{"location":"legal/#dispute-resolution-arbitration-class-action-waiver","title":"Dispute Resolution, Arbitration &amp; Class Action Waiver","text":"<p>To the fullest extent permitted by law:</p> <ul> <li>Any dispute, claim, or controversy arising out of or relating to these terms   or your use of the Service will be resolved by binding individual arbitration.</li> <li>You and thecontextcache\u2122 waive any right to a jury trial.</li> <li>You and thecontextcache\u2122 waive any right to bring or participate in class,   collective, representative, or private-attorney-general actions.</li> <li>Arbitration must proceed only on an individual basis.</li> </ul> <p>If a court determines the class-action waiver is unenforceable for a specific claim, that claim must be severed and litigated only in the courts of England and Wales; all remaining claims continue in arbitration.</p>"},{"location":"legal/#trademark-use-guidelines","title":"Trademark Use Guidelines","text":"<p>The mark thecontextcache\u2122 is an unregistered/pending trademark claim. Third parties may reference the product name only in a nominative, non-confusing manner. You may not:</p> <ul> <li>imply endorsement, affiliation, or sponsorship by thecontextcache\u2122</li> <li>use confusingly similar names, domains, logos, or branding</li> <li>register social handles or domains likely to cause confusion with the mark</li> </ul> <p>Use of the mark must not dilute or misrepresent the brand.</p>"},{"location":"legal/#contact","title":"Contact","text":"<p>For legal inquiries, trademark notices, or data subject requests:</p> <pre><code>support@thecontextcache.com\n</code></pre> <p>Response target: 5 business days for general inquiries, 30 days for data subject requests.</p>"}]}