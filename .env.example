# ============================================================
# ContextCache — environment template
# Copy to .env and fill in values.  DO NOT commit .env.
# ============================================================

# ── App environment ─────────────────────────────────────────
# "dev" enables debug magic links, bootstrap API key, verbose logs.
# "prod" enables secure cookies, strict CORS, no debug output.
APP_ENV=dev

# ── Public base URL (used in magic-link emails) ─────────────
# Dev:  http://localhost:3000
# Prod: https://thecontextcache.com
APP_PUBLIC_BASE_URL=http://localhost:3000

# ── CORS origins ────────────────────────────────────────────
# Comma-separated list of browser origins allowed to call the API.
# Dev:  CORS_ORIGINS=http://localhost:3000
# Prod: CORS_ORIGINS=https://thecontextcache.com
# (The web container proxies /api/* server-side; CORS matters for CLI/SDK.)
CORS_ORIGINS=http://localhost:3000

# ── Web UI overrides ─────────────────────────────────────────
# Baked into the Next.js Docker image at build time.
# Leave blank for dev (auto-detection).
#
# Production (Cloudflare Tunnel, subdomain deployment):
#   NEXT_PUBLIC_API_BASE_URL=   ← leave blank; /api/* is proxied via Next.js
#   NEXT_PUBLIC_DOCS_URL=https://docs.thecontextcache.com
#
# Override for direct API access (CLI, SDK, no proxy):
#   NEXT_PUBLIC_API_BASE_URL=https://api.thecontextcache.com
NEXT_PUBLIC_API_BASE_URL=
NEXT_PUBLIC_DOCS_URL=
NEXT_PUBLIC_ASSET_VERSION=20260221
NEXT_PUBLIC_BRAIN_RENDERER=webgl
NEXT_PUBLIC_FEATURE_CLUSTERS=1
NEXT_PUBLIC_FEATURE_BATCH_ACTIONS=1

# ── Production reference block ───────────────────────────────
# Copy these values when deploying to thecontextcache.com:
#
#   APP_ENV=prod
#   APP_PUBLIC_BASE_URL=https://thecontextcache.com
#   CORS_ORIGINS=https://thecontextcache.com
#   NEXT_PUBLIC_API_BASE_URL=
#   NEXT_PUBLIC_DOCS_URL=https://docs.thecontextcache.com

# ── Dev bootstrap API key ────────────────────────────────────
# Only used when APP_ENV=dev and zero active API keys exist.
# Remove or leave blank in production.
# BOOTSTRAP_API_KEY=cck_your_stable_dev_key
# BOOTSTRAP_KEY_NAME=dev-key
# BOOTSTRAP_ORG_NAME="Demo Org"

# ── Auth TTLs ───────────────────────────────────────────────
MAGIC_LINK_TTL_MINUTES=10
SESSION_TTL_DAYS=7
MAX_SESSIONS_PER_USER=3

# ── Auth rate limits ─────────────────────────────────────────
AUTH_RATE_LIMIT_PER_IP_PER_HOUR=5
AUTH_RATE_LIMIT_PER_EMAIL_PER_HOUR=3
AUTH_VERIFY_RATE_LIMIT_PER_IP_PER_HOUR=20
RECALL_RATE_LIMIT_PER_IP_PER_HOUR=240
RECALL_RATE_LIMIT_PER_ACCOUNT_PER_HOUR=240

# ── Daily usage limits (0 = no limit) ───────────────────────
DAILY_MAX_MEMORIES=100
DAILY_MAX_RECALLS=50
DAILY_MAX_PROJECTS=10
WEEKLY_MAX_MEMORIES=500
WEEKLY_MAX_RECALLS=300
WEEKLY_MAX_PROJECTS=50

# ── Hybrid recall tuning ─────────────────────────────────────
VECTOR_WEIGHT=0.25
FTS_WEIGHT=0.65
RECENCY_WEIGHT=0.10
RECALL_VECTOR_MIN_SCORE=0.20
RECALL_VECTOR_CANDIDATES=200
# Hilbert prefilter for vector candidate narrowing (0 disables).
HILBERT_ENABLED=false
HILBERT_DIMS=6
HILBERT_BITS=10
HILBERT_SEED=1337
HILBERT_RADIUS=500000
HILBERT_PREFILTER_CANDIDATES=5000
HILBERT_MIN_ROWS=500
HILBERT_MAX_RADIUS=5000000
HILBERT_WIDEN_MULT=2.0
HILBERT_PREFILTER_WINDOW=5000000
HILBERT_PREFILTER_MIN_CANDIDATES=12
HEDGE_DELAY_MS=120
HEDGE_MIN_DELAY_MS=25
HEDGE_USE_P95_CACHE=true
HEDGE_P95_CACHE_TTL_SECONDS=900

# ── CAG (Cache-Augmented Generation) ─────────────────────────
CAG_ENABLED=true
CAG_MODE=local
CAG_MAX_TOKENS=180000
CAG_MATCH_THRESHOLD=0.58
CAG_EMBEDDING_MODEL_NAME=all-MiniLM-L6-v2
CAG_EMBEDDING_PROVIDER=hash
CAG_EMBEDDING_DIMS=384
CAG_CACHE_MAX_ITEMS=512
CAG_PHEROMONE_BASE=1.0
CAG_PHEROMONE_HIT_BOOST=0.15
CAG_PHEROMONE_MAX=25.0
CAG_PHEROMONE_MIN=0.001
CAG_PHEROMONE_EVAPORATION=0.95
CAG_EVAPORATION_INTERVAL_SECONDS=600
CAG_KV_STUB_ENABLED=true
CAG_SOURCE_FILES=docs/00-overview.md,docs/01-mvp-scope.md,docs/04-api-contract.md,docs/legal.md

# ── Email (magic link delivery) ──────────────────────────────
# Resend is the primary provider (get a free API key at resend.com).
# If RESEND_API_KEY is set it is tried first; SES is the automatic fallback.
RESEND_API_KEY=re_xxxxxxxxxxxxxxxxxxxx
RESEND_FROM_EMAIL=noreply@thecontextcache.com

# ── AWS SES (fallback provider) ───────────────────────────────
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
SES_FROM_EMAIL=support@thecontextcache.com

# Emergency log fallback — only for staging when both providers are broken.
# NEVER set true in real production.
MAGIC_LINK_ALLOW_LOG_FALLBACK=false

# ── Postgres ─────────────────────────────────────────────────
# Docker Compose builds DATABASE_URL from these variables.
POSTGRES_USER=contextcache
# Generate a strong password: openssl rand -base64 24
POSTGRES_PASSWORD=change-me
POSTGRES_DB=contextcache
# Localhost-only bind on server for SSH tunneling into Postgres from Mac GUI tools.
POSTGRES_LOCAL_PORT=55432

# ── Worker (optional — requires --profile worker) ────────────
WORKER_ENABLED=false
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/0
REDIS_URL=redis://redis:6379/0

# ── Analyzer mode ────────────────────────────────────────────
# "local"   → in-process scoring (default, no extra infra)
# "service" → internal analyzer container (see docs/06-deployment.md)
ANALYZER_MODE=local
# ANALYZER_SERVICE_URL=http://analyzer:9000

# ── Embeddings provider ──────────────────────────────────────
# local  -> deterministic fallback vectors (default)
# openai -> real OpenAI embeddings, falls back to local on errors
EMBEDDING_PROVIDER=local
# OPENAI_API_KEY=
EMBEDDING_DIMS=1536
EMBEDDING_MODEL_VERSION=v1
OLLAMA_BASE_URL=http://ollama:11434
OLLAMA_MODEL=nomic-embed-text
OLLAMA_EMBED_MODEL=nomic-embed-text
OLLAMA_CONTEXT_MODEL=llama3.1
OLLAMA_EMBED_ENDPOINT=http://ollama:11434/api/embeddings
OLLAMA_CHAT_ENDPOINT=http://ollama:11434/api/generate

# ── Integration signing (optional webhook-style HMAC) ────────
# INTEGRATION_SIGNING_SECRET=replace-with-long-random-secret

# ── Billing hooks (future) ───────────────────────────────────
BILLING_PROVIDER=none
