# ============================================================
# ContextCache — environment template
# Copy to .env and fill in values.  DO NOT commit .env.
# ============================================================

# ── App environment ─────────────────────────────────────────
# "dev" enables debug magic links, bootstrap API key, verbose logs.
# "prod" enables secure cookies, strict CORS, no debug output.
APP_ENV=dev

# ── Public base URL (used in magic-link emails) ─────────────
# Dev:  http://localhost:3000
# Prod: https://thecontextcache.com
APP_PUBLIC_BASE_URL=http://localhost:3000

# ── CORS origins ────────────────────────────────────────────
# Comma-separated list of browser origins allowed to call the API.
# Dev:  CORS_ORIGINS=http://localhost:3000
# Prod: CORS_ORIGINS=https://thecontextcache.com
# (The web container proxies /api/* server-side; CORS matters for CLI/SDK.)
CORS_ORIGINS=http://localhost:3000

# ── Web UI overrides ─────────────────────────────────────────
# Baked into the Next.js Docker image at build time.
# Leave blank for dev (auto-detection).
#
# Production (Cloudflare Tunnel, subdomain deployment):
#   NEXT_PUBLIC_API_BASE_URL=   ← leave blank; /api/* is proxied via Next.js
#   NEXT_PUBLIC_DOCS_URL=https://docs.thecontextcache.com
#
# Override for direct API access (CLI, SDK, no proxy):
#   NEXT_PUBLIC_API_BASE_URL=https://api.thecontextcache.com
NEXT_PUBLIC_API_BASE_URL=
NEXT_PUBLIC_DOCS_URL=
NEXT_PUBLIC_ASSET_VERSION=20260221

# ── Production reference block ───────────────────────────────
# Copy these values when deploying to thecontextcache.com:
#
#   APP_ENV=prod
#   APP_PUBLIC_BASE_URL=https://thecontextcache.com
#   CORS_ORIGINS=https://thecontextcache.com
#   NEXT_PUBLIC_API_BASE_URL=
#   NEXT_PUBLIC_DOCS_URL=https://docs.thecontextcache.com

# ── Dev bootstrap API key ────────────────────────────────────
# Only used when APP_ENV=dev and zero active API keys exist.
# Remove or leave blank in production.
# BOOTSTRAP_API_KEY=cck_your_stable_dev_key
# BOOTSTRAP_KEY_NAME=dev-key
# BOOTSTRAP_ORG_NAME=Demo Org

# ── Auth TTLs ───────────────────────────────────────────────
MAGIC_LINK_TTL_MINUTES=10
SESSION_TTL_DAYS=7
MAX_SESSIONS_PER_USER=3

# ── Auth rate limits ─────────────────────────────────────────
AUTH_RATE_LIMIT_PER_IP_PER_HOUR=5
AUTH_RATE_LIMIT_PER_EMAIL_PER_HOUR=3
AUTH_VERIFY_RATE_LIMIT_PER_IP_PER_HOUR=20
RECALL_RATE_LIMIT_PER_IP_PER_HOUR=240
RECALL_RATE_LIMIT_PER_ACCOUNT_PER_HOUR=240

# ── Daily usage limits (0 = no limit) ───────────────────────
# Preferred names:
DAILY_MAX_MEMORIES=100
DAILY_MAX_RECALLS=50
DAILY_MAX_PROJECTS=10
WEEKLY_MAX_MEMORIES=500
WEEKLY_MAX_RECALLS=300
WEEKLY_MAX_PROJECTS=50
# Backward-compatible aliases (optional):
# DAILY_MEMORY_LIMIT=100
# DAILY_RECALL_LIMIT=50
# DAILY_PROJECT_LIMIT=10

# ── Hybrid recall tuning ─────────────────────────────────────
# Preferred names:
VECTOR_WEIGHT=0.25
FTS_WEIGHT=0.65
RECENCY_WEIGHT=0.10
# Backward-compatible names:
RECALL_WEIGHT_FTS=0.65
RECALL_WEIGHT_VECTOR=0.25
RECALL_WEIGHT_RECENCY=0.10
RECALL_VECTOR_MIN_SCORE=0.20
RECALL_VECTOR_CANDIDATES=200
HEDGE_DELAY_MS=120
HEDGE_MIN_DELAY_MS=25
HEDGE_USE_P95_CACHE=true
HEDGE_P95_CACHE_TTL_SECONDS=900
# Legacy alias (still supported):
# HEDGE_USE_P95=true

# ── CAG (Cache-Augmented Generation) ─────────────────────────
CAG_ENABLED=true
CAG_MODE=local
CAG_MAX_TOKENS=180000
CAG_MATCH_THRESHOLD=0.58
CAG_EMBEDDING_MODEL_NAME=all-MiniLM-L6-v2
CAG_EMBEDDING_PROVIDER=hash
CAG_EMBEDDING_DIMS=384
CAG_SOURCE_FILES=docs/00-overview.md,docs/01-mvp-scope.md,docs/04-api-contract.md,docs/legal.md

# ── SES (magic link email) ───────────────────────────────────
# Required in prod.  In dev the API logs the link to stdout instead.
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
SES_FROM_EMAIL=support@thecontextcache.com

# ── Postgres ─────────────────────────────────────────────────
# Docker Compose builds DATABASE_URL from these variables.
POSTGRES_USER=contextcache
# Generate a strong password: openssl rand -base64 24
POSTGRES_PASSWORD=change-me
POSTGRES_DB=contextcache

# ── Worker (optional — requires --profile worker) ────────────
WORKER_ENABLED=false
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/0
REDIS_URL=redis://redis:6379/0

# ── Analyzer mode ────────────────────────────────────────────
# "local"   → in-process scoring (default, no extra infra)
# "service" → internal analyzer container (see docs/06-deployment.md)
ANALYZER_MODE=local
# ANALYZER_SERVICE_URL=http://analyzer:9000

# ── Embeddings provider ──────────────────────────────────────
# local  -> deterministic fallback vectors (default)
# openai -> real OpenAI embeddings, falls back to local on errors
EMBEDDING_PROVIDER=local
# OPENAI_API_KEY=
EMBEDDING_DIMS=1536
EMBEDDING_MODEL_VERSION=v1
OLLAMA_BASE_URL=http://ollama:11434
OLLAMA_MODEL=nomic-embed-text
OLLAMA_EMBED_MODEL=nomic-embed-text
OLLAMA_CONTEXT_MODEL=llama3.1
OLLAMA_EMBED_ENDPOINT=http://ollama:11434/api/embeddings
OLLAMA_CHAT_ENDPOINT=http://ollama:11434/api/generate

# ── Integration signing (optional webhook-style HMAC) ────────
# INTEGRATION_SIGNING_SECRET=replace-with-long-random-secret

# ── Billing hooks (future) ───────────────────────────────────
BILLING_PROVIDER=none
